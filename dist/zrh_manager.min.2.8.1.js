/*! zrh_manager 18-10-2016 */
var loginCtrl=angular.module("loginCtrl",[]);loginCtrl.controller("LoginCtrl",function($http,$scope,$rootScope,$location,$state,$timeout,$routeParams){var getTimestampTemp=(new Date).getTime(),timestamp=String(getTimestampTemp).substring(0,10),getTimestamp=parseInt(timestamp);$scope.loginUser={account:"",password:"",timestamp:getTimestamp},$scope.error_code_msg={1003:"该用户不存在",2001:"用户名或密码错误",1002:"该用户异常",1:"服务器异常,请稍后再试"};var check_params=function(params){return""!=params.account&&""!=params.password};$scope.login=function(){$scope.loginUser.signature=$rootScope.encryptByDES($scope.loginUser.password+$scope.loginUser.timestamp);var m_params=$scope.loginUser;check_params(m_params)&&$http({url:api_uri+"p/user/login",method:"POST",params:m_params}).success(function(d){0==d.returnCode&&(console.log(d),$rootScope.login_user={userId:d.result.split("_")[0],token:d.result.split("_")[1]},$rootScope.putObject("login_user",$rootScope.login_user),$scope.choiceUser(),$scope.loginUser={account:"",password:"",timestamp:getTimestamp})}).error(function(d){$scope.changeErrorMsg("网络故障请稍后再试......"),$location.path("/login")})},$scope.choiceUser=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"p/user/detail/"+$rootScope.login_user.userId,method:"GET",params:m_params}).success(function(d){if(0==d.returnCode)console.log(d),"super"==d.result.role?$location.path("/super"):$location.path("/admin");else{var msg=$scope.error_code_msg[d.returnCode];msg||(msg="登录失败"),$scope.error_msg=msg}}).error(function(d){})},$scope.reset=function(){}});var topBarCtrl=angular.module("topBarCtrl",[]);topBarCtrl.controller("TopBarCtrl",function($http,$scope,$rootScope,$location){$rootScope.message(),$rootScope.bank_messages(),$rootScope.system_messages(),$scope.go_home=function(){"manager"!=$rootScope.role?$location.path($rootScope.role):$location.path("admin")},$scope.exit=function(){$rootScope.removeObject("login_user"),$location.path("/login")}}),topBarCtrl.controller("SideBarCtrl",function($http,$scope,$state,$rootScope,$location,$timeout,$routeParams){}),topBarCtrl.controller("ContainsCtrl",function($http,$scope,$state,$rootScope,$location,$timeout,$routeParams){$scope.message_roll=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"zrh/message/listIndexs",method:"GET",params:m_params}).success(function(d){console.log(d),$scope.message_roll=d.result.datas,$scope.message_roll.length>0&&$scope.roll()}).error(function(d){})},$scope.message_roll(1,20),$scope.item=0,$scope.roll=function(){$scope.message_roll_item=$scope.message_roll[$scope.item].content,$scope.message_roll_id=$scope.message_roll[$scope.item].id,$scope.message_roll_url=$scope.message_roll[$scope.item].url,$timeout(function(){$scope.item++,$scope.item>=$scope.message_roll.length&&($scope.item=0),$scope.roll()},1e4),console.log($scope.message_roll_item)},$scope.to_company_message=function(id,url){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id};$http({url:api_uri+"zrh/message/details",method:"GET",params:m_params}).success(function(d){}).error(function(d){}),$location.path(url)},$scope.get_count=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"zrh/index/count",method:"GET",params:m_params}).success(function(d){console.log(d),$scope.countContain=d.result,$scope.get_group_count()}).error(function(d){})},$scope.get_count(),$scope.get_group_count=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"zrh/group/groupCountByUser",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode?$scope.countGroup=d.result:1003==d.returnCode?console.log("用户或分组不存在"):console.log(d)}).error(function(d){})}});var applyListCtrl=angular.module("applyListCtrl",[]);applyListCtrl.controller("ApplyListCtrl",function($http,$scope,$rootScope,$location,$timeout,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd,status:$scope.status};$http({url:api_uri+"loanApplicationManage/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas,angular.forEach($scope.result_list,function(data){$scope.status=d.result.status,0==data.status?(data.progressText="未申请",data.color=1):1==data.status?(data.progressText="准备中",data.color=2):2==data.status?(data.progressText="下户",data.color=2):3==data.status?(data.progressText="审批中",data.color=2):4==data.status?(data.progressText="审批通过",data.color=2):5==data.status?(data.progressText="开户",data.color=2):6==data.status?(data.progressText="放款",data.color=2):7==data.status&&(data.progressText="完成融资",data.color=3)}))}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope["delete"]=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.status_text="全部",$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="申请中":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)},$scope.updateApply=function(id){$location.path("/admin/my_project/detail/"+id)}});var productCtrl=angular.module("productCtrl",[]);productCtrl.controller("ProductCtrl",function($http,$scope,$rootScope,$location,$timeout){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd,release:$scope.release_status};$http({url:api_uri+"financialProductManage/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas,angular.forEach($scope.result_list,function(data){data.release?data.progressText="已发布":data.progressText="未发布"}))}).error(function(d){$location.path("/error")})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.submit=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/release",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.cancel=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/unRelease",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope["delete"]=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.sort_up=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/up",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.update=function(id){$location.path("/super/product/update/"+id)},$scope.release=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:id};$.ajax({type:"POST",url:api_uri+"financialProductManage/release",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.unrelease=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:id};$.ajax({type:"POST",url:api_uri+"financialProductManage/unRelease",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.release_text="全部",$scope.choice=function(release){$scope.release_status=release,1==$scope.release_status?$scope.release_text="已发布":0==$scope.release_status?$scope.release_text="未发布":null==$scope.release_status&&($scope.release_text="全部"),$scope.list(1,20)}}),productCtrl.controller("ProductCreateCtrl",function($http,$scope,$rootScope,$state,$location,$timeout,$routeParams){$scope.feature_list=[{feature:""}],$scope.add_feature=function(){$scope.feature_list.push({feature:""})},$scope.remove_feature=function(feature){for(var key in $scope.feature_list)if($scope.feature_list[key]==feature){$scope.feature_list.splice(key,1);break}},$scope.condition_list=[{condition:""}],$scope.add_condition=function(){$scope.condition_list.push({condition:""})},$scope.remove_condition=function(condition){for(var key in $scope.condition_list)if($scope.condition_list[key]==condition){$scope.condition_list.splice(key,1);break}},$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"manage/bank/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.bank_list=d.result.datas)}).error(function(d){$location.path("/error")})},$scope.list(1,100),$scope.choiceBank=function(id,name){$scope.bankId=id,$scope.bankName=name},$scope.tags="",$scope.type||($scope.type=0),$scope.submit=function(){var tags=[],text=$scope.tags,reg=new RegExp("＃","g");text=text.replace(reg,"#");for(var array=text.split("#"),i=0;i<array.length;i++)""!=array[i]&&" "!=array[i]&&tags.push(array[i]);$scope.feature_list_new=[],$scope.condition_list_new=[];for(var key in $scope.feature_list)$scope.feature_list_new.push($scope.feature_list[key].feature);for(var key in $scope.condition_list)$scope.condition_list_new.push($scope.condition_list[key].condition);var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.product.name,tags:tags,bankId:$scope.bankId,rate:$scope.product.rate,rateRemark:$scope.product.rateRemark,loanvalue:$scope.product.loanvalue,loanlife:$scope.product.loanlife,summary:$scope.product.summary,feature:$scope.feature_list_new,conditions:$scope.condition_list_new,type:$scope.type};$.ajax({type:"POST",url:api_uri+"financialProductManage/create",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($state.go("super.product"),$scope.$apply()):console.log(data)},dataType:"json"})}}),productCtrl.controller("ProductUpdateCtrl",function($http,$scope,$state,$rootScope,$location,$stateParams,$timeout,$routeParams){$scope.feature_list=[],$scope.tags="",$scope.add_feature=function(){$scope.feature_list.push({feature:""})},$scope.remove_feature=function(feature){for(var key in $scope.feature_list)if($scope.feature_list[key]==feature){$scope.feature_list.splice(key,1);break}},$scope.condition_list=[],$scope.add_condition=function(){$scope.condition_list.push({condition:""})},$scope.remove_condition=function(condition){for(var key in $scope.condition_list)if($scope.condition_list[key]==condition){$scope.condition_list.splice(key,1);break}},$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"manage/bank/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($scope.page=d.result,$scope.bank_list=d.result.datas):console.log(d.result)}).error(function(d){$location.path("/error")})},$scope.list(1,100),$scope.get=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"financialProductManage/detail/"+$stateParams.id,method:"GET",params:m_params}).success(function(d){if($scope.pageTitle="修改金融产品",$scope.product=d.result,$scope.type=d.result.type,$scope.bankName=$scope.product.bankname,$scope.bankId=$scope.product.bankId,$scope.tags_arr=$scope.product.tags,$scope.tags_arr)for(var i=0;i<$scope.tags_arr.length;i++)$scope.tags+="#",$scope.tags+=$scope.tags_arr[i],$scope.tags+="# ";for(var key in d.result.feature)$scope.feature_list.push({feature:d.result.feature[key]});for(var key in d.result.conditions)$scope.condition_list.push({condition:d.result.conditions[key]})}).error(function(d){$location.path("/error")})},$scope.get(),$scope.choiceBank=function(id,name){$scope.bankId=id,$scope.bankName=name},$scope.submit=function(){var tags=[],text=$scope.tags,reg=new RegExp("＃","g");text=text.replace(reg,"#");for(var array=text.split("#"),i=0;i<array.length;i++)""!=array[i]&&" "!=array[i]&&tags.push(array[i]);$scope.feature_list_new=[],$scope.condition_list_new=[];for(var key in $scope.feature_list)$scope.feature_list_new.push($scope.feature_list[key].feature);for(var key in $scope.condition_list)$scope.condition_list_new.push($scope.condition_list[key].condition);var m_params={id:$stateParams.id,userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.product.name,tags:tags,type:$scope.type,bankId:$scope.bankId,rate:$scope.product.rate,rateRemark:$scope.product.rateRemark,loanvalue:$scope.product.loanvalue,loanlife:$scope.product.loanlife,summary:$scope.product.summary,feature:$scope.feature_list_new,conditions:$scope.condition_list_new};$.ajax({type:"POST",url:api_uri+"financialProductManage/update",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($state.go("super.product"),$scope.$apply()):console.log(data)},dataType:"json"})}});var manageCtrl=angular.module("manageCtrl",[]);manageCtrl.controller("UserListCtrl",function($http,$scope,$rootScope,$location,$timeout){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"p/user/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas,angular.forEach($scope.result_list,function(data){"admin"==data.role?data.position="销售人员":"manager"==data.role?data.position="销售主管":"super"==data.role&&(data.position="超级管理员")}))}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,8)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.update=function(id){$location.path("/super/manage/update/"+id)},$scope["delete"]=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"p/user/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,20)},dataType:"json"})}}),manageCtrl.controller("CreateUserCtrl",function($http,$scope,$rootScope,$location,$state,$timeout,$routeParams){var timesTamp=(new Date).getTime(),timesTamp1=String(timesTamp).substring(0,10);$scope.timestamp=parseInt(timesTamp1),$scope.isUpdate=!1,$scope.checkPassword=function(d){1==d?$scope.password_one?$scope.password_again&&($scope.password_one!=$scope.password_again?($scope.msg_success="",$scope.msg_password_one="",$scope.msg_password="两次输入的密码不一致"):$scope.password_one==$scope.password_again&&($scope.msg_success="密码正确",$scope.msg_password="",$scope.msg_password_one="")):($scope.msg_password_one="请输入密码",$scope.msg_password="",$scope.msg_success=""):2==d&&($scope.password_again?$scope.password_one!=$scope.password_again?($scope.msg_success="",$scope.msg_password_one="",$scope.msg_password="两次输入的密码不一致"):$scope.password_one==$scope.password_again&&($scope.msg_password="",$scope.msg_password_one="",$scope.msg_success="密码正确",$scope.password=$scope.password_one):($scope.msg_success="",$scope.msg_password_one="",$scope.msg_password="请输入密码"))},$scope.submit=function(){if($scope.password){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,timestamp:$scope.timestamp,email:$scope.email,name:$scope.name,mobile:$scope.mobile,empNo:$scope.empNo,password:$scope.password,role:$scope.role_sale,signature:$rootScope.encryptByDES($scope.email+$scope.password+$scope.timestamp)};console.log(m_params),$http({url:api_uri+"p/user/create",method:"POST",params:m_params}).success(function(d){0==d.returnCode&&$state.go("super.manage")}).error(function(d){})}else alert("没有输入密码或两次密码不一致")}}),manageCtrl.controller("UserUpdateCtrl",function($http,$scope,$rootScope,$location,$state,$timeout,$stateParams){var timesTamp=(new Date).getTime(),timesTamp1=String(timesTamp).substring(0,10);$scope.timestamp=parseInt(timesTamp1),$scope.isUpdate=!1,$scope.get=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"p/user/detail/"+$stateParams.id,method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.isUpdate=!0,$scope.email=d.result.email,$scope.name=d.result.name,$scope.mobile=d.result.mobile,$scope.empNo=d.result.empNo,$scope.role_sale=d.result.role)}).error(function(d){})},$scope.get(),$scope.checkPassword=function(d){1==d?$scope.password_one?$scope.password_again&&($scope.password_one!=$scope.password_again?($scope.msg_success="",$scope.msg_password_one="",$scope.msg_password="两次输入的密码不一致"):$scope.password_one==$scope.password_again&&($scope.msg_success="密码正确",$scope.msg_password="",$scope.msg_password_one="")):($scope.msg_password_one="请输入密码",$scope.msg_password="",$scope.msg_success=""):2==d&&($scope.password_again?$scope.password_one!=$scope.password_again?($scope.msg_success="",$scope.msg_password_one="",$scope.msg_password="两次输入的密码不一致"):$scope.password_one==$scope.password_again&&($scope.msg_password="",$scope.msg_password_one="",$scope.msg_success="密码正确",$scope.password=$scope.password_one):($scope.msg_success="",$scope.msg_password_one="",$scope.msg_password="请输入密码"))},$scope.submit=function(){if($scope.password){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,timestamp:$scope.timestamp,name:$scope.name,mobile:$scope.mobile,password:$scope.password,role:$scope.role_sale,signature:$rootScope.encryptByDES($scope.email+$scope.password+$scope.timestamp)};console.log(m_params),$http({url:api_uri+"p/user/update/"+$stateParams.id,method:"POST",params:m_params}).success(function(d){0==d.returnCode&&$state.go("super.manage")}).error(function(d){})}else alert("没有输入密码或两次密码不一致")}});var teamCtrl=angular.module("teamCtrl",[]);teamCtrl.controller("TeamCtrl",function($http,$scope,$state,$rootScope,$location){$scope.edit_team_input=[],$scope.teamName="",$scope.list=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"zrh/group/listGroup",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($scope.page=d.result,$scope.team_list=d.result):console.log(d)}).error(function(d){})},$scope.list(),$scope.edit_team=function(id,index,name){$scope.teamName=name;for(var i=0;i<$scope.edit_team_input.length;i++)$scope.edit_team_input[i]=!1;$scope.edit_team_input[index]=!0},$scope.editTeam=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.teamName,groupId:id};console.log(m_params),$.ajax({type:"POST",url:api_uri+"zrh/group/updateGroup",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){if(0==data.returnCode){$scope.list();for(var i=0;i<$scope.edit_team_input.length;i++)$scope.edit_team_input[i]=!1;$scope.name=""}else 1003==data.returnCode?alert("用户分组不存在"):console.log(data)},dataType:"json"})},$scope.addTeam=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.name};$.ajax({type:"POST",url:api_uri+"zrh/group/addGroup",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($scope.list(),$scope.$apply()):console.log(data)},dataType:"json"})},$scope.deleteTeam=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,groupId:id};console.log(m_params),$http({url:api_uri+"zrh/group/deleteGroup",method:"GET",params:m_params}).success(function(d){if(0==d.returnCode){$scope.list();for(var i=0;i<$scope.edit_team_input.length;i++)$scope.edit_team_input[i]=!1;$scope.name=""}else 1003==d.returnCode?alert("分组不存在"):console.log(d)}).error(function(d){})},$scope.find_detail=function(id){$location.path("super/team/members/"+id)}}),teamCtrl.controller("MembersCtrl",function($http,$scope,$rootScope,$stateParams){$scope.member_list_get=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,groupId:$stateParams.id};$http({url:api_uri+"zrh/group/listUserByGroup",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode?($scope.page=d.result,$scope.member_list=d.result,$scope.ids=[]):console.log(d)}).error(function(d){$location.path("/error")})},$scope.member_list_get(),$scope.person_list_get=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,groupId:$stateParams.id};$http({url:api_uri+"zrh/group/listUserOutGroup",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode?($scope.page=d.result,$scope.person_list=d.result,$scope.ids=[]):console.log(d)}).error(function(d){$location.path("/error")})},$scope.person_list_get(),$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&($scope.ids.push(id),console.log($scope.ids)),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1),console.log($scope.ids)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.addToTeam=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,groupId:$stateParams.id,uids:$scope.ids};$.ajax({type:"POST",url:api_uri+"zrh/group/addUserToGroup",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode?($scope.member_list_get(),$scope.person_list_get(),$scope.$apply()):1003==data.returnCode&&1==data.result.errorCode?alert("添加失败"):1003==data.returnCode&&1001==data.result.errorCode?alert("已经有分组"):console.log(data)},dataType:"json"})},$scope.deleteFromTeam=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,groupId:$stateParams.id,uids:$scope.ids};console.log(m_params),$.ajax({type:"POST",url:api_uri+"zrh/group/removeUserFromGroup",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($scope.member_list_get(),$scope.person_list_get(),$scope.$apply()):1003==data.returnCode&&1003==data.result.errorCode?alert("用户不再该分组"):console.log(data)},dataType:"json"})}});var signUpCtrl=angular.module("signUpCtrl",[]);signUpCtrl.controller("SignUpCtrl",function($http,$scope,$rootScope,$location,$timeout,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd};$http({url:api_uri+"p/user/listUsers",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)}});var bankCtrl=angular.module("bankCtrl",[]);bankCtrl.controller("BankCtrl",function($http,$scope,$state,$rootScope,$location){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"manage/bank/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.bank_list=d.result.datas)}).error(function(d){$location.path("/error")})},$scope.list(1,100),$scope.edit_bank=function(id){$location.path("/super/bank/update/"+id)},$scope["delete"]=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id};$http({url:api_uri+"manage/bank/delete",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&$scope.list(1,20)}).error(function(d){})},$scope.find_detail=function(id,name){$state.go("super.bank.bank_man",{id:id,name:name})}}),bankCtrl.controller("BankManCtrl",function($http,$scope,$rootScope,$location,$stateParams,$state){$scope.selected=[],$scope.ids=[],$scope.id=$stateParams.id,$scope.bankName=$stateParams.name,$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,bankId:$stateParams.id};$http({url:api_uri+"manage/bank/user/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.bank_man_list=d.result.datas)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope["delete"]=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids,bankId:$scope.id};$.ajax({type:"POST",url:api_uri+"manage/bank/user/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,20)},error:function(data,textStatus,jqXHR){},dataType:"json"})},$scope.delete_one=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:id,bankId:$scope.id};$.ajax({type:"POST",url:api_uri+"manage/bank/user/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,20)},error:function(data,textStatus,jqXHR){},dataType:"json"})},$scope.add_user=function(id,name){$state.go("super.bank.add_bank_man",{id:id,name:name})},$scope.edit_bank_man=function(id,name){$state.go("super.bank.update_bank_man",{id:id,name:name})}}),bankCtrl.controller("AddBankCtrl",function($http,$scope,$rootScope,$state){$scope.init=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"qiniu/getUpToken",method:"GET",params:m_params}).success(function(d){if(0==d.returnCode){$scope.qiniu_token=d.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){$rootScope.uploading=!0,$scope.upload_percent=file.percent,$rootScope.$apply()},UploadProgress:function(up,file){$scope.upload_percent=file.percent,$scope.$apply()},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$scope.bankPic=file_url,$scope.$apply(),m_params.key="bankPic",m_params.value=$scope.bankPic},Error:function(up,err,errTip){$rootScope.alert("营业执照上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="financialProductManage/create/"+m_params.userId+"/"+time;return k}}})}}).error(function(d){})},$scope.init(),$scope.submitAdd=function(){$scope.feature_list_new=[],$scope.condition_list_new=[];for(var key in $scope.feature_list)$scope.feature_list_new.push($scope.feature_list[key].feature);for(var key in $scope.condition_list)$scope.condition_list_new.push($scope.condition_list[key].condition);var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.name,icon:$scope.bankPic};$.ajax({type:"POST",url:api_uri+"manage/bank/add",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($state.go("super.bank"),$scope.$apply())},dataType:"json"})}}),bankCtrl.controller("UpdateBankCtrl",function($http,$scope,$rootScope,$state,$stateParams){$scope.detail=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"manage/bank/detail/"+$stateParams.id,method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.bankEdit="编辑银行",$scope.bank=d.result,$scope.name=d.result.name,$scope.bankPic=d.result.icon)}).error(function(d){})},$scope.detail(),$scope.init=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"qiniu/getUpToken",method:"GET",params:m_params}).success(function(d){if(0==d.returnCode){$scope.qiniu_token=d.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},
BeforeUpload:function(up,file){$rootScope.uploading=!0,$scope.upload_percent=file.percent,$rootScope.$apply()},UploadProgress:function(up,file){$scope.upload_percent=file.percent,$scope.$apply()},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$scope.bankPic=file_url,$scope.$apply(),m_params.key="bankPic",m_params.value=$scope.bankPic},Error:function(up,err,errTip){$rootScope.alert("营业执照上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="financialProductManage/create/"+m_params.userId+"/"+time;return k}}})}}).error(function(d){})},$scope.init(),$scope.update=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.name,icon:$scope.bankPic,id:id};$.ajax({type:"POST",url:api_uri+"manage/bank/update/"+$stateParams.id,data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($state.go("super.bank"),$scope.$apply())},dataType:"json"})}}),bankCtrl.controller("AddBankManCtrl",function($http,$scope,$rootScope,$state,$stateParams,$location,$timeout){$scope.selected=[],$scope.ids=[],$scope.names=[],$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,bankId:$stateParams.id,pageNo:pageNo,pageSize:pageSize,release:!0};$http({url:api_uri+"financialProductManage/list",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result,$scope.product_list=d.result.datas)}).error(function(d){})},$scope.list(1,100),$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id,name){if("add"==action&&($scope.ids.push(id),$scope.names.push(name)),"remove"==action){var idx=$scope.ids.indexOf(id),name_x=$scope.names.indexOf(name);$scope.ids.splice(idx,1),$scope.names.splice(name_x,1)}};$scope.updateSelection=function($event,id,name){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id,name)},$scope.add_bank_man=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.bank_man.name,bankId:$stateParams.id,branchBankName:$scope.bank_man.branchBankName,address:$scope.bank_man.address,position:$scope.bank_man.position,productIds:$scope.ids,mobile:$scope.bank_man.mobile,email:$scope.bank_man.email};console.log(m_params),$.ajax({type:"POST",url:api_uri+"manage/bank/user/add",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode&&($state.go("super.bank.bank_man",{id:m_params.bankId}),$scope.$apply())},dataType:"json"})},$scope.go_back=function(){window.history.go(-1)},$scope.show_product=function(){$scope.productDiv=!0},$scope.hide_product=function(){$scope.products="";for(var i=0;i<$scope.names.length;i++)$scope.products+=$scope.names[i],$scope.products+=" ";$scope.productDiv=!1}}),bankCtrl.controller("UpdateBankManCtrl",function($http,$scope,$rootScope,$state,$stateParams,$location,$timeout){$scope.selected=[],$scope.ids=[],$scope.names=[],$scope.detail=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"manage/bank/user/detail/"+$stateParams.id,method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.bank_man=d.result,$scope.bank_man_title="修改银行职员",$scope.products="",$scope.list(1,100))}).error(function(d){})},$scope.detail(),$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,bankId:$scope.bank_man.bankId,pageNo:pageNo,pageSize:pageSize,release:!0};$http({url:api_uri+"financialProductManage/list",method:"GET",params:m_params}).success(function(d){if(0==d.returnCode){$scope.page=d.result,$scope.product_list=d.result.datas;for(var i=0;i<$scope.bank_man.productIds.length;i++)for(var j=0;j<$scope.product_list.length;j++)$scope.bank_man.productIds[i]==$scope.product_list[j].id&&($scope.names.push($scope.product_list[j].name),$scope.ids.push($scope.product_list[j].id));$scope.products="";for(var i=0;i<$scope.names.length;i++)$scope.products+=$scope.names[i],$scope.products+=" "}}).error(function(d){})},$scope.isSelected=function(id){return $scope.bank_man.productIds.indexOf(id)>=0};var updateSelected=function(action,id,name){if("add"==action&&($scope.ids.push(id),$scope.names.push(name)),"remove"==action){var idx=$scope.ids.indexOf(id),name_x=$scope.names.indexOf(name);$scope.ids.splice(idx,1),$scope.names.splice(name_x,1)}};$scope.updateSelection=function($event,id,name){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id,name)},$scope.add_bank_man=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.bank_man.name,bankId:$scope.bank_man.bankId,branchBankName:$scope.bank_man.branchBankName,address:$scope.bank_man.address,position:$scope.bank_man.position,productIds:$scope.ids,mobile:$scope.bank_man.mobile,email:$scope.bank_man.email};$.ajax({type:"POST",url:api_uri+"manage/bank/user/update/"+$stateParams.id,data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode&&($state.go("super.bank.bank_man",{id:m_params.bankId}),$scope.$apply())},dataType:"json"})},$scope.show_product=function(){$scope.productDiv=!0},$scope.hide_product=function(){$scope.products="";for(var i=0;i<$scope.names.length;i++)$scope.products+=$scope.names[i],$scope.products+=" ";$scope.productDiv=!1},$scope.go_back=function(){window.history.go(-1)}});var loanApplicationCtrl=angular.module("loanApplicationCtrl",[]);loanApplicationCtrl.controller("LoanApplicationCtrl",function($http,$state,$scope,$stateParams,$rootScope,$location){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$stateParams.wd,status:$stateParams.status};$http({url:api_uri+"loanApplicationManage/pool",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($scope.page=d.result,$scope.result_list=d.result.datas,angular.forEach($scope.result_list,function(data){0==data.status?(data.progressText="未申请",data.color=1):1==data.status?(data.progressText="准备中",data.color=2):2==data.status?(data.progressText="下户",data.color=2):3==data.status?(data.progressText="审批中",data.color=2):4==data.status?(data.progressText="审批通过",data.color=2):5==data.status?(data.progressText="开户",data.color=2):6==data.status?(data.progressText="放款",data.color=2):7==data.status&&(data.progressText="完成融资",data.color=3)})):console.log(d)}).error(function(d){$location.path("/error")})},$scope.list($stateParams.page,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope["delete"]=function(){var scroll=$(".line-roll").scrollTop(),m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($(".line-roll").scrollTop(scroll),$scope.list($scope.pageNo1,20))},dataType:"json"})},$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="准备中":2==$scope.status?$scope.status_text="下户":3==$scope.status?$scope.status_text="审批中":4==$scope.status?$scope.status_text="审批通过":5==$scope.status?$scope.status_text="开户":6==$scope.status?$scope.status_text="放款":7==$scope.status?$scope.status_text="成功融资":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)}}),loanApplicationCtrl.controller("AddCompanyCtrl",function($http,$scope,$rootScope,$state){$scope.submitMessage=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,company_name:$scope.basic.company_name,legal_representative:$scope.basic.legal_representative,register_date:$scope.basic.register_date,registered_capital:$scope.basic.registered_capital,officeAddress:$scope.basic.officeAddress,business_address:$scope.basic.business_address,item_category:$scope.basic.item_category,business_type:$scope.basic.business_type,business_scope:$scope.basic.business_scope,linkmanName:$scope.basic.linkmanName,linkmanMobile:$scope.basic.linkmanMobile,continual:$scope.basic.continual};console.log(m_params),m_params.company_name?$.ajax({type:"POST",url:api_uri+"inforTemplate/create",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode?($state.go("admin.company_message"),$scope.$apply()):1001==data.returnCode?alert("该公司信息已经存在"):console.log(data)},dataType:"json"}):alert("公司名称必填")}});var saleManagerCtrl=angular.module("saleManagerCtrl",[]);saleManagerCtrl.controller("SaleManagerCtrl",function($http,$scope,$state,$rootScope,$location){$scope.list_show=!0,$scope.list=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"zrh/group/listOtherFromGroup",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($scope.user_list=d.result,angular.forEach($scope.user_list,function(data){"admin"==data.role?data.position="销售人员":"manager"==data.role?data.position="销售主管":"super"==data.role&&(data.position="超级管理员")})):1003==d.returnCode?alert("该用户没有分组"):console.log(d)}).error(function(d){})},$scope.list(),$scope.list_company=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,wd:$scope.wd};$http({url:api_uri+"zrh/group/listApplyInGroup",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode?($scope.company_list=d.result.datas,console.log($scope.company_list)):1003==d.returnCode?alert("该用户没有分组"):console.log(d)}).error(function(d){})},$scope.$watch("search_text",function(newValue,oldValue){newValue||($scope.list_show=!0)}),$scope.search=function(){$scope.wd=$scope.search_text,$scope.list_show=!1,$scope.list_company()},$scope.cancel=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"p/user/removeSaleFromGroup",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($scope.ids=[],$scope.list()):console.log(data)},dataType:"json"})},$scope.showDetail=function(id){$state.go("admin.user_list.sale_apply_list",{id:id})}}),saleManagerCtrl.controller("SaleApplyListCtrl",function($http,$scope,$state,$rootScope,$location,$stateParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,uid:$stateParams.id,pageNo:pageNo,pageSize:pageSize,status:$scope.status};$http({url:api_uri+"applyDeal/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($scope.page=d.result.list,$scope.result_list=d.result.list.datas,$scope.count=d.result.count,$scope.userName=d.result.userName,angular.forEach($scope.result_list,function(data){$scope.status=d.result.status,0==data.status?(data.progressText="未申请",data.color=1):1==data.status?(data.progressText="准备中",data.color=2):2==data.status?(data.progressText="下户",data.color=2):3==data.status?(data.progressText="审批中",data.color=2):4==data.status?(data.progressText="审批通过",data.color=2):5==data.status?(data.progressText="下户",data.color=2):6==data.status?(data.progressText="放款",data.color=2):7==data.status?(data.progressText="成功融资",data.color=3):data.status==-1&&(data.progressText="申请取消",data.color=1)})):console.log(d)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.status_text="全部",$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="申请中":2==$scope.status?$scope.status_text="约见中":3==$scope.status?$scope.status_text="跟进中":4==$scope.status?$scope.status_text="成功融资":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.updateApply=function(id){$state.go("admin.my_project.detail",{id:id})},$scope.go_sale_manage=function(){$state.go("admin.user_list")}});var myProjectCtrl=angular.module("myProjectCtrl",[]);myProjectCtrl.controller("MyProjectCtrl",function($http,$scope,$state,$rootScope,$location,$stateParams){$scope.showCancel=!1,$scope.comments_give="",$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd,status:$scope.status};$http({url:api_uri+"applyDeal/list",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode?($scope.pages=d.result.list,$scope.result_list=d.result.list.datas,$scope.count=d.result.count,$scope.userName=d.result.userName,angular.forEach($scope.result_list,function(data){0==data.status?(data.progressText="未申请",data.color=1):1==data.status?(data.progressText="准备中",data.color=2):2==data.status?(data.progressText="下户",data.color=2):3==data.status?(data.progressText="审批中",data.color=2):4==data.status?(data.progressText="审批通过",data.color=2):5==data.status?(data.progressText="下户",data.color=2):6==data.status?(data.progressText="放款",data.color=2):7==data.status?(data.progressText="成功融资",data.color=3):data.status==-1&&(data.progressText="申请取消",data.color=1)})):console.log(d)}).error(function(d){console.log(d)})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.status_text="全部",$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="准备中":2==$scope.status?$scope.status_text="下户":3==$scope.status?$scope.status_text="审批中":4==$scope.status?$scope.status_text="审批通过":5==$scope.status?$scope.status_text="开户":6==$scope.status?$scope.status_text="放款":7==$scope.status?$scope.status_text="成功融资":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)},$scope.show_cancel=function(){$scope.showCancel=!0},$scope.hide_cancel=function(){$scope.showCancel=!1},$scope.giveUp=function(){var scroll=$(".line-roll").scrollTop(),m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids,c:$scope.comments_give};console.log(m_params),0==m_params.ids.length?alert("没有选择项目"):""==m_params.c?alert("必须填写放弃原因"):$.ajax({type:"GET",url:api_uri+"loanApplicationManage/giveUp",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){if(console.log(data),0==data.returnCode&&($scope.ids=[],$(".line-roll").scrollTop(scroll),$scope.list($scope.pageNo1,20),$scope.hide_cancel(),$scope.code_list=data.result,$scope.code_list))for(var i=0;i<$scope.code_list.length;i++)10002==$scope.code_list[i].code?alert($scope.code_list[i].name+"，你已经选择了销售职员，所以不可以放弃项目，如果要放弃，请选择自己为销售职员"):10001==$scope.code_list[i].code?alert("申请不存在,请刷新页面"):($rootScope.successMsg="操作成功",$rootScope.fadeInOut("#alert",500))},dataType:"json"})}});var channelCtrl=angular.module("channelCtrl",[]);channelCtrl.controller("ChannelCtrl",function($http,$scope,$state,$rootScope,$location,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"wxShare/manager/customerList",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($scope.page=d.result,void 0!=d.result&&($scope.user_list=d.result.datas)):console.log(d)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.cancel=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"p/user/cancelCustomer",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($scope.ids=[],$scope.list($scope.pageNo1,10))},dataType:"json"})},$scope.showDetail=function(id){$state.go("admin.channel.detail",{id:id})},$scope.add_channel_man=function(){$state.go("admin.channel.create")}}),channelCtrl.controller("CreateCtrl",function($http,$scope,$state,$rootScope,$location,$routeParams){$scope.submit=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.username,mobile:$scope.phone};console.log(m_params),$.ajax({type:"POST",url:api_uri+"p/user/addCustomer",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($state.go("admin.channel"),$rootScope.successMsg="添加成功",$rootScope.fadeInOut("#alert",500),$scope.$apply()):1002==data.returnCode?alert("该用户已经有上级，或者是最高级别用户，不可以添加"):1003==data.returnCode?alert("此手机号尚未注册，暂不能使用"):1004==data.returnCode?alert("该用户已经被分配"):console.log(data)},dataType:"json"})}}),channelCtrl.controller("ChannelDetailCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd,status:$scope.status,uid:$stateParams.id};$http({url:api_uri+"wxShare/manager/customerApplyList",method:"GET",params:m_params}).success(function(d){0==d.returnCode?(console.log(d),$scope.name=d.result.name,$scope.page=d.result.pagination,$scope.result_list=d.result.pagination.datas,angular.forEach($scope.result_list,function(data){0==data.status?(data.progressText="未申请",data.color=1):1==data.status?(data.progressText="准备中",data.color=2):2==data.status?(data.progressText="下户",data.color=2):3==data.status?(data.progressText="审批中",data.color=2):4==data.status?(data.progressText="审批通过",data.color=2):5==data.status?(data.progressText="下户",data.color=2):6==data.status?(data.progressText="放款",data.color=2):7==data.status?(data.progressText="成功融资",data.color=3):data.status==-1&&(data.progressText="申请取消",data.color=1)})):console.log(d)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="准备中":2==$scope.status?$scope.status_text="下户":3==$scope.status?$scope.status_text="审批中":4==$scope.status?$scope.status_text="审批通过":5==$scope.status?$scope.status_text="开户":6==$scope.status?$scope.status_text="放款":7==$scope.status?$scope.status_text="成功融资":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)},$scope.addApply=function(){$state.go("admin.channel.add_apply",{id:$stateParams.id})},$scope.history=function(){$state.go("admin.channel.history",{id:$stateParams.id})},$scope.go_back_channel=function(){$state.go("admin.channel")},$scope.updateApply=function(id){$state.go("admin.my_project.detail",{id:id})}}),channelCtrl.controller("AddApplyCtrl",function($http,$scope,$state,$rootScope,$location,$stateParams){$scope.getApply=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,companyName:$scope.companyName};$http({url:api_uri+"loanApplicationManage/listByCompanyName",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas)}).error(function(d){})},$scope.choice_product=function(id,name){$scope.productId=id,$scope.productName=name},$scope.submit=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$scope.productId,uid:$stateParams.id};console.log(m_params),$.ajax({type:"POST",url:api_uri+"loanApplicationManage/addChannel",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($scope.back(),$rootScope.successMsg="绑定成功",$rootScope.fadeInOut("#alert",500),$scope.$apply()):1003==data.returnCode?alert("用户不存在或申请不存在"):1004==data.returnCode?alert("参数错误"):console.log(data)},dataType:"json"})},$scope.back=function(){$state.go("admin.channel.detail",{id:$stateParams.id})}}),channelCtrl.controller("HistoryCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,uid:$stateParams.id};$http({url:api_uri+"/loanApplicationManage/historyList",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas,angular.forEach($scope.result_list,function(data){$scope.status=d.result.status,0==data.status?data.progressText="未申请":1==data.status?(data.progressText="申请中",data.progressBtn="开始约见"):2==data.status?(data.progressText="约见中",data.progressBtn="继续跟进"):3==data.status?(data.progressText="跟进中",data.progressBtn="完成贷款"):4==data.status?(data.progressText="成功融资",data.progressBtn="已结束"):data.status==-1&&(data.progressText="申请取消")}))}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.ids=[],$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.goBackDetail=function(){$state.go("admin.channel.detail",{id:$stateParams.id})},$scope.change_register=function(id){$state.go("admin.channel.change",{id:$stateParams.id,idt:id})}}),channelCtrl.controller("ChangeCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.change=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.idt,mobile:$scope.phone};$.ajax({type:"POST",url:api_uri+"/loanApplicationManage/changeMobile",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($scope.back_channel(),$rootScope.successMsg="变更成功",$rootScope.fadeInOut("#alert",500),$scope.$apply()):1002==data.returnCode?alert("该申请已经处理过了"):1003==data.returnCode?alert("申请不存在"):alert("未知错误")},dataType:"json"})},$scope.back_channel=function(){$state.go("admin.channel.history",{id:$stateParams.id})}});var shareCtrl=angular.module("shareCtrl",[]);shareCtrl.controller("ShareCtrl",function($http,$scope,$state,$rootScope,$location,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"wxShare/manager/userList",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($scope.page=d.result,$scope.user_list=d.result.datas):console.log(d)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.remark=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"p/user/toCustomer",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode?($scope.list($scope.pageNo1,10),$scope.ids=[]):console.log(data)},dataType:"json"})},$scope.showDetail=function(id){$state.go("admin.share.share_detail",{id:id})}}),shareCtrl.controller("ShareDetailCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,uid:$stateParams.id,wd:$scope.wd,status:$scope.status};$http({url:api_uri+"wxShare/manager/applyList",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($scope.name=d.result.name,$scope.page=d.result.pagination,$scope.result_list=d.result.pagination.datas,angular.forEach($scope.result_list,function(data){0==data.status?(data.progressText="未申请",data.color=1):1==data.status?(data.progressText="准备中",data.color=2):2==data.status?(data.progressText="下户",data.color=2):3==data.status?(data.progressText="审批中",data.color=2):4==data.status?(data.progressText="审批通过",data.color=2):5==data.status?(data.progressText="下户",data.color=2):6==data.status?(data.progressText="放款",data.color=2):7==data.status?(data.progressText="成功融资",data.color=3):data.status==-1&&(data.progressText="申请取消",data.color=1)})):console.log(d)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="准备中":2==$scope.status?$scope.status_text="下户":3==$scope.status?$scope.status_text="审批中":4==$scope.status?$scope.status_text="审批通过":5==$scope.status?$scope.status_text="开户":6==$scope.status?$scope.status_text="放款":7==$scope.status?$scope.status_text="成功融资":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)},$scope.cancel=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"p/user/cancelCustomer",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($scope.ids=[],$scope.list($scope.pageNo1,10))},dataType:"json"})},$scope.updateApply=function(id){$state.go("admin.my_project.detail",{id:id})},$scope.go_back_share=function(){$state.go("admin.share")}});var messageCtrl=angular.module("messageCtrl",[]);messageCtrl.controller("MessageBankCtrl",function($http,$scope,$rootScope,$location,$timeout,$state){$scope.bank_list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"applyBankDeal/manage/list",method:"GET",params:m_params}).success(function(d){console.log(d),$scope.id_arr=[],$scope.message_list=[],$scope.message_list_old=d.result.datas;for(var i=0;i<$scope.message_list_old.length;i++)$scope.id_arr.indexOf($scope.message_list_old[i].applyId)==-1&&($scope.id_arr.push($scope.message_list_old[i].applyId),$scope.message_list.push($scope.message_list_old[i]));console.log($scope.id_arr),console.log($scope.message_list),angular.forEach($scope.message_list,function(data){data.dayNum="",1==data.status?(data.progressText="准备中",data.jindu_success=15):2==data.status?(data.progressPro="准备中",data.progressText="下户",data.jindu=15,data.jindu_next=10,data.jindu_success=25):3==data.status?(data.progressPro="下户",data.progressText="审批中",data.jindu=25,data.jindu_next=15,data.jindu_success=40):4==data.status?(data.progressPro="审批中",data.progressText="审批通过",data.jindu=40,data.jindu_next=15,data.jindu_success=55):5==data.status?(data.progressPro="审批通过",data.progressText="开户",data.jindu=55,data.jindu_next=15,data.jindu_success=70):6==data.status?(data.progressPro="开户",data.progressText="放款",data.jindu=70,data.jindu_next=15,data.jindu_success=85):7==data.status?(data.progressText="成功融资",data.jindu=100,data.jindu_success=100):data.status==-1&&(data.progressText="申请取消")})}).error(function(d){})},$scope.bank_list(1,100),$scope.statusPro="",$scope.showAllow=[],$scope.showRefuse=[],$scope.show_allow=function(status,id,type){if($scope.showAllow=[],0==type){$scope.showAllow[id]=!0,$scope.status=status,2==status?($scope.statusPro="准备中",$scope.statusText="下户"):3==status?($scope.statusPro="下户",$scope.statusText="审批中"):4==status?($scope.statusPro="审批中",$scope.statusText="审批通过"):5==status?($scope.statusPro="审批通过",$scope.statusText="开户"):6==status?($scope.statusPro="审批通过",$scope.statusText="放款"):7==status&&($scope.statusPro="放款",$scope.statusText="成功融资");for(var i=0;i<$scope.showRefuse.length;i++)$scope.showRefuse[i]=!1}else{$scope.showRefuse[id]=!0;for(var j=0;j<$scope.showAllow.length;j++)$scope.showAllow[j]=!1}},$scope.choiceStatus=function(status){$scope.status=status,2==status?$scope.statusText="下户":3==status?$scope.statusText="审批中":4==status?$scope.statusText="审批通过":5==status?$scope.statusText="开户":6==status?$scope.statusText="放款":7==status&&($scope.statusText="成功融资")},$scope.cancel=function(id){$scope.showAllow[id]=!1,$scope.showRefuse[id]=!1},$scope.closeAlert=function(name,$event){$scope.change_alert=!1,$scope.stopPropagation&&$event.stopPropagation()},$scope.cancel_alert=function(){$scope.change_alert=!1},$scope.change_alert=!1,$scope.stop_alert=function(id){$scope.stop_alert_id=id,$scope.change_alert=!0},$scope.allow=function(dayNum,id,index){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,status:$scope.status,dayNum:dayNum,id:id};console.log(m_params),$http({url:api_uri+"applyBankDeal/manage/allow",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($rootScope.successMsg="通过已发送",$rootScope.fadeInOut("#alert",500),
$scope.showAllow[index]=!1,$scope.bank_list(1,100),$rootScope.message(),$scope.$apply()):1002==d.returnCode&&"abd"==d.errorString?(alert("这条操作已经操作过了"),console.log(d)):1002==d.returnCode&&"la"==d.errorString?(alert("申请的状态错误"),console.log(d)):(alert(d),console.log(d))}).error(function(d){})},$scope.change_status=function(dayNum,id,index){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,status:$scope.status,days:dayNum,id:id};console.log(m_params),$.ajax({type:"POST",url:api_uri+"loanApplicationManage/modifyRate",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?(console.log(data),$rootScope.successMsg="已经修改进度",$rootScope.fadeInOut("#alert",500),$scope.showAllow[index]=!1,$scope.bank_list(1,100)):console.log(data)},dataType:"json"})},$scope.refuse=function(id,index){$scope.reason_refuse=$("#reason_refuse").val();var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id,reason:$scope.reason_refuse};$http({url:api_uri+"applyBankDeal/manage/refuse",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($rootScope.successMsg="驳回已发送",$rootScope.fadeInOut("#alert",500),$scope.showRefuse[index]=!1,$scope.bank_list(1,100),$rootScope.message(),$scope.$apply()):1002==d.returnCode&&"abd"==d.result?alert("这条操作已经操作过了"):1002==data.returnCode&&"la"==d.result?alert("申请的状态错误"):alert("未知错误")}).error(function(d){})},$scope["continue"]=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id};console.log(m_params),$.ajax({type:"POST",url:api_uri+"applyBankDeal/manage/follow",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?(console.log(data),$rootScope.successMsg="继续项目",$rootScope.fadeInOut("#alert",500),$scope.bank_list(1,100)):console.log(data)},dataType:"json"})},$scope.stopped=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:$scope.stop_alert_id};console.log(m_params),$.ajax({type:"POST",url:api_uri+"applyBankDeal/manage/stopped",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?(console.log(data),$rootScope.successMsg="已经中止项目",$rootScope.fadeInOut("#alert",500),$scope.bank_list(1,100)):console.log(data)},dataType:"json"})},$scope.change_to_bank=function(id){$state.go("admin.my_project.change_bank",{id:id,page:1,scroll:0})},$scope.stopped_person=function(dayNum,id,index){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id};console.log(m_params),$.ajax({type:"POST",url:api_uri+"loanApplicationManage/stopped",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?(console.log(data),$rootScope.successMsg="继续项目",$rootScope.fadeInOut("#alert",500),$scope.bank_list(1,100)):console.log(data)},dataType:"json"})}}),messageCtrl.controller("MessageSystemCtrl",function($http,$scope,$rootScope,$location,$timeout,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"zrh/message/lists",method:"GET",params:m_params}).success(function(d){console.log(d),$scope.page=d.result,$scope.result_list=d.result.datas}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.to_company_message=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id};$http({url:api_uri+"zrh/message/details",method:"GET",params:m_params}).success(function(d){console.log(d)}).error(function(d){})}}),api_uri="http://test.zhironghao.com/api/";var templates_root="templates/";deskey="abc123.*abc123.*abc123.*abc123.*";var app=angular.module("app",["ng","ngRoute","ngAnimate","ui.router","loginCtrl","topBarCtrl","applyListCtrl","loanApplicationCtrl","productCtrl","myProjectCtrl","saleManagerCtrl","manageCtrl","teamCtrl","signUpCtrl","bankCtrl","channelCtrl","shareCtrl","messageCtrl"],function($httpProvider){$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",$httpProvider.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var param=function(obj){var name,value,fullSubName,subName,subValue,innerObj,i,query="";for(name in obj)if(value=obj[name],value instanceof Array)for(i=0;i<value.length;++i)subValue=value[i],fullSubName=name+"["+i+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else if(value instanceof Object)for(subName in value)subValue=value[subName],fullSubName=name+"["+subName+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else void 0!==value&&null!==value&&(query+=encodeURIComponent(name)+"="+encodeURIComponent(value)+"&");return query.length?query.substr(0,query.length-1):query};$httpProvider.defaults.transformRequest=[function(data){return angular.isObject(data)&&"[object File]"!==String(data)?param(data):data}]});app.run(function($location,$rootScope,$timeout,$http){$rootScope.isOpenMenu=!0,$rootScope.qiniu_bucket_domain="o793l6o3p.bkt.clouddn.com",$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){var present_route=toState.name;if(present_route.indexOf("admin.my_project.detail")>-1){var from_route=fromState.name;if(""!=from_route&&from_route.indexOf("admin.my_project.edit_apply")<=-1&&from_route.indexOf("admin.my_project.change_register")<=-1&&from_route.indexOf("admin.my_project.change_bank")<=-1&&from_route.indexOf("admin.my_project.distribute")<=-1&&from_route.indexOf("admin.my_project.apply_help")<=-1&&from_route.indexOf("admin.my_project.message")<=-1&&from_route.indexOf("admin.my_project.choice_sale")<=-1&&from_route.indexOf("admin.company_message.detail")<=-1){if($rootScope.putSessionObject("from_route",from_route),fromParams.id){var arrayParams=from_route.split("."),from_route2="/"+arrayParams[0]+"/"+arrayParams[1]+"/"+arrayParams[2]+"/";"edit_apply"!=arrayParams[2]&&$rootScope.putSessionObject("from_route2",from_route2);var from_params=fromParams.id;$rootScope.putSessionObject("from_params",from_params)}}else{$rootScope.getSessionObject("from_route")}}var array=present_route.split(".");$rootScope.choiceColor=array[1],"message"==array[1]?($rootScope.sideTwo=!0,$rootScope.isOpenMenu=!1,$rootScope.choiceColorTwo=array[2]):($rootScope.sideTwo=!1,$rootScope.isOpenMenu||$rootScope.openMenu())}),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){var present_route=toState.name;$rootScope.arrayParams=present_route.split("."),"/login"!=$location.$$path?($rootScope.check_user(),$timeout(function(){$rootScope.login_user||$location.path("/login")},500)):$location.path("/login")}),$rootScope.encryptByDES=function(message){var keyHex=CryptoJS.enc.Utf8.parse(deskey),encrypted=CryptoJS.DES.encrypt(message,keyHex,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return encrypted.toString()},$rootScope.decryptByDES=function(ciphertext){var keyHex=CryptoJS.enc.Utf8.parse(deskey),decrypted=CryptoJS.DES.decrypt({ciphertext:CryptoJS.enc.Base64.parse(ciphertext)},keyHex,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return decrypted.toString(CryptoJS.enc.Utf8)},$rootScope.refresh=function(){location.reload()},$rootScope.transFn=function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&").toString()},$rootScope.fadeInOut=function(elem,speed){$(elem).fadeIn(speed),setTimeout(function(){$(elem).fadeOut(speed)},3e3)},$rootScope.openMenu=function(){$(".side-menu-1").css("animation","open .4s"),$(".content").css("animation","small-content-width .4s"),$(".content-two").css("animation","small-width .4s"),$rootScope.isOpenMenu=!0},$rootScope.closeMenu=function(){$(".side-menu-1").css("animation","close .4s"),$(".content-open").css("animation","big-content-width .4s"),$(".content-two").css("animation","big-width .4s"),$rootScope.isOpenMenu=!1},$rootScope.change_alert=function($event){$event.stopPropagation()},$rootScope.url_detail="http://testmanager.zhironghao.com/home/apps/html/zrh_manager/detail.html#/apply/detail/",$rootScope.putObject=function(key,value){localStorage.setItem(key,angular.toJson(value))},$rootScope.getObject=function(key){return angular.fromJson(localStorage.getItem(key))},$rootScope.removeObject=function(key){localStorage.removeItem(key)},$rootScope.putSessionObject=function(key,value){sessionStorage.setItem(key,angular.toJson(value))},$rootScope.getSessionObject=function(key){return angular.fromJson(sessionStorage.getItem(key))},$rootScope.removeSessionObject=function(key){angular.fromJson(sessionStorage.removeItem(key))},$rootScope.getAccountInfo=function(){return $rootScope.account_info=={}&&($rootScope.account_info=$rootScope.putSessionObject("account_info")),$rootScope.account_info||($rootScope.account_info={}),$rootScope.account_info},$rootScope.setAccountInfo=function(account_info){$rootScope.account_info=account_info,$rootScope.putSessionObject("account_info",$rootScope.account_info)},$rootScope.updateAccountInfo=function(dict){$rootScope.account_info=$rootScope.getAccountInfo();for(var key in dict)$rootScope.account_info[key]=dict[key];$rootScope.putSessionObject("account_info",$rootScope.account_info)},$rootScope.setAccountInfoKeyValue=function(key,value){$rootScope.account_info=$rootScope.getAccountInfo(),$rootScope.account_info[key]=value,$rootScope.putSessionObject("account_info",$rootScope.account_info)},$rootScope.getAccountInfoKeyValue=function(key){return $rootScope.account_info!={}&&($rootScope.account_info=$rootScope.putSessionObject("account_info")),$rootScope.account_info?$rootScope.account_info[key]:null},$rootScope.check_user=function(){$rootScope.login_user=$rootScope.getObject("login_user"),$rootScope.login_user&&$http({url:api_uri+"p/user/validateAuth",method:"POST",params:$rootScope.login_user}).success(function(d){return 0==d.returnCode?($rootScope.check_role(),!0):($rootScope.login_user={},$rootScope.removeObject("login_user"),!1)}).error(function(d){return!1})},$rootScope.check_role=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"p/user/detail/"+$rootScope.login_user.userId,method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($rootScope.role=d.result.role,"super"==$rootScope.role?"super"==$rootScope.arrayParams[0]||$location.path("/login"):"admin"==$rootScope.role?"admin"==$rootScope.arrayParams[0]&&"user_list"==$rootScope.arrayParams[1]:"manager"==$rootScope.role&&("admin"==$rootScope.arrayParams[0]||console.log("lll")))}).error(function(d){})},$rootScope.message=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"zrh/index/message",method:"GET",params:m_params}).success(function(d){0==d.returnCode?$rootScope.count=d.result:console.log(d),$timeout(function(){$rootScope.message()},2e4)}).error(function(d){$timeout(function(){$rootScope.message()},2e4)})},$rootScope.bank_messages=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"applyBankDeal/manage/count",method:"GET",params:m_params}).success(function(d){0==d.returnCode?$rootScope.bank_message=d.result:console.log(d),$timeout(function(){$rootScope.bank_messages()},2e4)}).error(function(d){$timeout(function(){$rootScope.bank_messages()},2e4)})},$rootScope.system_messages=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"zrh/message/counts",method:"GET",params:m_params}).success(function(d){0==d.returnCode?$rootScope.system_message=d.result:console.log(d),$timeout(function(){$rootScope.system_messages()},2e4)}).error(function(d){$timeout(function(){$rootScope.system_messages()},2e4)})}}),app.animation(".fad-main",function(){return{enter:function(element,done){element.css({opacity:0,width:0}),element.animate({opacity:1,width:"100%"},500,done)},leave:function(element,done){element.css({opacity:1}),element.animate({opacity:0},500,done)}}}),app.animation(".fad",function(){return{enter:function(element,done){element.css({opacity:0}),element.animate({opacity:1},500,done)},leave:function(element,done){element.css({opacity:1}),element.animate({opacity:0},500,done)}}}),app.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/login"),$stateProvider.state("login",{url:"/login",views:{"":{templateUrl:templates_root+"login/index.html",controller:"LoginCtrl"}}}).state("super",{url:"/super",views:{"":{templateUrl:templates_root+"super/index.html"},"top_bar@super":{templateUrl:templates_root+"bar/top_bar.html",controller:"TopBarCtrl"},"side_bar@super":{templateUrl:templates_root+"bar/side_bar.html",controller:"SideBarCtrl"},"main@super":{templateUrl:templates_root+"super/main.html"}}}).state("super.apply_list",{url:"/apply_list",views:{"main@super":{templateUrl:templates_root+"super/product_service/apply_list/apply_list.html",controller:"ApplyListCtrl"}}}).state("super.manage",{url:"/manage",views:{"main@super":{templateUrl:templates_root+"super/product_service/manage/user_list.html",controller:"UserListCtrl"}}}).state("super.manage.addUser",{url:"/add_user",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/manage/add_user.html",controller:"CreateUserCtrl"}}}).state("super.manage.update",{url:"/update/:id",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/manage/add_user.html",controller:"UserUpdateCtrl"}}}).state("super.team",{url:"/team",views:{"main@super":{templateUrl:templates_root+"super/product_service/team/team.html",controller:"TeamCtrl"}}}).state("super.team.members",{url:"/members/:id",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/team/members.html",controller:"MembersCtrl"}}}).state("super.product",{url:"/product",views:{"main@super":{templateUrl:templates_root+"super/product_service/product/product.html",controller:"ProductCtrl"}}}).state("super.product.create",{url:"/create",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/product/create.html",controller:"ProductCreateCtrl"}}}).state("super.product.update",{url:"/update/:id",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/product/create.html",controller:"ProductUpdateCtrl"}}}).state("super.product.sort",{url:"/sort",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/product/sort.html",controller:"SortCtrl"}}}).state("super.bank",{url:"/bank",views:{"main@super":{templateUrl:templates_root+"super/product_service/bank/bank.html",controller:"BankCtrl"}}}).state("super.bank.bank_man",{params:{id:null,name:null},url:"/bank_man/:id/:name",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/bank/bank_man.html",controller:"BankManCtrl"}}}).state("super.bank.add_bank",{params:{id:null,name:null},url:"/add_bank/:id/:name",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/bank/add_bank.html",controller:"AddBankCtrl"}}}).state("super.bank.add_bank_man",{url:"/add_bank_man/:id/:name",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/bank/add_bank_man.html",controller:"AddBankManCtrl"}}}).state("super.bank.update",{url:"/update/:id",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/bank/add_bank.html",controller:"UpdateBankCtrl"}}}).state("super.bank.update_bank_man",{url:"/update_bank_man/:id/:name",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/bank/add_bank_man.html",controller:"UpdateBankManCtrl"}}}).state("super.signUp",{url:"/signUp",views:{"main@super":{templateUrl:templates_root+"super/product_service/sign_up/sign_up.html",controller:"SignUpCtrl"}}}).state("admin",{url:"/admin",views:{"":{templateUrl:templates_root+"admin/index.html"},"top_bar@admin":{templateUrl:templates_root+"bar/top_bar.html",controller:"TopBarCtrl"},"side_bar@admin":{templateUrl:templates_root+"bar/side_bar.html",controller:"SideBarCtrl"},"contains@admin":{templateUrl:templates_root+"admin/contains.html",controller:"ContainsCtrl"}}}).state("admin.company_message",{url:"/company_message",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/company_message/company_message.html",controller:"LoanApplicationCtrl"}}}).state("admin.company_message.add_company",{url:"/add_company",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/company_message/add_company.html",controller:"AddCompanyCtrl"}}}).state("admin.my_project",{url:"/my_project",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/my_project.html",controller:"MyProjectCtrl"}},resolve:{page:["$stateParams",function($stateParams){return $stateParams.page}],wd:["$stateParams",function($stateParams){return $stateParams.wd}],status:["$stateParams",function($stateParams){return $stateParams.status}]}}).state("admin.my_project.detail",{url:"/detail/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/detail.html",controller:"DetailCtrl"}}}).state("admin.my_project.edit_apply",{url:"/edit_apply/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/edit_apply.html",controller:"EditApplyCtrl"}}}).state("admin.my_project.distribute",{url:"/distribute/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/distribute.html",controller:"DistributeCtrl"}}}).state("admin.my_project.apply_help",{url:"/apply_help/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/apply_help.html",controller:"ApplyHelpCtrl"}}}).state("admin.my_project.change_bank",{url:"/change_bank/:id/:mobile",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/change_bank.html",controller:"ApplyHelpCtrl"}}}).state("admin.my_project.change_register",{url:"/change_register/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/change.html",controller:"ChangeRegisterCtrl"}}}).state("admin.my_project.message",{url:"/message/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/message.html",controller:"MessageCtrl"}}}).state("admin.my_project.choice_sale",{url:"/choice_sale/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/choice_sale.html",controller:"ChoiceSaleCtrl"}}}).state("admin.user_list",{url:"/user_list",views:{"contains@admin":{templateUrl:templates_root+"manager/user_list.html",controller:"SaleManagerCtrl"}}}).state("admin.user_list.sale_apply_list",{url:"/sale_apply_list/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"manager/sale_apply_list.html",controller:"SaleApplyListCtrl"}}}).state("admin.channel",{url:"/channel",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/channel.html",controller:"ChannelCtrl"}}}).state("admin.channel.create",{url:"/create",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/create.html",controller:"CreateCtrl"}}}).state("admin.channel.detail",{url:"/detail/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/detail.html",controller:"ChannelDetailCtrl"}}}).state("admin.channel.add_apply",{url:"/add_apply/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/add_apply.html",controller:"AddApplyCtrl"}}}).state("admin.channel.history",{url:"/history/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/history.html",controller:"HistoryCtrl"}}}).state("admin.channel.change",{url:"/change/:id/:idt",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/change.html",controller:"ChangeCtrl"}}}).state("admin.share",{url:"/share",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/share/share.html",controller:"ShareCtrl"}}}).state("admin.share.share_detail",{url:"/share_detail/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/share/share_detail.html",controller:"ShareDetailCtrl"}}}).state("admin.message",{url:"/message",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/message.html"}}}).state("admin.message.company",{url:"/company",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/company.html"}}}).state("admin.message.bank",{url:"/bank",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/bank.html",controller:"MessageBankCtrl"}}}).state("admin.message.apply",{url:"/apply",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/apply.html"}}}).state("admin.message.system",{url:"/system",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/system.html",controller:"MessageSystemCtrl"}}})});