/*! zrh_manager 07-12-2016 */
var loginCtrl=angular.module("loginCtrl",[]);loginCtrl.controller("LoginCtrl",["$scope","$rootScope","$http","$state","$location",function(a,b,c,d,e){var f=(new Date).getTime(),g=String(f).substring(0,10),h=parseInt(g);a.loginUser={account:"",password:"",timestamp:h},a.error_code_msg={1003:"该用户不存在",2001:"用户名或密码错误",1002:"该用户异常",1:"服务器异常,请稍后再试"};var i=function(a){return""!=a.account&&""!=a.password};a.login=function(){a.loginUser.signature=b.encryptByDES(a.loginUser.password+a.loginUser.timestamp);var d=a.loginUser;i(d)&&c({url:api_uri+"p/user/login",method:"POST",params:d}).success(function(c){0==c.returnCode?(b.login_user={userId:c.result.split("_")[0],token:c.result.split("_")[1]},b.putObject("login_user_manage",b.login_user),a.choiceUser(),a.loginUser={account:"",password:"",timestamp:h}):console.log(c)}).error(function(b){a.changeErrorMsg("网络故障请稍后再试......"),e.path("/login")})},a.choiceUser=function(){var d={userId:b.login_user.userId,token:b.login_user.token};c({url:api_uri+"p/user/detail/"+b.login_user.userId,method:"GET",params:d}).success(function(c){if(0==c.returnCode)b.putObject("role_manage",c.result),"super"==c.result.role?e.path("/super/company/1/"):e.path("/admin");else{console.log(c);var d=a.error_code_msg[c.returnCode];d||(d="登录失败"),a.error_msg=d}}).error(function(a){})}}]),loginCtrl.controller("ForgetPasswordCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.step=1,b.phoneNumCheck=!1,b.check_account=function(){var c={account:b.account};a({url:api_uri+"p/user/getTokenByAccount",method:"GET",params:c}).success(function(a){return 0==a.returnCode?(b.mobile_return=a.result.mobile,b.phoneNumCheck=!0,b.token=a.result.token,!0):void(1003==a.returnCode?alert("该用户不存在，重新输入邮箱"):alert("未知错误"))}).error(function(a){})},b.check_phone=function(){var c={token:b.token,mobile:b.mobile};a({url:api_uri+"p/user/validateMobile",method:"GET",params:c}).success(function(a){0==a.returnCode?b.send_code():1003==a.returnCode?alert("用户不存在或参数错误"):1004==a.returnCode?alert("手机号码错误"):alert("未知错误")}).error(function(a){})},b.send_code=function(){var c={token:b.token};a({url:api_uri+"p/user/sendSms",method:"GET",params:c}).success(function(a){0==a.returnCode||(1003==a.returnCode?alert("用户不存在或参数错误"):1004==a.returnCode?alert("手机号码错误"):3002==a.returnCode?alert("短信发送失败"):3003==a.returnCode?alert("短信发送过于频繁"):alert("未知错误"))}).error(function(a){})},b.check_code=function(){var c={token:b.token,code:b.code};a({url:api_uri+"p/user/validateSmsCode",method:"GET",params:c}).success(function(a){0==a.returnCode?b.step=2:1003==a.returnCode?alert("用户不存在或参数错误"):alert("未知错误")}).error(function(a){})},b.submit=function(){var c={token:b.token,pwd:b.pwd,password:b.password};a({url:api_uri+"p/user/resetPwd ",method:"GET",params:c}).success(function(a){0==a.returnCode&&(b.step=3)}).error(function(a){})},b.go_login=function(){c.go("login")}}]);var topBarCtrl=angular.module("topBarCtrl",[]);topBarCtrl.controller("TopBarCtrl",["$scope","$rootScope","$http","$location","$interval",function(a,b,c,d,e){a.role_manage=b.getObject("role_manage"),e(b.message,2e4),e(b.bank_messages,2e4),e(b.system_messages,2e4),a.go_home=function(){"manager"!=b.role?d.path(b.role):d.path("admin")},a.exit=function(){b.removeObject("login_user"),d.path("/login")}}]),topBarCtrl.controller("SideBarCtrl",["$scope",function(a){}]),topBarCtrl.controller("ContainsCtrl",["$scope","$rootScope","$http","$state","$location","$timeout",function(a,b,c,d,e,f){a.role_manage=b.getObject("role_manage"),a.message_roll=function(d,e){var f={userId:b.login_user.userId,token:b.login_user.token,pageNo:d,pageSize:e};c({url:api_uri+"zrh/message/listIndexs",method:"GET",params:f}).success(function(b){0==b.returnCode?(a.message_roll=b.result.datas,a.message_roll.length>0&&a.roll()):console.log(b)}).error(function(a){console.log(a)})},a.message_roll(1,20),a.item=0,a.roll=function(){a.message_roll_item=a.message_roll[a.item].content,a.message_roll_id=a.message_roll[a.item].id,a.message_roll_url=a.message_roll[a.item].url,f(function(){a.item++,a.item>=a.message_roll.length&&(a.item=0),a.roll()},1e4)},a.to_company_message=function(a,d){var f={userId:b.login_user.userId,token:b.login_user.token,id:a};c({url:api_uri+"zrh/message/details",method:"GET",params:f}).success(function(a){}).error(function(a){}),e.path(d)},a.get_count=function(){var d={userId:b.login_user.userId,token:b.login_user.token};c({url:api_uri+"zrh/index/count",method:"GET",params:d}).success(function(b){a.countContain=b.result,a.get_group_count()}).error(function(a){})},a.get_count(),a.get_group_count=function(){var d={userId:b.login_user.userId,token:b.login_user.token};c({url:api_uri+"zrh/group/groupCountByUser",method:"GET",params:d}).success(function(b){0==b.returnCode?a.countGroup=b.result:1003==b.returnCode?console.log("用户或分组不存在"):console.log(b)}).error(function(a){})}}]),topBarCtrl.controller("SettingCtrl",["$scope","$rootScope","$http","$state","$location","$timeout",function(a,b,c,d,e,f){a.myStyle={color:"#ffffff"},a.get_properties=function(){var d={userId:b.login_user.userId,token:b.login_user.token};c({url:api_uri+"sys/getProperties",method:"GET",params:d}).success(function(b){0==b.returnCode?1==b.result.sendSms?a.range=0:a.range=1:console.log(b)}).error(function(a){console.log(a)})},a.change_sms=function(){var a={userId:b.login_user.userId,token:b.login_user.token};c({url:api_uri+"sys/updateSendSms",method:"GET",params:a}).success(function(a){0==a.returnCode||console.log(a)}).error(function(a){console.log(a)})},a.get_properties()}]);var applyListCtrl=angular.module("applyListCtrl",[]);applyListCtrl.controller("ApplyListCtrl",["$scope","$rootScope","$http","$location",function(a,b,c,d){a.list=function(d,e){var f={userId:b.login_user.userId,token:b.login_user.token,pageNo:d,pageSize:e,wd:a.wd,status:a.status};c({url:api_uri+"loanApplicationManage/list",method:"GET",params:f}).success(function(b){0==b.returnCode&&(a.page=b.result,a.result_list=b.result.datas,angular.forEach(a.result_list,function(c){a.status=b.result.status,0==c.status?(c.progressText="未申请",c.color=1):1==c.status?(c.progressText="准备中",c.color=2):2==c.status?(c.progressText="下户",c.color=2):3==c.status?(c.progressText="审批中",c.color=2):4==c.status?(c.progressText="审批通过",c.color=2):5==c.status?(c.progressText="开户",c.color=2):6==c.status?(c.progressText="放款",c.color=2):7==c.status&&(c.progressText="完成融资",c.color=3)}))}).error(function(a){})},a.list(1,20),a.changePage=function(b){a.pageNo1=b,a.$watch(a.pageNo1,function(){a.list(a.pageNo1,20)})},a.selected=[],a.ids=[],a.isSelected=function(b){return a.selected.indexOf(b)>=0};var e=function(b,c){if("add"==b&&a.ids.push(c),"remove"==b){var d=a.ids.indexOf(c);a.ids.splice(d,1)}};a.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";e(d,b)},a["delete"]=function(){var c={userId:b.login_user.userId,token:b.login_user.token,ids:a.ids};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/delete",data:c,traditional:!0,success:function(b,c,d){0==b.returnCode&&a.list(a.pageNo1,10)},dataType:"json"})},a.search_text=null,a.search=function(){a.wd=a.search_text,a.list(1,20)},a.status_text="全部",a.choice=function(b){a.status=b,0==a.status?a.status_text="未申请":1==a.status?a.status_text="申请中":null==a.status&&(a.status_text="全部"),a.list(1,20)},a.updateApply=function(a){d.path("/admin/my_project/detail/"+a)}}]);var bankCtrl=angular.module("bankCtrl",[]);bankCtrl.controller("BankCtrl",["$http","$scope","$state","$rootScope","$location",function(a,b,c,d,e){b.list=function(c,f){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:f};a({url:api_uri+"manage/bank/list",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.page=a.result,b.bank_list=a.result.datas)}).error(function(a){e.path("/error")})},b.list(1,100),b.edit_bank=function(a){e.path("/super/bank/update/"+a)},b["delete"]=function(c){var e={userId:d.login_user.userId,token:d.login_user.token,id:c};a({url:api_uri+"manage/bank/delete",method:"GET",params:e}).success(function(a){0==a.returnCode&&b.list(1,20)}).error(function(a){})},b.find_detail=function(a,b){c.go("super.bank.bank_man",{id:a,name:b})}}]),bankCtrl.controller("BankManCtrl",["$http","$scope","$state","$rootScope","$location","$stateParams",function(a,b,c,d,e,f){b.selected=[],b.ids=[],b.id=f.id,b.bankName=f.name,b.list=function(c,e){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:e,bankId:f.id};a({url:api_uri+"manage/bank/user/list",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.page=a.result,b.bank_man_list=a.result.datas)}).error(function(a){})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.isSelected=function(a){return b.selected.indexOf(a)>=0};var g=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";g(d,b)},b["delete"]=function(){var a={userId:d.login_user.userId,token:d.login_user.token,ids:b.ids,bankId:b.id};$.ajax({type:"POST",url:api_uri+"manage/bank/user/delete",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode&&b.list(b.pageNo1,20)},error:function(a,b,c){},dataType:"json"})},b.delete_one=function(a){var c={userId:d.login_user.userId,token:d.login_user.token,ids:a,bankId:b.id};$.ajax({type:"POST",url:api_uri+"manage/bank/user/delete",data:c,traditional:!0,success:function(a,c,d){0==a.returnCode&&b.list(b.pageNo1,20)},error:function(a,b,c){},dataType:"json"})},b.add_user=function(a,b){c.go("super.bank.add_bank_man",{id:a,name:b})},b.edit_bank_man=function(a,b){c.go("super.bank.update_bank_man",{id:a,name:b})}}]),bankCtrl.controller("AddBankCtrl",["$http","$scope","$state","$rootScope",function(a,b,c,d){b.init=function(){var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"qiniu/getUpToken",method:"GET",params:c}).success(function(a){if(0==a.returnCode){b.qiniu_token=a.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,c){d.uploading=!0,b.upload_percent=c.percent,d.$apply()},UploadProgress:function(a,c){b.upload_percent=c.percent,b.$apply()},FileUploaded:function(a,e,f){var g=$.parseJSON(f),h="http://"+d.qiniu_bucket_domain+"/"+g.key;b.bankPic=h,b.$apply(),c.key="bankPic",c.value=b.bankPic},Error:function(a,b,c){d.alert("营业执照上传失败！")},UploadComplete:function(){},Key:function(a,b){var d=(new Date).getTime(),e="financialProductManage/create/"+c.userId+"/"+d;return e}}})}}).error(function(a){})},b.init(),b.submitAdd=function(){b.feature_list_new=[],b.condition_list_new=[];for(var a in b.feature_list)b.feature_list_new.push(b.feature_list[a].feature);for(var a in b.condition_list)b.condition_list_new.push(b.condition_list[a].condition);var e={userId:d.login_user.userId,token:d.login_user.token,name:b.name,icon:b.bankPic};$.ajax({type:"POST",url:api_uri+"manage/bank/add",data:e,traditional:!0,success:function(a,d,e){0==a.returnCode&&(c.go("super.bank"),b.$apply())},dataType:"json"})}}]),bankCtrl.controller("UpdateBankCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.detail=function(){var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"manage/bank/detail/"+e.id,method:"GET",params:c}).success(function(a){0==a.returnCode&&(b.bankEdit="编辑银行",b.bank=a.result,b.name=a.result.name,b.bankPic=a.result.icon)}).error(function(a){})},b.detail(),b.init=function(){var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"qiniu/getUpToken",method:"GET",params:c}).success(function(a){if(0==a.returnCode){b.qiniu_token=a.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,c){d.uploading=!0,b.upload_percent=c.percent,d.$apply()},UploadProgress:function(a,c){b.upload_percent=c.percent,b.$apply()},FileUploaded:function(a,e,f){var g=$.parseJSON(f),h="http://"+d.qiniu_bucket_domain+"/"+g.key;b.bankPic=h,b.$apply(),c.key="bankPic",c.value=b.bankPic},Error:function(a,b,c){d.alert("营业执照上传失败！")},UploadComplete:function(){},Key:function(a,b){var d=(new Date).getTime(),e="financialProductManage/create/"+c.userId+"/"+d;return e}}})}}).error(function(a){})},b.init(),b.submitAdd=function(a){var f={userId:d.login_user.userId,token:d.login_user.token,name:b.name,icon:b.bankPic,id:a};$.ajax({type:"POST",url:api_uri+"manage/bank/update/"+e.id,data:f,traditional:!0,success:function(a,d,e){console.log(a),0==a.returnCode&&(c.go("super.bank"),b.$apply())},dataType:"json"})}}]),bankCtrl.controller("AddBankManCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.selected=[],b.ids=[],b.names=[],b.list=function(c,f){var g={userId:d.login_user.userId,token:d.login_user.token,bankId:e.id,pageNo:c,pageSize:f,release:!0};a({url:api_uri+"financialProductManage/list",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.page=a.result,b.product_list=a.result.datas)}).error(function(a){})},b.list(1,100),b.isSelected=function(a){return b.selected.indexOf(a)>=0};var f=function(a,c,d){if("add"==a&&(b.ids.push(c),b.names.push(d)),"remove"==a){var e=b.ids.indexOf(c),f=b.names.indexOf(d);b.ids.splice(e,1),b.names.splice(f,1)}};b.updateSelection=function(a,b,c){var d=a.target,e=d.checked?"add":"remove";f(e,b,c)},b.add_bank_man=function(){var a={userId:d.login_user.userId,token:d.login_user.token,name:b.bank_man.name,bankId:e.id,branchBankName:b.bank_man.branchBankName,address:b.bank_man.address,position:b.bank_man.position,productIds:b.ids,mobile:b.bank_man.mobile,email:b.bank_man.email};$.ajax({type:"POST",url:api_uri+"manage/bank/user/add",data:a,traditional:!0,success:function(d,e,f){0==d.returnCode&&(c.go("super.bank.bank_man",{id:a.bankId}),b.$apply())},dataType:"json"})},b.go_back=function(){window.history.go(-1)},b.show_product=function(){b.productDiv=!0},b.hide_product=function(){b.products="";for(var a=0;a<b.names.length;a++)b.products+=b.names[a],b.products+=" ";b.productDiv=!1}}]),bankCtrl.controller("UpdateBankManCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.selected=[],b.ids=[],b.names=[],b.detail=function(){var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"manage/bank/user/detail/"+e.id,method:"GET",params:c}).success(function(a){0==a.returnCode&&(b.bank_man=a.result,b.bank_man_title="修改银行职员",b.products="",b.list(1,100))}).error(function(a){})},b.detail(),b.list=function(c,e){var f={userId:d.login_user.userId,token:d.login_user.token,bankId:b.bank_man.bankId,pageNo:c,pageSize:e,release:!0};a({url:api_uri+"financialProductManage/list",method:"GET",params:f}).success(function(a){if(0==a.returnCode){b.page=a.result,b.product_list=a.result.datas;for(var c=0;c<b.bank_man.productIds.length;c++)for(var d=0;d<b.product_list.length;d++)b.bank_man.productIds[c]==b.product_list[d].id&&(b.names.push(b.product_list[d].name),b.ids.push(b.product_list[d].id));b.products="";for(var c=0;c<b.names.length;c++)b.products+=b.names[c],b.products+=" "}}).error(function(a){})},b.isSelected=function(a){return b.bank_man.productIds.indexOf(a)>=0};var f=function(a,c,d){if("add"==a&&(b.ids.push(c),b.names.push(d)),"remove"==a){var e=b.ids.indexOf(c),f=b.names.indexOf(d);b.ids.splice(e,1),b.names.splice(f,1)}};b.updateSelection=function(a,b,c){var d=a.target,e=d.checked?"add":"remove";f(e,b,c)},b.add_bank_man=function(){var a={userId:d.login_user.userId,token:d.login_user.token,name:b.bank_man.name,bankId:b.bank_man.bankId,branchBankName:b.bank_man.branchBankName,address:b.bank_man.address,position:b.bank_man.position,productIds:b.ids,mobile:b.bank_man.mobile,email:b.bank_man.email};$.ajax({type:"POST",url:api_uri+"manage/bank/user/update/"+e.id,data:a,traditional:!0,success:function(d,e,f){0==d.returnCode?(c.go("super.bank.bank_man",{id:a.bankId}),b.$apply()):(console.log(d),alert("F12 查看错误状态"))},dataType:"json"})},b.show_product=function(){b.productDiv=!0},b.hide_product=function(){b.products="";for(var a=0;a<b.names.length;a++)b.products+=b.names[a],b.products+=" ";b.productDiv=!1},b.go_back=function(){window.history.go(-1)}}]);var companyCtrl=angular.module("companyCtrl",[]);companyCtrl.controller("CompanyCtrl",["$scope","$state","$rootScope","$http","$stateParams",function(a,b,c,d,e){a.pageNo1=e.page,e.wd?(a.search_text=decodeURI(e.wd),a.wd=decodeURI(e.wd)):a.search_text=null,a.list=function(b,e){var f={userId:c.login_user.userId,token:c.login_user.token,pageNo:b,pageSize:e,wd:a.wd};d({url:api_uri+"company/query/pageCompanyName",method:"GET",params:f}).success(function(b){console.log(b),0==b.returnCode&&(a.page=b.result,a.result_list=b.result.datas)}).error(function(a){})},a.list(e.page,20),a.changePage=function(c){a.pageNo1=c,b.go("super.company",{page:c,wd:a.search_text})},a.search=function(){a.wd=a.search_text,b.go("super.company",{page:1,wd:a.search_text})}}]),companyCtrl.controller("CompanyDetailCtrl",["$scope","$rootScope","$http","$stateParams",function(a,b,c,d){console.log(d.id),a.detail=function(){var e={userId:b.login_user.userId,token:b.login_user.token,companyId:d.id};c({url:api_uri+"company/query/byCompanyId",method:"GET",params:e}).success(function(b){console.log(b),0==b.returnCode&&(a.companyName=b.result.companyName,a.gongshangInfo=b.result.gongshangInfo,a.shuiwuInfo=b.result.shuiwuInfo,a.zibenInfo=b.result.zibenInfo,a.zhuyaorenyuanInfo=b.result.zhuyaorenyuanInfo,a.touzirenInfo=b.result.touzirenInfo,a.zaitouziInfo=b.result.zaitouziInfo,a.chuzilishiInfo=b.result.chuzilishiInfo,a.qiyenianbaoInfo=b.result.qiyenianbaoInfo,a.jobInfo=b.result.jobInfo,a.zzjgdmInfo=b.result.zzjgdmInfo)}).error(function(a){console.log(a)})},a.detail()}]);var manageCtrl=angular.module("manageCtrl",[]);manageCtrl.controller("UserListCtrl",["$http","$scope","$rootScope","$location",function(a,b,c,d){b.list=function(d,e){var f={userId:c.login_user.userId,token:c.login_user.token,pageNo:d,pageSize:e};a({url:api_uri+"p/user/list",method:"GET",params:f}).success(function(a){0==a.returnCode&&(b.page=a.result,b.result_list=a.result.datas,angular.forEach(b.result_list,function(a){"admin"==a.role?a.position="销售人员":"manager"==a.role?a.position="销售主管":"super"==a.role&&(a.position="超级管理员")}))}).error(function(a){})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,8)})},b.selected=[],b.ids=[],b.isSelected=function(a){return b.selected.indexOf(a)>=0};var e=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";e(d,b)},b.update=function(a){d.path("/super/manage/update/"+a)},b["delete"]=function(){var a={userId:c.login_user.userId,token:c.login_user.token,ids:b.ids};$.ajax({type:"POST",url:api_uri+"p/user/delete",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode&&b.list(b.pageNo1,20)},dataType:"json"})}}]),manageCtrl.controller("CreateUserCtrl",["$http","$scope","$rootScope","$location","$state",function(a,b,c,d,e){b.createUser=!0;var f=(new Date).getTime(),g=String(f).substring(0,10);b.timestamp=parseInt(g),b.isUpdate=!1,b.submit=function(){var d={userId:c.login_user.userId,token:c.login_user.token,timestamp:b.timestamp,email:b.email,name:b.name,mobile:b.mobile,empNo:b.empNo,password:b.password,role:b.role_sale,signature:c.encryptByDES(b.email+b.password+b.timestamp)};a({url:api_uri+"p/user/create",method:"POST",params:d}).success(function(a){0==a.returnCode&&e.go("super.manage")}).error(function(a){})}}]),manageCtrl.controller("UserUpdateCtrl",["$http","$scope","$rootScope","$location","$state","$timeout","$stateParams",function(a,b,c,d,e,f,g){var h=(new Date).getTime(),i=String(h).substring(0,10);b.timestamp=parseInt(i),b.isUpdate=!1,b.get=function(){var d={userId:c.login_user.userId,token:c.login_user.token};a({url:api_uri+"p/user/detail/"+g.id,method:"GET",params:d}).success(function(a){0==a.returnCode&&(b.isUpdate=!0,b.email=a.result.email,b.name=a.result.name,b.mobile=a.result.mobile,b.empNo=a.result.empNo,b.role_sale=a.result.role)}).error(function(a){})},b.get(),b.submit=function(){var d={userId:c.login_user.userId,token:c.login_user.token,timestamp:b.timestamp,name:b.name,mobile:b.mobile,password:b.password,role:b.role_sale,signature:c.encryptByDES(b.email+b.password+b.timestamp)};a({url:api_uri+"p/user/update/"+g.id,method:"POST",params:d}).success(function(a){0==a.returnCode&&e.go("super.manage")}).error(function(a){})}}]);var productCtrl=angular.module("productCtrl",[]);productCtrl.controller("ProductCtrl",["$http","$scope","$state","$rootScope","$location",function(a,b,c,d,e){b.list=function(c,f){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:f,wd:b.wd,release:b.release_status};a({url:api_uri+"financialProductManage/list",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.page=a.result,b.result_list=a.result.datas,angular.forEach(b.result_list,function(a){a.release?a.progressText="已发布":a.progressText="未发布"}))}).error(function(a){e.path("/error")})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.selected=[],b.ids=[],b.isSelected=function(a){return b.selected.indexOf(a)>=0};var f=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";f(d,b)},b.search_text=null,b.search=function(){b.wd=b.search_text,b.list(1,20)},b.submit=function(){var a={userId:d.login_user.userId,token:d.login_user.token,ids:b.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/release",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode&&b.list(b.pageNo1,10)},dataType:"json"})},b.cancel=function(){var a={userId:d.login_user.userId,token:d.login_user.token,ids:b.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/unRelease",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode&&b.list(b.pageNo1,10)},dataType:"json"})},b["delete"]=function(){var a={userId:d.login_user.userId,token:d.login_user.token,ids:b.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/delete",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode&&b.list(b.pageNo1,10)},dataType:"json"})},b.go_sort=function(){c.go("super.product.sort")},b.update=function(a){e.path("/super/product/update/"+a)},b.release=function(a){var c={userId:d.login_user.userId,token:d.login_user.token,ids:a};$.ajax({type:"POST",url:api_uri+"financialProductManage/release",data:c,traditional:!0,success:function(a,c,d){0==a.returnCode&&b.list(b.pageNo1,10)},dataType:"json"})},b.unrelease=function(a){var c={userId:d.login_user.userId,token:d.login_user.token,ids:a};$.ajax({type:"POST",url:api_uri+"financialProductManage/unRelease",data:c,traditional:!0,success:function(a,c,d){0==a.returnCode&&b.list(b.pageNo1,10)},dataType:"json"})},b.release_text="全部",b.choice=function(a){b.release_status=a,1==b.release_status?b.release_text="已发布":0==b.release_status?b.release_text="未发布":null==b.release_status&&(b.release_text="全部"),b.list(1,20)}}]),productCtrl.controller("ProductCreateCtrl",["$http","$scope","$rootScope","$state","$location",function(a,b,c,d,e){b.feature_list=[{feature:""}],b.add_feature=function(){b.feature_list.push({feature:""})},b.remove_feature=function(a){for(var c in b.feature_list)if(b.feature_list[c]==a){b.feature_list.splice(c,1);break}},b.condition_list=[{condition:""}],b.add_condition=function(){b.condition_list.push({condition:""})},b.remove_condition=function(a){for(var c in b.condition_list)if(b.condition_list[c]==a){b.condition_list.splice(c,1);break}},b.list=function(d,f){var g={userId:c.login_user.userId,token:c.login_user.token,pageNo:d,pageSize:f};a({url:api_uri+"manage/bank/list",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.page=a.result,b.bank_list=a.result.datas)}).error(function(a){e.path("/error")})},b.list(1,100),b.choiceBank=function(a,c){b.bankId=a,b.bankName=c},b.tags="",b.type||(b.type=0),b.submit=function(){var a=[],e=b.tags,f=new RegExp("＃","g");e=e.replace(f,"#");for(var g=e.split("#"),h=0;h<g.length;h++)""!=g[h]&&" "!=g[h]&&a.push(g[h]);b.feature_list_new=[],b.condition_list_new=[];for(var i in b.feature_list)b.feature_list_new.push(b.feature_list[i].feature);for(var i in b.condition_list)b.condition_list_new.push(b.condition_list[i].condition);var j={userId:c.login_user.userId,token:c.login_user.token,name:b.product.name,tags:a,bankId:b.bankId,rate:b.product.rate,rateRemark:b.product.rateRemark,loanvalue:b.product.loanvalue,loanlife:b.product.loanlife,summary:b.product.summary,feature:b.feature_list_new,conditions:b.condition_list_new,type:b.type};$.ajax({type:"POST",url:api_uri+"financialProductManage/create",data:j,traditional:!0,success:function(a,c,e){0==a.returnCode?(d.go("super.product"),b.$apply()):console.log(a)},dataType:"json"})}}]),productCtrl.controller("ProductUpdateCtrl",["$http","$scope","$state","$rootScope","$location","$stateParams",function(a,b,c,d,e,f){b.feature_list=[],b.tags="",b.add_feature=function(){b.feature_list.push({feature:""})},b.remove_feature=function(a){for(var c in b.feature_list)if(b.feature_list[c]==a){b.feature_list.splice(c,1);break}},b.condition_list=[],b.add_condition=function(){b.condition_list.push({condition:""})},b.remove_condition=function(a){for(var c in b.condition_list)if(b.condition_list[c]==a){b.condition_list.splice(c,1);break}},b.list=function(c,f){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:f};a({url:api_uri+"manage/bank/list",method:"GET",params:g}).success(function(a){0==a.returnCode?(b.page=a.result,b.bank_list=a.result.datas):console.log(a.result)}).error(function(a){e.path("/error")})},b.list(1,100),b.get=function(){var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"financialProductManage/detail/"+f.id,method:"GET",params:c}).success(function(a){if(b.pageTitle="修改金融产品",b.product=a.result,b.type=a.result.type,b.bankName=b.product.bankname,b.bankId=b.product.bankId,b.tags_arr=b.product.tags,b.tags_arr)for(var c=0;c<b.tags_arr.length;c++)b.tags+="#",b.tags+=b.tags_arr[c],b.tags+="# ";for(var d in a.result.feature)b.feature_list.push({feature:a.result.feature[d]});for(var d in a.result.conditions)b.condition_list.push({condition:a.result.conditions[d]})}).error(function(a){e.path("/error")})},b.get(),b.choiceBank=function(a,c){b.bankId=a,b.bankName=c},b.submit=function(){var a=[],e=b.tags,g=new RegExp("＃","g");e=e.replace(g,"#");for(var h=e.split("#"),i=0;i<h.length;i++)""!=h[i]&&" "!=h[i]&&a.push(h[i]);b.feature_list_new=[],b.condition_list_new=[];for(var j in b.feature_list)b.feature_list_new.push(b.feature_list[j].feature);for(var j in b.condition_list)b.condition_list_new.push(b.condition_list[j].condition);var k={id:f.id,userId:d.login_user.userId,token:d.login_user.token,name:b.product.name,tags:a,type:b.type,bankId:b.bankId,rate:b.product.rate,rateRemark:b.product.rateRemark,loanvalue:b.product.loanvalue,loanlife:b.product.loanlife,summary:b.product.summary,feature:b.feature_list_new,conditions:b.condition_list_new};$.ajax({type:"POST",url:api_uri+"financialProductManage/update",data:k,traditional:!0,success:function(a,d,e){0==a.returnCode?(c.go("super.product"),b.$apply()):console.log(a)},dataType:"json"})}}]),productCtrl.controller("SortCtrl",["$http","$scope","$state","$rootScope",function(a,b,c,d){b.list=function(c,e){var f={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:e,release:!0};a({url:api_uri+"financialProductManage/list",method:"GET",params:f}).success(function(a){0==a.returnCode&&(b.result_list=a.result.datas)}).error(function(a){$location.path("/error")})},b.list(1,100),b.go_back=function(){c.go("super.product")},b.sort_save=function(){b.sorts=[];for(var a=0;a<b.result_list.length;a++)b.sorts.push({id:b.result_list[a].id,sort:b.result_list[a].sort});var e={userId:d.login_user.userId,token:d.login_user.token,sorts:JSON.stringify(b.sorts)};$.ajax({type:"POST",url:api_uri+"financialProductManage/sort",data:e,traditional:!0,success:function(a,b,d){0==a.returnCode&&c.go("super.product")},dataType:"json"})}}]);var signUpCtrl=angular.module("signUpCtrl",[]);signUpCtrl.controller("SignUpCtrl",["$http","$scope","$rootScope",function(a,b,c){b.list=function(d,e){var f={userId:c.login_user.userId,token:c.login_user.token,pageNo:d,pageSize:e,wd:b.wd};a({url:api_uri+"p/user/listUsers",method:"GET",params:f}).success(function(a){0==a.returnCode&&(b.page=a.result,b.result_list=a.result.datas)}).error(function(a){})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.selected=[],b.ids=[],b.isSelected=function(a){return b.selected.indexOf(a)>=0};var d=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,e=c.checked?"add":"remove";d(e,b)},b.search_text=null,b.search=function(){b.wd=b.search_text,b.list(1,20)}}]);var teamCtrl=angular.module("teamCtrl",[]);teamCtrl.controller("TeamCtrl",["$http","$scope","$state","$rootScope","$location",function(a,b,c,d,e){b.edit_team_input=[],b.teamName="",b.list=function(){var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"zrh/group/listGroup",method:"GET",params:c}).success(function(a){0==a.returnCode?(b.page=a.result,b.team_list=a.result):console.log(a)}).error(function(a){})},b.list(),b.edit_team=function(a,c,d){b.teamName=d;for(var e=0;e<b.edit_team_input.length;e++)b.edit_team_input[e]=!1;b.edit_team_input[c]=!0},b.editTeam=function(a){var c={userId:d.login_user.userId,token:d.login_user.token,name:b.teamName,groupId:a};$.ajax({type:"POST",url:api_uri+"zrh/group/updateGroup",data:c,traditional:!0,success:function(a,c,d){if(0==a.returnCode){b.list();for(var e=0;e<b.edit_team_input.length;e++)b.edit_team_input[e]=!1;b.name=""}else 1003==a.returnCode?alert("用户分组不存在"):console.log(a)},dataType:"json"})},b.addTeam=function(){var a={userId:d.login_user.userId,token:d.login_user.token,name:b.name};$.ajax({type:"POST",url:api_uri+"zrh/group/addGroup",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode?(b.list(),b.$apply()):console.log(a)},dataType:"json"})},b.deleteTeam=function(c){var e={userId:d.login_user.userId,token:d.login_user.token,groupId:c};a({url:api_uri+"zrh/group/deleteGroup",method:"GET",params:e}).success(function(a){if(0==a.returnCode){b.list();for(var c=0;c<b.edit_team_input.length;c++)b.edit_team_input[c]=!1;b.name=""}else 1003==a.returnCode?alert("分组不存在"):console.log(a)}).error(function(a){})},b.find_detail=function(a){e.path("super/team/members/"+a)}}]),teamCtrl.controller("MembersCtrl",["$http","$scope","$rootScope","$stateParams",function(a,b,c,d){b.member_list_get=function(){var e={userId:c.login_user.userId,token:c.login_user.token,groupId:d.id};a({url:api_uri+"zrh/group/listUserByGroup",method:"GET",params:e}).success(function(a){0==a.returnCode?(b.page=a.result,b.member_list=a.result,b.ids=[]):console.log(a)}).error(function(a){$location.path("/error")})},b.member_list_get(),b.person_list_get=function(){var e={userId:c.login_user.userId,token:c.login_user.token,groupId:d.id};a({url:api_uri+"zrh/group/listUserOutGroup",method:"GET",params:e}).success(function(a){0==a.returnCode?(b.page=a.result,b.person_list=a.result,b.ids=[]):console.log(a)}).error(function(a){$location.path("/error");
})},b.person_list_get(),b.selected=[],b.ids=[],b.isSelected=function(a){return b.selected.indexOf(a)>=0};var e=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";e(d,b)},b.addToTeam=function(){var a={userId:c.login_user.userId,token:c.login_user.token,groupId:d.id,uids:b.ids};$.ajax({type:"POST",url:api_uri+"zrh/group/addUserToGroup",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode?(b.member_list_get(),b.person_list_get(),b.$apply()):1003==a.returnCode&&1==a.result.errorCode?alert("添加失败"):1003==a.returnCode&&1001==a.result.errorCode?alert("已经有分组"):console.log(a)},dataType:"json"})},b.deleteFromTeam=function(){var a={userId:c.login_user.userId,token:c.login_user.token,groupId:d.id,uids:b.ids};$.ajax({type:"POST",url:api_uri+"zrh/group/removeUserFromGroup",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode?(b.member_list_get(),b.person_list_get(),b.$apply()):1003==a.returnCode&&1003==a.result.errorCode?alert("用户不再该分组"):console.log(a)},dataType:"json"})}}]);var accountCtrl=angular.module("accountCtrl",[]);accountCtrl.controller("AccountCtrl",["$http","$scope","$state","$rootScope",function(a,b,c,d){b.choiceUser=function(){var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"p/user/detail/"+d.login_user.userId,method:"GET",params:c}).success(function(a){0==a.returnCode&&(b.role_account=a.result,d.putObject("role_manage",a.result))}).error(function(a){})},b.choiceUser(),b.init=function(){a({url:api_uri+"qiniu/getUpToken",method:"GET",params:d.login_user}).success(function(c){if(0==c.returnCode){b.qiniu_token=c.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,c){d.uploading=!0,b.upload_percent=c.percent,d.$apply()},UploadProgress:function(a,c){b.upload_percent=c.percent,b.$apply()},FileUploaded:function(c,e,f){var g=$.parseJSON(f),h="http://"+d.qiniu_bucket_domain+"/"+g.key,i={userId:d.login_user.userId,token:d.login_user.token,headImg:h};a({url:api_uri+"p/user/updateHeadImg",method:"POST",params:i}).success(function(a){0==a.returnCode&&b.choiceUser()}).error(function(a){})},Error:function(a,b,c){d.alert("头像上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="admin/account/"+d.login_user.userId+"/"+c;return e}}})}}).error(function(a){})},b.init()}]),accountCtrl.controller("PasswordCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.step=e.step,b.submit=function(){var e={userId:d.login_user.userId,token:d.login_user.token,pd:b.password};a({url:api_uri+"p/user/updatePwd",method:"POST",params:e}).success(function(a){0==a.returnCode&&(d.successMsg="修改成功",d.fadeInOut("#alert",500),c.go("admin.account.password",{step:3}),d.removeObject("login_user_manage"))}).error(function(a){})},b.go_login=function(){c.go("login")}}]);var channelCtrl=angular.module("channelCtrl",[]);channelCtrl.controller("ChannelCtrl",["$http","$scope","$state","$rootScope",function(a,b,c,d){b.list=function(c,e){var f={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:e};a({url:api_uri+"wxShare/manager/customerList",method:"GET",params:f}).success(function(a){0==a.returnCode?(b.page=a.result,void 0!=a.result&&(b.user_list=a.result.datas)):console.log(a)}).error(function(a){})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.selected=[],b.ids=[],b.isSelected=function(a){return b.selected.indexOf(a)>=0};var e=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";e(d,b)},b.search_text=null,b.search=function(){b.wd=b.search_text,b.list(1,20)},b.cancel=function(){var a={userId:d.login_user.userId,token:d.login_user.token,ids:b.ids};$.ajax({type:"POST",url:api_uri+"p/user/cancelCustomer",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode&&(b.ids=[],b.list(b.pageNo1,10))},dataType:"json"})},b.showDetail=function(a){c.go("admin.channel.detail",{id:a})},b.add_channel_man=function(){c.go("admin.channel.create")}}]),channelCtrl.controller("CreateCtrl",["$http","$scope","$state","$rootScope",function(a,b,c,d){b.submit=function(){var a={userId:d.login_user.userId,token:d.login_user.token,name:b.username,mobile:b.phone};$.ajax({type:"POST",url:api_uri+"p/user/addCustomer",data:a,traditional:!0,success:function(a,e,f){0==a.returnCode?(c.go("admin.channel"),d.successMsg="添加成功",d.fadeInOut("#alert",500),b.$apply()):1002==a.returnCode?alert("该用户已经有上级，或者是最高级别用户，不可以添加"):1003==a.returnCode?alert("此手机号尚未注册，暂不能使用"):1004==a.returnCode?alert("该用户已经被分配"):console.log(a)},dataType:"json"})}}]),channelCtrl.controller("ChannelDetailCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.list=function(c,f){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:f,wd:b.wd,status:b.status,uid:e.id};a({url:api_uri+"wxShare/manager/customerApplyList",method:"GET",params:g}).success(function(a){0==a.returnCode?(b.name=a.result.name,b.page=a.result.pagination,b.result_list=a.result.pagination.datas,angular.forEach(b.result_list,function(a){a.lastCommentTime&&(a.currentTime=(new Date).getTime(),a.timeOver=(a.currentTime-a.lastCommentTime)/1e3/3600/24),0==a.status?(a.progressText="未申请",a.color=1):1==a.status?(a.progressText="准备中",a.color=2):2==a.status?(a.progressText="下户",a.color=2):3==a.status?(a.progressText="审批中",a.color=2):4==a.status?(a.progressText="审批通过",a.color=2):5==a.status?(a.progressText="下户",a.color=2):6==a.status?(a.progressText="放款",a.color=2):7==a.status?(a.progressText="成功融资",a.color=3):a.status==-1&&(a.progressText="申请取消",a.color=1)})):console.log(a)}).error(function(a){})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.selected=[],b.ids=[],b.isSelected=function(a){return b.selected.indexOf(a)>=0};var f=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";f(d,b)},b.search_text=null,b.search=function(){b.wd=b.search_text,b.list(1,20)},b.choice=function(a){b.status=a,0==b.status?b.status_text="未申请":1==b.status?b.status_text="准备中":2==b.status?b.status_text="下户":3==b.status?b.status_text="审批中":4==b.status?b.status_text="审批通过":5==b.status?b.status_text="开户":6==b.status?b.status_text="放款":7==b.status?b.status_text="成功融资":null==b.status&&(b.status_text="全部"),b.list(1,20)},b.addApply=function(){c.go("admin.channel.add_apply",{id:e.id})},b.history=function(){c.go("admin.channel.history",{id:e.id})},b.go_back_channel=function(){c.go("admin.channel")},b.updateApply=function(a){c.go("admin.my_project.detail",{id:a})}}]),channelCtrl.controller("AddApplyCtrl",["$http","$scope","$state","$rootScope","$location","$stateParams",function(a,b,c,d,e,f){b.getApply=function(){var c={userId:d.login_user.userId,token:d.login_user.token,companyName:b.companyName};a({url:api_uri+"loanApplicationManage/listByCompanyName",method:"GET",params:c}).success(function(a){0==a.returnCode&&(b.page=a.result,b.result_list=a.result.datas)}).error(function(a){})},b.choice_product=function(a,c){b.productId=a,b.productName=c},b.submit=function(){var a={userId:d.login_user.userId,token:d.login_user.token,applyId:b.productId,uid:f.id};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/addChannel",data:a,traditional:!0,success:function(a,c,e){0==a.returnCode?(b.back(),d.successMsg="绑定成功",d.fadeInOut("#alert",500),b.$apply()):1003==a.returnCode?alert("用户不存在或申请不存在"):1004==a.returnCode?alert("参数错误"):console.log(a)},dataType:"json"})},b.back=function(){c.go("admin.channel.detail",{id:f.id})}}]),channelCtrl.controller("HistoryCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.list=function(c,f){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:f,uid:e.id};a({url:api_uri+"/loanApplicationManage/historyList",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.page=a.result,b.result_list=a.result.datas,angular.forEach(b.result_list,function(c){b.status=a.result.status,0==c.status?c.progressText="未申请":1==c.status?(c.progressText="申请中",c.progressBtn="开始约见"):2==c.status?(c.progressText="约见中",c.progressBtn="继续跟进"):3==c.status?(c.progressText="跟进中",c.progressBtn="完成贷款"):4==c.status?(c.progressText="成功融资",c.progressBtn="已结束"):c.status==-1&&(c.progressText="申请取消")}))}).error(function(a){})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.ids=[],b.search_text=null,b.search=function(){b.wd=b.search_text,b.list(1,20)},b.goBackDetail=function(){c.go("admin.channel.detail",{id:e.id})},b.change_register=function(a){c.go("admin.channel.change",{id:e.id,idt:a})}}]),channelCtrl.controller("ChangeCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.change=function(){var a={userId:d.login_user.userId,token:d.login_user.token,applyId:e.idt,mobile:b.phone};$.ajax({type:"POST",url:api_uri+"/loanApplicationManage/changeMobile",data:a,traditional:!0,success:function(a){0==a.returnCode?(b.back_channel(),d.successMsg="变更成功",d.fadeInOut("#alert",500),b.$apply()):1002==a.returnCode?alert("该申请已经处理过了"):1003==a.returnCode?alert("申请不存在"):alert("未知错误")},dataType:"json"})},b.back_channel=function(){c.go("admin.channel.history",{id:e.id})}}]);var loanApplicationCtrl=angular.module("loanApplicationCtrl",[]);loanApplicationCtrl.controller("LoanApplicationCtrl",["$http","$scope","$state","$rootScope","$location","$stateParams",function(a,b,c,d,e,f){b.list=function(c,f){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:f,wd:b.wd,status:b.status};a({url:api_uri+"loanApplicationManage/pool",method:"GET",params:g}).success(function(a){0==a.returnCode?(b.page=a.result,b.result_list=a.result.datas,angular.forEach(b.result_list,function(a){0==a.status?(a.progressText="未申请",a.color=1):1==a.status?(a.progressText="准备中",a.color=2):2==a.status?(a.progressText="下户",a.color=2):3==a.status?(a.progressText="审批中",a.color=2):4==a.status?(a.progressText="审批通过",a.color=2):5==a.status?(a.progressText="开户",a.color=2):6==a.status?(a.progressText="放款",a.color=2):7==a.status&&(a.progressText="完成融资",a.color=3)})):console.log(a)}).error(function(a){e.path("/error")})},b.list(f.page,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.selected=[],b.ids=[],b.isSelected=function(a){return b.selected.indexOf(a)>=0};var g=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";g(d,b)},b["delete"]=function(){var a=$(".line-roll").scrollTop(),c={userId:d.login_user.userId,token:d.login_user.token,ids:b.ids};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/delete",data:c,traditional:!0,success:function(c,d,e){0==c.returnCode&&($(".line-roll").scrollTop(a),b.list(b.pageNo1,20))},dataType:"json"})},b.search=function(){b.wd=b.search_text,b.list(1,20)},b.choice=function(a){b.status=a,0==b.status?b.status_text="未申请":1==b.status?b.status_text="准备中":2==b.status?b.status_text="下户":3==b.status?b.status_text="审批中":4==b.status?b.status_text="审批通过":5==b.status?b.status_text="开户":6==b.status?b.status_text="放款":7==b.status?b.status_text="成功融资":null==b.status&&(b.status_text="全部"),b.list(1,20)}}]),loanApplicationCtrl.controller("AddCompanyCtrl",["$http","$scope","$state","$rootScope",function(a,b,c,d){b.list=function(c,e){var f={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:e};a({url:api_uri+"manage/bank/list",method:"GET",params:f}).success(function(a){0==a.returnCode&&(b.page=a.result,b.bank_list=a.result.datas)}).error(function(a){$location.path("/error")})},b.list(1,100),b.choiceProduct=function(a,c){b.productId=a,b.productName=c},b.choice_product_type=function(a){b.productType=a},b.choiceBank=function(a,c){b.bankId=a,b.bankName=c,b.product_list_get(b.bankId,1,400),b.productName=""},b.product_list_get=function(c,e,f){var g={userId:d.login_user.userId,token:d.login_user.token,bankId:c,pageNo:e,pageSize:f,productType:b.productType,release:!0};a({url:api_uri+"financialProductManage/list",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.page=a.result,b.product_list=a.result.datas)}).error(function(a){})},b.submitMessage=function(){var a={userId:d.login_user.userId,token:d.login_user.token,companyName:b.companyName,linkman:b.linkman,mobile:b.applyMobile,applyMobile:b.applyMobile,productType:b.productType,productId:b.productId};console.log(a),$.ajax({type:"POST",url:api_uri+"loanApplicationManage/apply",data:a,traditional:!0,success:function(a,d,e){0==a.returnCode?(console.log(a),c.go("admin.my_project.working"),b.$apply()):1001==a.returnCode?alert("该公司信息已经存在"):console.log(a)},dataType:"json"})}}]);var messageCtrl=angular.module("messageCtrl",[]);messageCtrl.controller("MessageBankCtrl",["$http","$scope","$state","$rootScope",function(a,b,c,d){b.bank_list=function(c,e){var f={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:e};a({url:api_uri+"applyBankDeal/manage/list",method:"GET",params:f}).success(function(a){b.id_arr=[],b.message_list=[],b.message_list_old=a.result.datas;for(var c=0;c<b.message_list_old.length;c++)b.id_arr.indexOf(b.message_list_old[c].applyId)==-1&&(b.id_arr.push(b.message_list_old[c].applyId),b.message_list.push(b.message_list_old[c]));angular.forEach(b.message_list,function(a){a.dayNum="",1==a.status?(a.progressText="准备中",a.jindu_success=15):2==a.status?(a.progressPro="准备中",a.progressText="下户",a.jindu=15,a.jindu_next=10,a.jindu_success=25):3==a.status?(a.progressPro="下户",a.progressText="审批中",a.jindu=25,a.jindu_next=15,a.jindu_success=40):4==a.status?(a.progressPro="审批中",a.progressText="审批通过",a.jindu=40,a.jindu_next=15,a.jindu_success=55):5==a.status?(a.progressPro="审批通过",a.progressText="开户",a.jindu=55,a.jindu_next=15,a.jindu_success=70):6==a.status?(a.progressPro="开户",a.progressText="放款",a.jindu=70,a.jindu_next=15,a.jindu_success=85):7==a.status?(a.progressText="成功融资",a.jindu=100,a.jindu_success=100):a.status==-1&&(a.progressText="申请取消")})}).error(function(a){})},b.bank_list(1,100),b.statusPro="",b.showAllow=[],b.showRefuse=[],b.show_allow=function(a,c,d){if(b.showAllow=[],0==d){b.showAllow[c]=!0,b.status=a,2==a?(b.statusPro="准备中",b.statusText="下户"):3==a?(b.statusPro="下户",b.statusText="审批中"):4==a?(b.statusPro="审批中",b.statusText="审批通过"):5==a?(b.statusPro="审批通过",b.statusText="开户"):6==a?(b.statusPro="审批通过",b.statusText="放款"):7==a&&(b.statusPro="放款",b.statusText="成功融资");for(var e=0;e<b.showRefuse.length;e++)b.showRefuse[e]=!1}else{b.showRefuse[c]=!0;for(var f=0;f<b.showAllow.length;f++)b.showAllow[f]=!1}},b.choiceStatus=function(a){b.status=a,2==a?b.statusText="下户":3==a?b.statusText="审批中":4==a?b.statusText="审批通过":5==a?b.statusText="开户":6==a?b.statusText="放款":7==a&&(b.statusText="成功融资")},b.cancel=function(a){b.showAllow[a]=!1,b.showRefuse[a]=!1},b.closeAlert=function(a,c){b.change_alert=!1,b.stopPropagation&&c.stopPropagation()},b.cancel_alert=function(){b.change_alert=!1},b.change_alert=!1,b.stop_alert=function(a){b.stop_alert_id=a,b.change_alert=!0},b.allow=function(c,e,f){var g={userId:d.login_user.userId,token:d.login_user.token,status:b.status,dayNum:c,id:e};a({url:api_uri+"applyBankDeal/manage/allow",method:"GET",params:g}).success(function(a){0==a.returnCode?(d.successMsg="通过已发送",d.fadeInOut("#alert",500),b.showAllow[f]=!1,b.bank_list(1,100),d.message(),b.$apply()):1002==a.returnCode&&"abd"==a.errorString?alert("这条操作已经操作过了"):1002==a.returnCode&&"la"==a.errorString?alert("申请的状态错误"):alert(a)}).error(function(a){})},b.change_status=function(a,c,e){var f={userId:d.login_user.userId,token:d.login_user.token,status:b.status,days:a,id:c};$.ajax({type:"GET",url:api_uri+"loanApplicationManage/modifyRate",data:f,traditional:!0,success:function(a,c,f){0==a.returnCode?(d.successMsg="已经修改进度",d.fadeInOut("#alert",500),b.showAllow[e]=!1,b.bank_list(1,100)):console.log(a)},dataType:"json"})},b.refuse=function(c,e,f){var g={userId:d.login_user.userId,token:d.login_user.token,id:c,reason:f};a({url:api_uri+"applyBankDeal/manage/refuse",method:"GET",params:g}).success(function(a){0==a.returnCode?(d.successMsg="驳回已发送",d.fadeInOut("#alert",500),b.showRefuse[e]=!1,b.bank_list(1,100),d.message(),b.$apply()):1002==a.returnCode&&"abd"==a.result?alert("这条操作已经操作过了"):1002==a.returnCode&&"la"==a.result?alert("申请的状态错误"):alert("未知错误")}).error(function(a){})},b["continue"]=function(a){var c={userId:d.login_user.userId,token:d.login_user.token,id:a};$.ajax({type:"POST",url:api_uri+"applyBankDeal/manage/follow",data:c,traditional:!0,success:function(a,c,e){0==a.returnCode?(d.successMsg="继续项目",d.fadeInOut("#alert",500),b.bank_list(1,100)):console.log(a)},dataType:"json"})},b.stopped=function(){var a={userId:d.login_user.userId,token:d.login_user.token,id:b.stop_alert_id};$.ajax({type:"POST",url:api_uri+"applyBankDeal/manage/stopped",data:a,traditional:!0,success:function(a,c,e){0==a.returnCode?(d.successMsg="已经中止项目",d.fadeInOut("#alert",500),b.bank_list(1,100)):console.log(a)},dataType:"json"})},b.change_to_bank=function(a){c.go("admin.my_project.change_bank",{id:a,page:1,scroll:0})},b.stopped_person=function(a,c,e){var f={userId:d.login_user.userId,token:d.login_user.token,id:c};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/stopped",data:f,traditional:!0,success:function(a,c,e){0==a.returnCode?(d.successMsg="继续项目",d.fadeInOut("#alert",500),b.bank_list(1,100)):console.log(a)},dataType:"json"})}}]),messageCtrl.controller("MessageSystemCtrl",["$http","$scope","$rootScope",function(a,b,c){b.list=function(d,e){var f={userId:c.login_user.userId,token:c.login_user.token,pageNo:d,pageSize:e};a({url:api_uri+"zrh/message/lists",method:"GET",params:f}).success(function(a){b.page=a.result,b.result_list=a.result.datas}).error(function(a){})},b.list(1,100),b.list_stop=function(d,e){var f={userId:c.login_user.userId,token:c.login_user.token,pageNo:d,pageSize:e};a({url:api_uri+"zrh/message/listApplyManageDeal",method:"GET",params:f}).success(function(a){b.stop_list=a.result.datas}).error(function(a){})},b.list_stop(1,100),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.agree=function(d){var e={userId:c.login_user.userId,token:c.login_user.token,id:d};a({url:api_uri+"loanApplicationManage/agree",method:"GET",params:e}).success(function(a){b.list_stop(1,100),c.message()}).error(function(a){})},b.showRefuse=[],b.show_alert=function(a){b.showRefuse[a]=!0},b.refuse=function(d,e,f){var g={userId:c.login_user.userId,token:c.login_user.token,id:d,reason:f};a({url:api_uri+"loanApplicationManage/reject",method:"GET",params:g}).success(function(a){0==a.returnCode?(c.successMsg="驳回已发送",c.fadeInOut("#alert",500),b.showRefuse[e]=!1,b.list_stop(1,100),c.message()):1002==a.returnCode&&"abd"==a.result?alert("这条操作已经操作过了"):1002==a.returnCode&&"la"==a.result?alert("申请的状态错误"):alert("未知错误")}).error(function(a){})},b.cancel=function(a){b.showRefuse[a]=!1},b.to_company_message=function(b){var d={userId:c.login_user.userId,token:c.login_user.token,id:b};a({url:api_uri+"zrh/message/details",method:"GET",params:d}).success(function(a){}).error(function(a){console.log(a)})}}]);var myProjectCtrl=angular.module("myProjectCtrl",[]);myProjectCtrl.controller("MyProjectCtrl",["$http","$scope","$state","$location","$rootScope","$stateParams",function(a,b,c,d,e,f){b.showCancel=!1,b.comments_give="","/admin/my_project/working"==d.$$path?(b.complete=!1,b.class_apply="working"):"/admin/my_project/finished"==d.$$path?(b.complete=!0,b.class_apply="finished"):(b.status="",b.laji=!0,b.class_apply="drop"),b.list=function(c,d){var f={userId:e.login_user.userId,token:e.login_user.token,pageNo:c,pageSize:d,wd:b.wd,status:b.status,laji:b.laji,complete:b.complete};a({url:api_uri+"applyDeal/list",method:"GET",params:f}).success(function(a){0==a.returnCode?(b.pages=a.result.list,b.result_list=a.result.list.datas,b.count=a.result.count,b.userName=a.result.userName,angular.forEach(b.result_list,function(a){a.lastCommentTime&&(a.currentTime=(new Date).getTime(),a.timeOver=(a.currentTime-a.lastCommentTime)/1e3/3600/24),1==a.hasStopDeal?(a.progressText="申请失败",a.color=1):0==a.status?(a.progressText="未申请",a.color=1):1==a.status?(a.progressText="准备中",a.color=2):2==a.status?(a.progressText="下户",a.color=2):3==a.status?(a.progressText="审批中",a.color=2):4==a.status?(a.progressText="审批通过",a.color=2):5==a.status?(a.progressText="下户",a.color=2):6==a.status?(a.progressText="放款",a.color=2):7==a.status?(a.progressText="成功融资",a.color=3):a.status==-1&&(a.progressText="申请取消",a.color=1)})):console.log(a)}).error(function(a){console.log(a)})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.selected=[],b.ids=[],b.isSelected=function(a){return b.selected.indexOf(a)>=0};var g=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";g(d,b)},b.search=function(){b.wd=b.search_text,b.list(1,20)},b.status_text="全部",b.choice=function(a){b.status=a,0==b.status?b.status_text="未申请":1==b.status?b.status_text="准备中":2==b.status?b.status_text="下户":3==b.status?b.status_text="审批中":4==b.status?b.status_text="审批通过":5==b.status?b.status_text="开户":6==b.status?b.status_text="放款":7==b.status?b.status_text="成功融资":null==b.status&&(b.status_text="全部"),b.list(1,20)},b.show_cancel=function(){b.showCancel=!0},b.hide_cancel=function(){b.showCancel=!1},b.giveUp=function(){var a=$(".line-roll").scrollTop(),c={userId:e.login_user.userId,token:e.login_user.token,ids:b.ids,c:b.comments_give};0==c.ids.length?alert("没有选择项目"):""==c.c?alert("必须填写放弃原因"):$.ajax({type:"GET",url:api_uri+"loanApplicationManage/giveUp",data:c,traditional:!0,success:function(c,d,f){if(0==c.returnCode&&(b.ids=[],$(".line-roll").scrollTop(a),b.list(b.pageNo1,20),b.hide_cancel(),b.code_list=c.result,b.code_list))for(var g=0;g<b.code_list.length;g++)10002==b.code_list[g].code?alert(b.code_list[g].name+"，你已经选择了销售职员，所以不可以放弃项目，如果要放弃，请选择自己为销售职员"):10001==b.code_list[g].code?alert("申请不存在,请刷新页面"):(e.successMsg="操作成功",e.fadeInOut("#alert",500))},dataType:"json"})},b.trash=function(){var c={userId:e.login_user.userId,token:e.login_user.token,ids:b.ids};a({url:api_uri+"loanApplicationManage/toLaji",method:"GET",params:c}).success(function(a){0==a.returnCode&&(b.ids=[],b.list(b.pageNo1,20))})},b.from_trash=function(){var c={userId:e.login_user.userId,token:e.login_user.token,ids:b.ids};a({url:api_uri+"loanApplicationManage/outLaji",method:"GET",params:c}).success(function(a){0==a.returnCode&&(b.ids=[],b.list(b.pageNo1,20))})},b["delete"]=function(){var a=$(".line-roll").scrollTop(),c={userId:e.login_user.userId,token:e.login_user.token,ids:b.ids};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/delete",data:c,traditional:!0,success:function(c,d,e){console.log(c),0==c.returnCode&&($(".line-roll").scrollTop(a),b.list(b.pageNo1,20))},dataType:"json"})}}]);var saleManagerCtrl=angular.module("saleManagerCtrl",[]);saleManagerCtrl.controller("SaleManagerCtrl",["$http","$scope","$state","$rootScope",function(a,b,c,d){b.list_show=!0,b.list=function(){var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"zrh/group/listOtherFromGroup",method:"GET",params:c}).success(function(a){0==a.returnCode?(b.user_list=a.result,angular.forEach(b.user_list,function(a){"admin"==a.role?a.position="销售人员":"manager"==a.role?a.position="销售主管":"super"==a.role&&(a.position="超级管理员")})):1003==a.returnCode?alert("该用户没有分组"):console.log(a)}).error(function(a){})},b.list(),b.list_company=function(){var c={userId:d.login_user.userId,token:d.login_user.token,wd:b.wd};a({url:api_uri+"zrh/group/listApplyInGroup",method:"GET",params:c}).success(function(a){0==a.returnCode?b.company_list=a.result.datas:1003==a.returnCode?alert("该用户没有分组"):console.log(a)}).error(function(a){})},b.$watch("search_text",function(a,c){a||(b.list_show=!0)}),b.search=function(){b.wd=b.search_text,b.list_show=!1,b.list_company()},b.cancel=function(){var a={userId:d.login_user.userId,token:d.login_user.token,ids:b.ids};$.ajax({type:"POST",url:api_uri+"p/user/removeSaleFromGroup",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode?(b.ids=[],b.list()):console.log(a)},dataType:"json"})},b.showDetail=function(a){c.go("admin.user_list.sale_apply_list",{id:a})}}]),saleManagerCtrl.controller("SaleApplyListCtrl",["$http","$scope","$state","$rootScope","$location","$stateParams",function(a,b,c,d,e,f){b.list=function(c,e){var g={userId:d.login_user.userId,token:d.login_user.token,uid:f.id,pageNo:c,pageSize:e,status:b.status};a({url:api_uri+"applyDeal/list",method:"GET",params:g}).success(function(a){0==a.returnCode?(b.page=a.result.list,b.result_list=a.result.list.datas,b.count=a.result.count,b.userName=a.result.userName,angular.forEach(b.result_list,function(c){c.lastCommentTime&&(c.currentTime=(new Date).getTime(),c.timeOver=(c.currentTime-c.lastCommentTime)/1e3/3600/24),b.status=a.result.status,1==c.isStop?(c.progressText="申请失败",c.color=1):0==c.status?(c.progressText="未申请",c.color=1):1==c.status?(c.progressText="准备中",c.color=2):2==c.status?(c.progressText="下户",c.color=2):3==c.status?(c.progressText="审批中",c.color=2):4==c.status?(c.progressText="审批通过",c.color=2):5==c.status?(c.progressText="下户",c.color=2):6==c.status?(c.progressText="放款",c.color=2):7==c.status?(c.progressText="成功融资",c.color=3):c.status==-1&&(c.progressText="申请取消",c.color=1)})):console.log(a)}).error(function(a){})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.status_text="全部",b.choice=function(a){b.status=a,0==b.status?b.status_text="未申请":1==b.status?b.status_text="申请中":2==b.status?b.status_text="约见中":3==b.status?b.status_text="跟进中":4==b.status?b.status_text="成功融资":null==b.status&&(b.status_text="全部"),b.list(1,20)},b.search_text=null,b.search=function(){b.wd=b.search_text,b.list(1,20)},b.updateApply=function(a){c.go("admin.my_project.detail",{id:a})},b.go_sale_manage=function(){c.go("admin.user_list")}}]);var shareCtrl=angular.module("shareCtrl",[]);shareCtrl.controller("ShareCtrl",["$http","$scope","$state","$rootScope",function(a,b,c,d){b.list=function(c,e){var f={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:e};a({url:api_uri+"wxShare/manager/userList",method:"GET",params:f}).success(function(a){0==a.returnCode?(b.page=a.result,b.user_list=a.result.datas):console.log(a)}).error(function(a){})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.selected=[],b.ids=[],b.isSelected=function(a){return b.selected.indexOf(a)>=0};var e=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";e(d,b)},b.search_text=null,b.search=function(){b.wd=b.search_text,b.list(1,20)},b.remark=function(){var a={userId:d.login_user.userId,token:d.login_user.token,ids:b.ids};$.ajax({type:"POST",url:api_uri+"p/user/toCustomer",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode?(b.list(b.pageNo1,10),b.ids=[]):console.log(a)},dataType:"json"})},b.showDetail=function(a){c.go("admin.share.share_detail",{id:a})}}]),shareCtrl.controller("ShareDetailCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.list=function(c,f){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:f,uid:e.id,wd:b.wd,status:b.status};a({url:api_uri+"wxShare/manager/applyList",method:"GET",params:g}).success(function(a){0==a.returnCode?(b.name=a.result.name,b.page=a.result.pagination,b.result_list=a.result.pagination.datas,angular.forEach(b.result_list,function(a){a.lastCommentTime&&(a.currentTime=(new Date).getTime(),a.timeOver=(a.currentTime-a.lastCommentTime)/1e3/3600/24),0==a.status?(a.progressText="未申请",a.color=1):1==a.status?(a.progressText="准备中",a.color=2):2==a.status?(a.progressText="下户",a.color=2):3==a.status?(a.progressText="审批中",a.color=2):4==a.status?(a.progressText="审批通过",a.color=2):5==a.status?(a.progressText="下户",a.color=2):6==a.status?(a.progressText="放款",a.color=2):7==a.status?(a.progressText="成功融资",a.color=3):a.status==-1&&(a.progressText="申请取消",a.color=1)})):console.log(a)}).error(function(a){})},b.list(1,20),b.changePage=function(a){b.pageNo1=a,b.$watch(b.pageNo1,function(){b.list(b.pageNo1,20)})},b.selected=[],b.ids=[],b.isSelected=function(a){return b.selected.indexOf(a)>=0};var f=function(a,c){if("add"==a&&b.ids.push(c),"remove"==a){var d=b.ids.indexOf(c);b.ids.splice(d,1)}};b.updateSelection=function(a,b){var c=a.target,d=c.checked?"add":"remove";f(d,b)},b.search_text=null,b.search=function(){b.wd=b.search_text,b.list(1,20)},b.choice=function(a){b.status=a,0==b.status?b.status_text="未申请":1==b.status?b.status_text="准备中":2==b.status?b.status_text="下户":3==b.status?b.status_text="审批中":4==b.status?b.status_text="审批通过":5==b.status?b.status_text="开户":6==b.status?b.status_text="放款":7==b.status?b.status_text="成功融资":null==b.status&&(b.status_text="全部"),b.list(1,20)},b.cancel=function(){var a={userId:d.login_user.userId,token:d.login_user.token,ids:b.ids};$.ajax({type:"POST",url:api_uri+"p/user/cancelCustomer",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode&&(b.ids=[],b.list(b.pageNo1,10))},dataType:"json"})},b.updateApply=function(a){c.go("admin.my_project.detail",{id:a})},b.go_back_share=function(){c.go("admin.share")}}]);var detailAppCtrl=angular.module("detailAppCtrl",[]);detailAppCtrl.controller("DetailAppCtrl",["$http","$scope","$state","$rootScope","$location","$stateParams",function(a,b,c,e,f,g){b.id=g.id,b.showCancel=!1,b.date_delay="",b.get=function(){var c={userId:e.login_user.userId,token:e.login_user.token};a({url:api_uri+"inforTemplate/detail/"+g.id,method:"GET",params:c}).success(function(a){console.log(a),b.isAllot=a.result.isAllot,b.days=a.result.days,b.w=a.result.w,b.registerLinkmanName=a.result.registerLinkmanName,b.registerLinkmanMobile=a.result.registerLinkmanMobile,b.bankId=a.result.bankId,b.bankName=a.result.bankName,b.productName=a.result.productName,b.dealRemark=a.result.dealRemark,b.isOp=a.result.isOp,b.isStop=a.result.isStop,b.readonly=a.result.readonly,b.type=a.result.type,b.date_delay=new Date(a.result.planTime),a.result.remark&&(b.remark=a.result.remark),b.applyTime=a.result.applyTime,b.basic=a.result.baseInfo,b.model_list=a.result.templateList,b.status=a.result.status,0==b.status?(b.progressText="未申请",b.jindu=0):1==b.status?(b.progressText="准备中",b.progressBtn="下户",b.jindu=10):2==b.status?(b.progressText="下户",b.progressBtn="审批中",b.jindu=20):3==b.status?(b.progressText="审批中",b.progressBtn="审批通过",b.jindu=35):4==b.status?(b.progressText="审批通过",b.progressBtn="开户",b.jindu=55):5==b.status?(b.progressText="开户",b.progressBtn="放款",b.jindu=70):6==b.status?(b.progressText="放款",b.progressBtn="完成融资",b.jindu=85):7==b.status?(b.progressText="完成融资",b.jindu=100):b.status==-1&&(b.progressText="完成融资")}).error(function(a){console.log(a)})},b.get(),b.get_message=function(){var c={userId:e.login_user.userId,token:e.login_user.token,applyId:g.id};a({url:api_uri+"apply/comments/list",method:"GET",params:c}).success(function(a){b.message_list=a.result,b.check_role_class()}).error(function(a){console.log(a)})},b.get_message(),b.input_date=function(){var c={userId:e.login_user.userId,token:e.login_user.token,applyId:g.id,planTime:b.date_delay.getTime()};a({
url:api_uri+"inforTemplate/updatePlanTime",method:"POST",params:c}).success(function(a){console.log(a)})},b.editApply=function(a){c.go("admin.apply.edit_apply",{id:a})},b.apply_help=function(a){c.go("admin.apply.apply_help",{id:a})},b.change_bank=function(a,b){c.go("admin.apply.change_bank",{id:a,mobile:b})},b.messages=function(a){c.go("admin.apply.message",{id:a})},b.distribute=function(a){c.go("admin.apply.distribute",{id:a})},b.change_register=function(a){c.go("admin.apply.change_register",{id:a})},b.choice_sale=function(a){c.go("admin.apply.choice_sale",{id:a})},b.apply=function(){var c={userId:e.login_user.userId,token:e.login_user.token,applyId:g.id};a({url:api_uri+"applyDeal/apply",method:"GET",params:c}).success(function(a){0==a.returnCode?(b.get(),e.successMsg="成功领取项目",e.fadeInOut("#alert",500)):1002==a.returnCode?alert("申请状态错误"):1003==a.returnCode?alert("用户不存在"):1e3==a.returnCode?alert("服务器异常"):alert("其他未知错误")}).error(function(a){})},b.remark_submit=function(){var a={userId:e.login_user.userId,token:e.login_user.token,applyId:g.id,content:b.content};$.ajax({type:"POST",url:api_uri+"apply/comments/create",data:a,traditional:!0,success:function(a,c,f){0==a.returnCode?(b.content="",b.get_message(),e.successMsg="发布成功",e.fadeInOut("#alert",500)):1003==d.returnCode?alert("申请不存在，发布失败"):1e3==d.returnCode?alert("服务器错误"):alert("其他未知错误")},dataType:"json"})},b.check_role_class=function(){var c={userId:e.login_user.userId,token:e.login_user.token};a({url:api_uri+"p/user/detail/"+e.login_user.userId,method:"GET",params:c}).success(function(a){0==a.returnCode&&(b.role_class=a.result)}).error(function(a){})},b.show_cancel=function(){b.showCancel=!0},b.hide_cancel=function(){b.showCancel=!1},b.stopped=function(c,d){var f={userId:e.login_user.userId,token:e.login_user.token,id:c,reason:d};a({url:api_uri+"loanApplicationManage/stopped",method:"GET",params:f}).success(function(a){0==a.returnCode?(b.showCancel=!1,e.successMsg="已经中止项目",e.fadeInOut("#alert",500),window.close()):console.log(a)}).error(function(a){})},b.add_fee=function(a){b.msg="",$(".add-fee").css("display","block"),$(".add-loan").css("display","none"),3==a?b.msg="修改成功":4==a?b.msg="填写成功":alert("异常")},b.add_loan=function(a){b.msg="",$(".add-loan").css("display","block"),$(".add-fee").css("display","none"),1==a?b.msg="修改成功":2==a?b.msg="填写成功":alert("异常")},b.cancel_add=function(){$(".add-fee").css("display","none"),$(".add-loan").css("display","none")},b.update_loan=function(){var a={userId:e.login_user.userId,token:e.login_user.token,applyId:g.id,loanValue:b.loanValue};$.ajax({type:"POST",url:api_uri+"inforTemplate/updateLoanValue",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode&&($(".add-loan").css("display","none"),b.get(),e.successMsg=b.msg,e.fadeInOut("#alert",500),b.msg="")},dataType:"json"})},b.update_fee=function(){var a={userId:e.login_user.userId,token:e.login_user.token,applyId:g.id,fee:b.fee};$.ajax({type:"POST",url:api_uri+"inforTemplate/updateFee",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode&&($(".add-fee").css("display","none"),b.get(),e.successMsg=b.msg,e.fadeInOut("#alert",500))},dataType:"json"})}}]),detailAppCtrl.controller("EditApplyCtrl",["$http","$scope","$state","$rootScope","$location","$timeout","$stateParams",function(a,b,c,d,e,f,g){b.get=function(){b.get_id_arr=[];var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"inforTemplate/detail/"+g.id,method:"GET",params:c}).success(function(a){b.basic=a.result.baseInfo,b.type=b.basic.productType,b.registerLinkmanName=a.result.registerLinkmanName,b.registerLinkmanMobile=a.result.registerLinkmanMobile,b.model_list=a.result.templateList,b.img_model_count=0,b.img_model_arr=[];for(var c=0,d=0;c<b.model_list.length;c++)b.model_list[c].id_model=c,3==b.model_list[c].templateType&&(b.model_list[c].img_model_id="img_model"+d,b.model_list[c].img_model_div="imgList_model"+d,b.img_model_arr.push(d),b.img_model_count++,d++);f(function(){b.picSave()},500)}).error(function(a){})},b.get(),b.model={title:"",content:"",name:""},b.imgLoaded=!0,b.img_loaded=function(){b.imgLoaded=!1,$(".img-loading").css("display","none"),$(".red_point_look").css("display","inline-block")},b.picSave=function(){var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"qiniu/getUpToken",method:"GET",params:c}).success(function(a){if(0==a.returnCode){b.qiniu_token=a.result.uptoken,b.saveImg=0;for(var c=0;c<b.img_model_count;c++)if(0==c){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"img_model0",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"imgList_model0",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,c,e){var g=$.parseJSON(e),h="http://"+d.qiniu_bucket_domain+"/"+g.key;f(function(){b.model_list[b.saveImg].imgList.push(h)})},Error:function(a,b,c){alert("图片上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="inforTemplate/saveList/"+d.login_user.userId+"/"+c;return e}}})}else if(1==c){var e=new QiniuJsSDK;e.uploader({runtimes:"html5,flash,html4",browse_button:"img_model1",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"imgList_model1",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,c,e){var g=$.parseJSON(e),h="http://"+d.qiniu_bucket_domain+"/"+g.key;f(function(){b.model_list[b.saveImg].imgList.push(h)})},Error:function(a,b,c){d.alert("图片上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="inforTemplate/saveList/"+d.login_user.userId+"/"+c;return e}}})}else if(2==c){var g=new QiniuJsSDK;g.uploader({runtimes:"html5,flash,html4",browse_button:"img_model2",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"imgList_model2",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,c,e){var g=$.parseJSON(e),h="http://"+d.qiniu_bucket_domain+"/"+g.key;f(function(){b.model_list[b.saveImg].imgList.push(h)})},Error:function(a,b,c){d.alert("图片上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="inforTemplate/saveList/"+d.login_user.userId+"/"+c;return e}}})}else if(3==c){var h=new QiniuJsSDK,i={runtimes:"html5,flash,html4",browse_button:"img_model3",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"imgList_model3",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,c,e){var g=$.parseJSON(e),h="http://"+d.qiniu_bucket_domain+"/"+g.key;f(function(){b.model_list[b.saveImg].imgList.push(h)})},Error:function(a,b,c){d.alert("图片上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="inforTemplate/saveList/"+d.login_user.userId+"/"+c;return e}}};h.uploader(i)}else if(4==c){var j=new QiniuJsSDK,k={runtimes:"html5,flash,html4",browse_button:"img_model4",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"imgList_model4",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,c,e){var g=$.parseJSON(e),h="http://"+d.qiniu_bucket_domain+"/"+g.key;f(function(){b.model_list[b.saveImg].imgList.push(h)})},Error:function(a,b,c){d.alert("图片上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="inforTemplate/saveList/"+d.login_user.userId+"/"+c;return e}}};j.uploader(k)}else if(5==c){var l=new QiniuJsSDK,m={runtimes:"html5,flash,html4",browse_button:"img_model5",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"imgList_model5",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,c,e){var g=$.parseJSON(e),h="http://"+d.qiniu_bucket_domain+"/"+g.key;f(function(){b.model_list[b.saveImg].imgList.push(h)})},Error:function(a,b,c){d.alert("图片上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="inforTemplate/saveList/"+d.login_user.userId+"/"+c;return e}}};l.uploader(m)}else if(6==c){var n=new QiniuJsSDK,o={runtimes:"html5,flash,html4",browse_button:"img_model6",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"imgList_model6",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,c,e){var g=$.parseJSON(e),h="http://"+d.qiniu_bucket_domain+"/"+g.key;f(function(){b.model_list[b.saveImg].imgList.push(h)})},Error:function(a,b,c){d.alert("图片上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="inforTemplate/saveList/"+d.login_user.userId+"/"+c;return e}}};n.uploader(o)}else if(7==c){var p=new QiniuJsSDK,q={runtimes:"html5,flash,html4",browse_button:"img_model7",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"imgList_model7",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,c,e){var g=$.parseJSON(e),h="http://"+d.qiniu_bucket_domain+"/"+g.key;f(function(){b.model_list[b.saveImg].imgList.push(h)})},Error:function(a,b,c){d.alert("图片上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="inforTemplate/saveList/"+d.login_user.userId+"/"+c;return e}}};p.uploader(q)}else if(8==c){var r=new QiniuJsSDK,s={runtimes:"html5,flash,html4",browse_button:"img_model9",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"imgList_model8",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,c,e){var g=$.parseJSON(e),h="http://"+d.qiniu_bucket_domain+"/"+g.key;f(function(){b.model_list[b.saveImg].imgList.push(h)})},Error:function(a,b,c){d.alert("图片上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="inforTemplate/saveList/"+d.login_user.userId+"/"+c;return e}}};r.uploader(s)}else if(9==c){var t=new QiniuJsSDK,u={runtimes:"html5,flash,html4",browse_button:"img_model9",uptoken:b.qiniu_token,domain:d.qiniu_bucket_domain,container:"imgList_model9",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,b){},UploadProgress:function(a,b){},FileUploaded:function(a,c,e){var g=$.parseJSON(e),h="http://"+d.qiniu_bucket_domain+"/"+g.key;f(function(){b.model_list[b.saveImg].imgList.push(h)})},Error:function(a,b,c){d.alert("图片上传失败！")},UploadComplete:function(){},Key:function(a,b){var c=(new Date).getTime(),e="inforTemplate/saveList/"+d.login_user.userId+"/"+c;return e}}};t.uploader(u)}b.get_id=function(a){b.saveImg=a}}}).error(function(a){})},b.addModel=function(a){if(b.model_list)var c=b.model_list.length;else{b.model_list=[];var c=0}b.model_list.push({id_model:c,templateType:a,title:b.model.title,content:b.model.content,name:"",imgList:[]}),3==a&&(b.model_list[c].img_model_id="img_model"+b.img_model_count,b.model_list[c].img_model_div="imgList_model"+b.img_model_count,b.img_model_count++,b.picSave()),c++},b["delete"]=function(a){b.model_list.splice(a,1)},b.submitMessage=function(){if(2!=b.type){var a={applyId:g.id,id:b.basic.id,userId:d.login_user.userId,token:d.login_user.token,company_name:b.basic.company_name,legal_representative:b.basic.legal_representative,register_date:b.basic.register_date,registered_capital:b.basic.registered_capital,officeAddress:b.basic.officeAddress,business_address:b.basic.business_address,item_category:b.basic.item_category,business_type:b.basic.business_type,business_scope:b.basic.business_scope,linkmanName:b.basic.linkmanName,linkmanMobile:b.basic.linkmanMobile,continual:b.basic.continual};a.officeAddress&&a.linkmanMobile&&$.ajax({type:"POST",url:api_uri+"inforTemplate/saveBase",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode&&(b.id_basic=a.result,b.modelMessage())},dataType:"json"})}else{var c={applyId:g.id,id:b.basic.id,userId:d.login_user.userId,token:d.login_user.token,loanMan:b.basic.loanMan,linkmanName:b.basic.linkmanName,linkmanMobile:b.basic.linkmanMobile,continual:b.basic.continual};$.ajax({type:"POST",url:api_uri+"inforTemplate/savePersonBase",data:c,traditional:!0,success:function(a,c,d){0==a.returnCode&&b.modelMessage()},dataType:"json"})}},b.modelMessage=function(){for(var a=[],e=0;e<b.model_list.length;e++)a.push({title:b.model_list[e].title,name:b.model_list[e].name,templateType:b.model_list[e].templateType,content:b.model_list[e].content,imgList:b.model_list[e].imgList});if(2!=b.type){var f={userId:d.login_user.userId,token:d.login_user.token,comId:b.id_basic,list:JSON.stringify(a)};$.ajax({type:"POST",url:api_uri+"inforTemplate/saveList",data:f,traditional:!0,success:function(a,e,f){0==a.returnCode&&(d.successMsg="修改成功",d.fadeInOut("#alert",500),c.go("admin.apply.detail",{id:g.id}),b.$apply())},dataType:"json"})}else{var h={userId:d.login_user.userId,token:d.login_user.token,applyId:g.id,list:JSON.stringify(a)};$.ajax({type:"POST",url:api_uri+"inforTemplate/savePersonList",data:h,traditional:!0,success:function(a,e,f){0==a.returnCode&&(d.successMsg="修改成功",d.fadeInOut("#alert",500),c.go("admin.apply.detail",{id:g.id}),b.$apply())},dataType:"json"})}},b.saveImg="",b.removeImgList=function(a,b){a.splice(b,1)}}]),detailAppCtrl.controller("DistributeCtrl",["$http","$scope","$state","$rootScope","$location","$timeout","$stateParams",function(a,b,c,d,e,f,g){b.id=g.id,b.bank_list_get=function(c,f){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:f};a({url:api_uri+"manage/bank/list",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.page=a.result,b.bank_list=a.result.datas)}).error(function(a){e.path("/error")})},b.bank_list_get(1,100),b.bank_man_list_get=function(c,e,f){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:e,pageSize:f,bankId:c};a({url:api_uri+"manage/bank/user/list",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.bank_man_list=a.result.datas)}).error(function(a){})},b.choiceBank=function(a,c){b.bankId=a,b.bankName=c,b.bank_man_list_get(b.bankId,1,400),b.bankManName="",b.bankBelongMan=""},b.choiceBankMan=function(a,c,d){b.bankManId=a,b.bankManName=c,b.bankBelongMan=d},b.submit_user=function(){var e={userId:d.login_user.userId,token:d.login_user.token,id:b.id,bankUserId:b.bankManId};e.bankUserId&&a({url:api_uri+"loanApplicationManage/allot/",method:"GET",params:e}).success(function(a){0==a.returnCode?(d.successMsg="递交成功",d.fadeInOut("#alert",500),c.go("admin.apply.detail",{id:g.id})):1001==a.returnCode?alert("该申请已经被递交"):1002==a.returnCode?alert("企业未申请状态或其他未知状态"):1003==a.returnCode?alert("申请不存在"):1004==a.returnCode?alert("企业名称不存在或资料不够完善"):1005==a.returnCode?alert("1005"):alert("其他未知因素导致递交失败，请联系后台人员")}).error(function(a){})}}]),detailAppCtrl.controller("ApplyHelpCtrl",["$http","$scope","$state","$rootScope","$location","$timeout","$stateParams",function(a,b,c,d,e,f,g){b.applyMobile="",b.id=g.id,g.mobile&&(b.applyMobile=g.mobile),b.get=function(){var c={userId:d.login_user.userId,token:d.login_user.token,applyId:b.id};a({url:api_uri+"loanApplicationManage/getProduct",method:"GET",params:c}).success(function(a){0==a.returnCode&&(console.log(a),b.bankName=a.result.bankName,b.productName=a.result.productName,b.productId=a.result.productId,a.result.productType?b.productType=a.result.productType:b.productType=0)}).error(function(a){})},b.get(),b.list=function(c,f){var g={userId:d.login_user.userId,token:d.login_user.token,pageNo:c,pageSize:f};a({url:api_uri+"manage/bank/list",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.page=a.result,b.bank_list=a.result.datas)}).error(function(a){e.path("/error")})},b.list(1,100),b.choiceProduct=function(a,c,d){b.productId=a,b.productName=c,b.type=d},b.choiceBank=function(a,c){b.bankId=a,b.bankName=c,b.product_list_get(b.bankId,1,400),b.productName=""},b.product_list_get=function(c,e,f){var g={userId:d.login_user.userId,token:d.login_user.token,bankId:c,pageNo:e,pageSize:f,productType:b.productType,release:!0};a({url:api_uri+"financialProductManage/list",method:"GET",params:g}).success(function(a){0==a.returnCode&&(b.page=a.result,b.product_list=a.result.datas)}).error(function(a){})},b.submit_apply=function(a){var e={userId:d.login_user.userId,token:d.login_user.token,applyId:g.id,productId:b.productId,mobile:b.applyMobile};if(e.productId)if(e.applyId)if(e.mobile){if(0==a){var f="loanApplicationManage/helpApply";d.successMsg="操作成功"}else{var f="loanApplicationManage/changeProduct";d.successMsg="更换成功"}$.ajax({type:"POST",url:api_uri+f,data:e,traditional:!0,success:function(a,e,f){0==a.returnCode?(d.fadeInOut("#alert",500),c.go("admin.apply.detail",{id:g.id}),b.$apply()):1003==a.returnCode&&alert("申请不存在")},dataType:"json"})}else alert("电话号码不能为空");else alert("该申请不存在");else alert("请选择银行和产品")}}]),detailAppCtrl.controller("ChangeRegisterCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.change=function(){var a={userId:d.login_user.userId,token:d.login_user.token,applyId:e.id,mobile:b.phone};$.ajax({type:"POST",url:api_uri+"/loanApplicationManage/changeMobile",data:a,traditional:!0,success:function(a,f,g){0==a.returnCode?(d.successMsg="变更成功",d.fadeInOut("#alert",500),c.go("admin.apply.detail",{id:e.id}),b.$apply()):1002==a.returnCode?alert("该申请已经处理过了"):1003==a.returnCode?alert("申请不存在"):alert("未知错误")},dataType:"json"})}}]),detailAppCtrl.controller("MessageCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.get_message=function(){var c={userId:d.login_user.userId,token:d.login_user.token,applyId:e.id};a({url:api_uri+"apply/comments/list",method:"GET",params:c}).success(function(a){b.message_list=a.result}).error(function(a){})},b.get_message()}]),detailAppCtrl.controller("ChoiceSaleCtrl",["$http","$scope","$state","$rootScope","$stateParams",function(a,b,c,d,e){b.sale_id||(b.sale_id=""),b.get_saleId=function(){var c={userId:d.login_user.userId,token:d.login_user.token,applyId:e.id};a({url:api_uri+"p/user/getSalerByApplyId",method:"GET",params:c}).success(function(a){b.saleId=a.result.id}).error(function(a){})},b.get_user=function(){var c={userId:d.login_user.userId,token:d.login_user.token};a({url:api_uri+"zrh/group/listSalerFromGroup",method:"GET",params:c}).success(function(a){b.user_list=a.result,b.get_saleId()}).error(function(a){})},b.get_user(),b.submit=function(){var a={userId:d.login_user.userId,token:d.login_user.token,applyId:e.id,salerId:b.sale_id};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/updateSale",data:a,traditional:!0,success:function(a,f,g){0==a.returnCode&&(d.successMsg="操作成功",d.fadeInOut("#alert",500),c.go("admin.apply.detail",{id:e.id}),b.$apply())},dataType:"json"})}}]),api_uri="http://api.supeiyunjing.com/";var templates_root="templates/";deskey="abc123.*abc123.*abc123.*abc123.*";var app=angular.module("app",["ng","ngRoute","ngAnimate","ui.router","loginCtrl","topBarCtrl","companyCtrl","applyListCtrl","loanApplicationCtrl","productCtrl","myProjectCtrl","detailAppCtrl","saleManagerCtrl","manageCtrl","teamCtrl","signUpCtrl","bankCtrl","channelCtrl","shareCtrl","messageCtrl","accountCtrl"]);app.config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",a.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var b=function(a){var c,d,e,f,g,h,i,j="";for(c in a)if(d=a[c],d instanceof Array)for(i=0;i<d.length;++i)g=d[i],e=c+"["+i+"]",h={},h[e]=g,j+=b(h)+"&";else if(d instanceof Object)for(f in d)g=d[f],e=c+"["+f+"]",h={},h[e]=g,j+=b(h)+"&";else void 0!==d&&null!==d&&(j+=encodeURIComponent(c)+"="+encodeURIComponent(d)+"&");return j.length?j.substr(0,j.length-1):j};a.defaults.transformRequest=[function(a){return angular.isObject(a)&&"[object File]"!==String(a)?b(a):a}]}]),app.run(["$location","$rootScope","$timeout","$http",function(a,b,c,d){b.isOpenMenu=!0,b.qiniu_bucket_domain="o793l6o3p.bkt.clouddn.com",b.$on("$stateChangeSuccess",function(c,d,e,f,g){b.login_user=b.getObject("login_user_manage");var h=a.absUrl().split("#");b.url_detail=h[0]+"#/admin/apply/detail/",b.url_edit=h[0]+"#/admin/apply/choice_sale/",b.companyParams=b.getSessionObject("companyParams")}),b.$on("$stateChangeStart",function(d,e,f,g,h){var i=e.name;b.arrayParams=i.split(".");var j=i.split(".");b.choiceColor=j[1],"message"==j[1]||"my_project"==j[1]?(b.sideTwo=!0,b.isOpenMenu=!1,b.choiceColorTwo=j[2]):(b.sideTwo=!1,b.isOpenMenu||b.openMenu()),"/forget"!=a.$$path&&"/login"!=a.$$path?(b.check_user(),c(function(){b.login_user||a.path("/login")},500)):a.path(a.$$path),"^"==g.name&&"super.company"==e.name?b.putSessionObject("companyParams",f):"super.company"==g.name&&b.putSessionObject("companyParams",h)}),b.encryptByDES=function(a){var b=CryptoJS.enc.Utf8.parse(deskey),c=CryptoJS.DES.encrypt(a,b,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return c.toString()},b.decryptByDES=function(a){var b=CryptoJS.enc.Utf8.parse(deskey),c=CryptoJS.DES.decrypt({ciphertext:CryptoJS.enc.Base64.parse(a)},b,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return c.toString(CryptoJS.enc.Utf8)},b.refresh=function(){location.reload()},b.transFn=function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&").toString()},b.fadeInOut=function(a,b){$(a).fadeIn(b),setTimeout(function(){$(a).fadeOut(b)},3e3)},b.openMenu=function(){b.isOpenMenu=!0},b.closeMenu=function(){b.isOpenMenu=!1},b.change_alert=function(a){a.stopPropagation()},b.putObject=function(a,b){localStorage.setItem(a,angular.toJson(b))},b.getObject=function(a){return angular.fromJson(localStorage.getItem(a))},b.removeObject=function(a){localStorage.removeItem(a)},b.putSessionObject=function(a,b){sessionStorage.setItem(a,angular.toJson(b))},b.getSessionObject=function(a){return angular.fromJson(sessionStorage.getItem(a))},b.removeSessionObject=function(a){angular.fromJson(sessionStorage.removeItem(a))},b.getAccountInfo=function(){return b.account_info=={}&&(b.account_info=b.putSessionObject("account_info")),b.account_info||(b.account_info={}),b.account_info},b.setAccountInfo=function(a){b.account_info=a,b.putSessionObject("account_info",b.account_info)},b.updateAccountInfo=function(a){b.account_info=b.getAccountInfo();for(var c in a)b.account_info[c]=a[c];b.putSessionObject("account_info",b.account_info)},b.setAccountInfoKeyValue=function(a,c){b.account_info=b.getAccountInfo(),b.account_info[a]=c,b.putSessionObject("account_info",b.account_info)},b.getAccountInfoKeyValue=function(a){return b.account_info!={}&&(b.account_info=b.putSessionObject("account_info")),b.account_info?b.account_info[a]:null},b.check_user=function(){b.login_user=b.getObject("login_user_manage"),b.login_user&&d({url:api_uri+"p/user/validateAuth",method:"POST",params:b.login_user}).success(function(a){return 0==a.returnCode?(b.check_role(),!0):(b.login_user={},b.removeObject("login_user"),!1)}).error(function(a){return!1})},b.check_role=function(){var c={userId:b.login_user.userId,token:b.login_user.token};d({url:api_uri+"p/user/detail/"+b.login_user.userId,method:"GET",params:c}).success(function(c){0==c.returnCode&&(b.role=c.result.role,"super"==b.role?"super"==b.arrayParams[0]||a.path("/login"):"admin"==b.role?"admin"==b.arrayParams[0]&&"user_list"==b.arrayParams[1]:"manager"==b.role&&"admin"==b.arrayParams[0])}).error(function(a){})},b.message=function(){var a={userId:b.login_user.userId,token:b.login_user.token};d({url:api_uri+"zrh/index/message",method:"GET",params:a}).success(function(a){0==a.returnCode&&(b.count=a.result)}).error(function(a){})},b.bank_messages=function(){var a={userId:b.login_user.userId,token:b.login_user.token};d({url:api_uri+"applyBankDeal/manage/count",method:"GET",params:a}).success(function(a){0==a.returnCode&&(b.bank_message=a.result)}).error(function(a){})},b.system_messages=function(){var a={userId:b.login_user.userId,token:b.login_user.token};d({url:api_uri+"zrh/message/counts",method:"GET",params:a}).success(function(a){0==a.returnCode&&(b.system_message=a.result)}).error(function(a){})}}]),app.directive("imageonload",function(){return{restrict:"A",link:function(a,b,c){b.bind("load",function(){a.$apply(c.imageonload)})}}}),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/login"),a.state("login",{url:"/login",views:{"":{templateUrl:templates_root+"login/index.html",controller:"LoginCtrl"}}}).state("forget",{url:"/forget",views:{"":{templateUrl:templates_root+"login/forget_pwd.html",controller:"ForgetPasswordCtrl"}}}).state("super",{url:"/super",views:{"":{templateUrl:templates_root+"super/index.html"},"top_bar@super":{templateUrl:templates_root+"bar/top_bar.html",controller:"TopBarCtrl"},"side_bar@super":{templateUrl:templates_root+"bar/side_bar.html",controller:"SideBarCtrl"},"main@super":{templateUrl:templates_root+"super/main.html"}}}).state("super.company",{url:"/company/:page/:wd",views:{"main@super":{templateUrl:templates_root+"super/product_service/company_list/company.html",controller:"CompanyCtrl"}}}).state("super.companyDetail",{url:"/companyDetail/:id",views:{"main@super":{templateUrl:templates_root+"super/product_service/company_list/company_detail.html",controller:"CompanyDetailCtrl"}}}).state("super.apply_list",{url:"/apply_list",views:{"main@super":{templateUrl:templates_root+"super/product_service/apply_list/apply_list.html",controller:"ApplyListCtrl"}}}).state("super.manage",{url:"/manage",views:{"main@super":{templateUrl:templates_root+"super/product_service/manage/user_list.html",controller:"UserListCtrl"}}}).state("super.manage.addUser",{url:"/add_user",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/manage/add_user.html",controller:"CreateUserCtrl"}}}).state("super.manage.update",{url:"/update/:id",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/manage/add_user.html",controller:"UserUpdateCtrl"}}}).state("super.team",{url:"/team",views:{"main@super":{templateUrl:templates_root+"super/product_service/team/team.html",controller:"TeamCtrl"}}}).state("super.team.members",{url:"/members/:id",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/team/members.html",controller:"MembersCtrl"}}}).state("super.product",{url:"/product",views:{"main@super":{templateUrl:templates_root+"super/product_service/product/product.html",controller:"ProductCtrl"}}}).state("super.product.create",{url:"/create",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/product/create.html",controller:"ProductCreateCtrl"}}}).state("super.product.update",{url:"/update/:id",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/product/create.html",controller:"ProductUpdateCtrl"}}}).state("super.product.sort",{url:"/sort",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/product/sort.html",controller:"SortCtrl"}}}).state("super.bank",{url:"/bank",views:{"main@super":{templateUrl:templates_root+"super/product_service/bank/bank.html",controller:"BankCtrl"}}}).state("super.bank.bank_man",{params:{id:null,name:null},url:"/bank_man/:id/:name",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/bank/bank_man.html",controller:"BankManCtrl"}}}).state("super.bank.add_bank",{params:{id:null,name:null},url:"/add_bank/:id/:name",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/bank/add_bank.html",controller:"AddBankCtrl"}}}).state("super.bank.add_bank_man",{url:"/add_bank_man/:id/:name",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/bank/add_bank_man.html",controller:"AddBankManCtrl"}}}).state("super.bank.update",{url:"/update/:id",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/bank/add_bank.html",controller:"UpdateBankCtrl"}}}).state("super.bank.update_bank_man",{url:"/update_bank_man/:id/:name",views:{"side_bar@super":{templateUrl:templates_root+"bar/no_side.html"},"main@super":{templateUrl:templates_root+"super/product_service/bank/add_bank_man.html",controller:"UpdateBankManCtrl"}}}).state("super.signUp",{url:"/signUp",views:{"main@super":{templateUrl:templates_root+"super/product_service/sign_up/sign_up.html",controller:"SignUpCtrl"}}}).state("super.setting",{url:"/setting",views:{"main@super":{templateUrl:templates_root+"super/setting.html",controller:"SettingCtrl"}}}).state("admin",{url:"/admin",views:{"":{templateUrl:templates_root+"admin/index.html"},"top_bar@admin":{templateUrl:templates_root+"bar/top_bar.html",controller:"TopBarCtrl"},"side_bar@admin":{templateUrl:templates_root+"bar/side_bar.html",controller:"SideBarCtrl"},"contains@admin":{templateUrl:templates_root+"admin/contains.html",controller:"ContainsCtrl"}}}).state("admin.company_message",{url:"/company_message",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/company_message/company_message.html",controller:"LoanApplicationCtrl"}}}).state("admin.company_message.add_company",{url:"/add_company",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/company_message/add_company.html",controller:"AddCompanyCtrl"}}}).state("admin.my_project",{url:"/my_project",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/my_project.html",controller:"MyProjectCtrl"}},resolve:{page:["$stateParams",function(a){return a.page}],wd:["$stateParams",function(a){return a.wd}],status:["$stateParams",function(a){return a.status}]}}).state("admin.my_project.working",{url:"/working",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/my_project.html",controller:"MyProjectCtrl"}}}).state("admin.my_project.finished",{url:"/finished",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/my_project.html",controller:"MyProjectCtrl"}}}).state("admin.my_project.drop",{url:"/drop",views:{"contains@admin":{
templateUrl:templates_root+"admin/product_service/my_project/my_project.html",controller:"MyProjectCtrl"}}}).state("admin.apply",{url:"/apply",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"detail/apply_detail.html",controller:"DetailAppCtrl"}}}).state("admin.apply.detail",{url:"/detail/:id",views:{"contains@admin":{templateUrl:templates_root+"detail/apply_detail.html",controller:"DetailAppCtrl"}}}).state("admin.apply.edit_apply",{url:"/edit_apply/:id",views:{"contains@admin":{templateUrl:templates_root+"detail/edit_apply.html",controller:"EditApplyCtrl"}}}).state("admin.apply.distribute",{url:"/distribute/:id",views:{"contains@admin":{templateUrl:templates_root+"detail/distribute.html",controller:"DistributeCtrl"}}}).state("admin.apply.apply_help",{url:"/apply_help/:id",views:{"contains@admin":{templateUrl:templates_root+"detail/apply_help.html",controller:"ApplyHelpCtrl"}}}).state("admin.apply.change_bank",{url:"/change_bank/:id/:mobile",views:{"contains@admin":{templateUrl:templates_root+"detail/change_bank.html",controller:"ApplyHelpCtrl"}}}).state("admin.apply.change_register",{url:"/change_register/:id",views:{"contains@admin":{templateUrl:templates_root+"detail/change.html",controller:"ChangeRegisterCtrl"}}}).state("admin.apply.message",{url:"/message/:id",views:{"contains@admin":{templateUrl:templates_root+"detail/message.html",controller:"MessageCtrl"}}}).state("admin.apply.choice_sale",{url:"/choice_sale/:id",views:{"contains@admin":{templateUrl:templates_root+"detail/choice_sale.html",controller:"ChoiceSaleCtrl"}}}).state("admin.user_list",{url:"/user_list",views:{"contains@admin":{templateUrl:templates_root+"manager/user_list.html",controller:"SaleManagerCtrl"}}}).state("admin.user_list.sale_apply_list",{url:"/sale_apply_list/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"manager/sale_apply_list.html",controller:"SaleApplyListCtrl"}}}).state("admin.channel",{url:"/channel",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/channel.html",controller:"ChannelCtrl"}}}).state("admin.channel.create",{url:"/create",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/create.html",controller:"CreateCtrl"}}}).state("admin.channel.detail",{url:"/detail/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/detail.html",controller:"ChannelDetailCtrl"}}}).state("admin.channel.add_apply",{url:"/add_apply/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/add_apply.html",controller:"AddApplyCtrl"}}}).state("admin.channel.history",{url:"/history/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/history.html",controller:"HistoryCtrl"}}}).state("admin.channel.change",{url:"/change/:id/:idt",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/change.html",controller:"ChangeCtrl"}}}).state("admin.share",{url:"/share",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/share/share.html",controller:"ShareCtrl"}}}).state("admin.share.share_detail",{url:"/share_detail/:id",views:{"side_bar@admin":{templateUrl:templates_root+"bar/no_side.html"},"contains@admin":{templateUrl:templates_root+"admin/product_service/share/share_detail.html",controller:"ShareDetailCtrl"}}}).state("admin.account",{url:"/account",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/account/account.html",controller:"AccountCtrl"}}}).state("admin.account.password",{url:"/password/:step",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/account/password.html",controller:"PasswordCtrl"}}}).state("admin.message",{url:"/message",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/message.html"}}}).state("admin.message.company",{url:"/company",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/company.html"}}}).state("admin.message.bank",{url:"/bank",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/bank.html",controller:"MessageBankCtrl"}}}).state("admin.message.apply",{url:"/apply",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/apply.html"}}}).state("admin.message.system",{url:"/system",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/system.html",controller:"MessageSystemCtrl"}}})}]);