/*! zrh_manager 23-09-2016 */
var loginCtrl=angular.module("loginCtrl",[]);loginCtrl.controller("LoginCtrl",function($http,$scope,$rootScope,$location,$state,$timeout,$routeParams){var getTimestampTemp=(new Date).getTime(),timestamp=String(getTimestampTemp).substring(0,10),getTimestamp=parseInt(timestamp);$scope.loginUser={account:"",password:"",timestamp:getTimestamp},$scope.error_code_msg={1003:"该用户不存在",2001:"用户名或密码错误",1002:"该用户异常",1:"服务器异常,请稍后再试"};var check_params=function(params){return""!=params.account&&""!=params.password};$scope.login=function(){$scope.loginUser.signature=$rootScope.encryptByDES($scope.loginUser.password+$scope.loginUser.timestamp);var m_params=$scope.loginUser;check_params(m_params)&&$http({url:api_uri+"p/user/login",method:"POST",params:m_params}).success(function(d){0==d.returnCode&&(console.log(d),$rootScope.login_user={userId:d.result.split("_")[0],token:d.result.split("_")[1]},$rootScope.putObject("login_user",$rootScope.login_user),$scope.choiceUser())}).error(function(d){$scope.changeErrorMsg("网络故障请稍后再试......"),$location.path("/login")})},$scope.choiceUser=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"p/user/detail/"+$rootScope.login_user.userId,method:"GET",params:m_params}).success(function(d){if(0==d.returnCode)console.log(d),"super"==d.result.role?$location.path("/super"):$location.path("/admin");else{var msg=$scope.error_code_msg[d.returnCode];msg||(msg="登录失败"),$scope.error_msg=msg}}).error(function(d){})},$scope.reset=function(){}});var topBarCtrl=angular.module("topBarCtrl",[]);topBarCtrl.controller("TopBarCtrl",function($http,$scope,$rootScope,$location){$scope.go_home=function(){"manager"!=$rootScope.role?$location.path($rootScope.role):$location.path("admin")},$scope.exit=function(){$rootScope.removeObject("login_user"),$location.path("/login")}}),topBarCtrl.controller("SideBarCtrl",function($http,$scope,$state,$rootScope,$location,$timeout,$routeParams){}),topBarCtrl.controller("ContainsCtrl",function($http,$scope,$state,$rootScope,$location,$timeout,$routeParams){$scope.get_count=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"zrh/index/count",method:"GET",params:m_params}).success(function(d){console.log(d),$scope.countContain=d.result}).error(function(d){})},$scope.get_group_count=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"zrh/group/groupCountByUser",method:"GET",params:m_params}).success(function(d){0==d.returnCode?$scope.countGroup=d.result:1003==d.returnCode?console.log("用户或分组不存在"):console.log(d)}).error(function(d){})},$scope.get_count(),$scope.get_group_count()});var applyListCtrl=angular.module("applyListCtrl",[]);applyListCtrl.controller("ApplyListCtrl",function($http,$scope,$rootScope,$location,$timeout,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd};$http({url:api_uri+"loanApplicationManage/list",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas,angular.forEach($scope.result_list,function(data){$scope.status=d.result.status,0==data.status?(data.progressText="未申请",data.color=1):(data.progressText="申请中",data.color=2)}))}).error(function(d){$location.path("/error")})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.refresh=function(){$scope.list($scope.pageNo1,10)},$scope["delete"]=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.status_text="全部",$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="申请中":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)},$scope.updateApply=function(id){$location.path("/admin/my_project/detail/"+id)}});var productCtrl=angular.module("productCtrl",[]);productCtrl.controller("ProductCtrl",function($http,$scope,$rootScope,$location,$timeout,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd,release:$scope.release_status};$http({url:api_uri+"financialProductManage/list",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas,angular.forEach($scope.result_list,function(data){data.release?data.progressText="已发布":data.progressText="未发布"}))}).error(function(d){$location.path("/error")})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.refresh=function(){$scope.list($scope.pageNo1,10)},$scope.submit=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/release",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.cancel=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/unRelease",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope["delete"]=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.sort_up=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"financialProductManage/up",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.update=function(id){$location.path("/super/product/update/"+id)},$scope.release=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:id};$.ajax({type:"POST",url:api_uri+"financialProductManage/release",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.unrelease=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:id};$.ajax({type:"POST",url:api_uri+"financialProductManage/unRelease",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.release_text="全部",$scope.choice=function(release){$scope.release_status=release,1==$scope.release_status?$scope.release_text="已发布":0==$scope.release_status?$scope.release_text="未发布":null==$scope.release_status&&($scope.release_text="全部"),$scope.list(1,20)}}),productCtrl.controller("ProductCreateCtrl",function($http,$scope,$rootScope,$state,$location,$timeout,$routeParams){$scope.feature_list=[{feature:""}],$scope.add_feature=function(){$scope.feature_list.push({feature:""})},$scope.remove_feature=function(feature){for(var key in $scope.feature_list)if($scope.feature_list[key]==feature){$scope.feature_list.splice(key,1);break}},$scope.condition_list=[{condition:""}],$scope.add_condition=function(){$scope.condition_list.push({condition:""})},$scope.remove_condition=function(condition){for(var key in $scope.condition_list)if($scope.condition_list[key]==condition){$scope.condition_list.splice(key,1);break}},$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"manage/bank/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.bank_list=d.result.datas)}).error(function(d){$location.path("/error")})},$scope.list(1,100),$scope.choiceBank=function(id,name){$scope.bankId=id,$scope.bankName=name},$scope.tags="",$scope.type||($scope.type=0),$scope.submit=function(){var tags=[],text=$scope.tags,reg=new RegExp("＃","g");text=text.replace(reg,"#");for(var array=text.split("#"),i=0;i<array.length;i++)""!=array[i]&&" "!=array[i]&&tags.push(array[i]);$scope.feature_list_new=[],$scope.condition_list_new=[];for(var key in $scope.feature_list)$scope.feature_list_new.push($scope.feature_list[key].feature);for(var key in $scope.condition_list)$scope.condition_list_new.push($scope.condition_list[key].condition);var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.product.name,tags:tags,bankId:$scope.bankId,rate:$scope.product.rate,rateRemark:$scope.product.rateRemark,loanvalue:$scope.product.loanvalue,loanlife:$scope.product.loanlife,summary:$scope.product.summary,feature:$scope.feature_list_new,conditions:$scope.condition_list_new,type:$scope.type};$.ajax({type:"POST",url:api_uri+"financialProductManage/create",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($state.go("super.product"),$scope.$apply()):console.log(data)},dataType:"json"})}}),productCtrl.controller("ProductUpdateCtrl",function($http,$scope,$state,$rootScope,$location,$stateParams,$timeout,$routeParams){$scope.feature_list=[],$scope.tags="",$scope.add_feature=function(){$scope.feature_list.push({feature:""})},$scope.remove_feature=function(feature){for(var key in $scope.feature_list)if($scope.feature_list[key]==feature){$scope.feature_list.splice(key,1);break}},$scope.condition_list=[],$scope.add_condition=function(){$scope.condition_list.push({condition:""})},$scope.remove_condition=function(condition){for(var key in $scope.condition_list)if($scope.condition_list[key]==condition){$scope.condition_list.splice(key,1);break}},$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"manage/bank/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($scope.page=d.result,$scope.bank_list=d.result.datas):console.log(d.result)}).error(function(d){$location.path("/error")})},$scope.list(1,100),$scope.get=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"financialProductManage/detail/"+$stateParams.id,method:"GET",params:m_params}).success(function(d){if($scope.product=d.result,$scope.type=d.result.type,$scope.bankName=$scope.product.bankname,$scope.bankId=$scope.product.bankId,$scope.tags_arr=$scope.product.tags,$scope.tags_arr)for(var i=0;i<$scope.tags_arr.length;i++)$scope.tags+="#",$scope.tags+=$scope.tags_arr[i],$scope.tags+="# ";for(var key in d.result.feature)$scope.feature_list.push({feature:d.result.feature[key]});for(var key in d.result.conditions)$scope.condition_list.push({condition:d.result.conditions[key]})}).error(function(d){$location.path("/error")})},$scope.get(),$scope.choiceBank=function(id,name){$scope.bankId=id,$scope.bankName=name},$scope.submit=function(){var tags=[],text=$scope.tags,reg=new RegExp("＃","g");text=text.replace(reg,"#");for(var array=text.split("#"),i=0;i<array.length;i++)""!=array[i]&&" "!=array[i]&&tags.push(array[i]);$scope.feature_list_new=[],$scope.condition_list_new=[];for(var key in $scope.feature_list)$scope.feature_list_new.push($scope.feature_list[key].feature);for(var key in $scope.condition_list)$scope.condition_list_new.push($scope.condition_list[key].condition);var m_params={id:$stateParams.id,userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.product.name,tags:tags,type:$scope.type,bankId:$scope.bankId,rate:$scope.product.rate,rateRemark:$scope.product.rateRemark,loanvalue:$scope.product.loanvalue,loanlife:$scope.product.loanlife,summary:$scope.product.summary,feature:$scope.feature_list_new,conditions:$scope.condition_list_new};$.ajax({type:"POST",url:api_uri+"financialProductManage/update",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($state.go("super.product"),$scope.$apply()):console.log(data)},dataType:"json"})}});var manageCtrl=angular.module("manageCtrl",[]);manageCtrl.controller("UserListCtrl",function($http,$scope,$rootScope,$location,$timeout,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"p/user/list",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas,angular.forEach($scope.result_list,function(data){"admin"==data.role?data.position="销售人员":"manager"==data.role?data.position="销售主管":"super"==data.role&&(data.position="超级管理员")}))}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,8)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.update=function(id){$location.path("/super/manage/update/"+id)},$scope["delete"]=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"p/user/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,20)},dataType:"json"})}}),manageCtrl.controller("CreateUserCtrl",function($http,$scope,$rootScope,$location,$state,$timeout,$routeParams){var timesTamp=(new Date).getTime(),timesTamp1=String(timesTamp).substring(0,10);$scope.timestamp=parseInt(timesTamp1),$scope.isUpdate=!1,$scope.submit=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,timestamp:$scope.timestamp,email:$scope.email,name:$scope.name,mobile:$scope.mobile,empNo:$scope.empNo,password:$scope.password,role:$scope.role_sale,signature:$rootScope.encryptByDES($scope.email+$scope.password+$scope.timestamp)};console.log(m_params),$http({url:api_uri+"p/user/create",method:"POST",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&$state.go("super.manage")}).error(function(d){})}}),manageCtrl.controller("UserUpdateCtrl",function($http,$scope,$rootScope,$location,$state,$timeout,$stateParams){var timesTamp=(new Date).getTime(),timesTamp1=String(timesTamp).substring(0,10);$scope.timestamp=parseInt(timesTamp1),$scope.isUpdate=!1,$scope.password="******",$scope.get=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"p/user/detail/"+$stateParams.id,method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.isUpdate=!0,$scope.email=d.result.email,$scope.name=d.result.name,$scope.mobile=d.result.mobile,$scope.empNo=d.result.empNo,$scope.role_sale=d.result.role)}).error(function(d){})},$scope.get(),$scope.submit=function(){"******"==$scope.password?$scope.password_new="":$scope.password_new=$scope.password;var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,timestamp:$scope.timestamp,name:$scope.name,mobile:$scope.mobile,password:$scope.password_new,role:$scope.role_sale,signature:$rootScope.encryptByDES($scope.email+$scope.password+$scope.timestamp)};console.log(m_params),$http({url:api_uri+"p/user/update/"+$stateParams.id,method:"POST",params:m_params}).success(function(d){0==d.returnCode&&$state.go("super.manage")}).error(function(d){})}});var teamCtrl=angular.module("teamCtrl",[]);teamCtrl.controller("TeamCtrl",function($http,$scope,$state,$rootScope,$location){$scope.edit_team_input=[],$scope.teamName="",$scope.list=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"zrh/group/listGroup",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($scope.page=d.result,$scope.team_list=d.result):console.log(d)}).error(function(d){})},$scope.list(),$scope.edit_team=function(id,index,name){$scope.teamName=name;for(var i=0;i<$scope.edit_team_input.length;i++)$scope.edit_team_input[i]=!1;$scope.edit_team_input[index]=!0},$scope.editTeam=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.teamName,groupId:id};console.log(m_params),$.ajax({type:"POST",url:api_uri+"zrh/group/updateGroup",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){if(0==data.returnCode){$scope.list();for(var i=0;i<$scope.edit_team_input.length;i++)$scope.edit_team_input[i]=!1;$scope.name=""}else 1003==data.returnCode?alert("用户分组不存在"):console.log(data)},dataType:"json"})},$scope.addTeam=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.name};$.ajax({type:"POST",url:api_uri+"zrh/group/addGroup",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($scope.list(),$scope.$apply()):console.log(data)},dataType:"json"})},$scope.deleteTeam=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,groupId:id};console.log(m_params),$http({url:api_uri+"zrh/group/deleteGroup",method:"GET",params:m_params}).success(function(d){if(0==d.returnCode){$scope.list();for(var i=0;i<$scope.edit_team_input.length;i++)$scope.edit_team_input[i]=!1;$scope.name=""}else 1003==d.returnCode?alert("分组不存在"):console.log(d)}).error(function(d){})},$scope.find_detail=function(id){$location.path("super/team/members/"+id)}}),teamCtrl.controller("MembersCtrl",function($http,$scope,$rootScope,$stateParams){$scope.member_list_get=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,groupId:$stateParams.id};$http({url:api_uri+"zrh/group/listUserByGroup",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode?($scope.page=d.result,$scope.member_list=d.result,$scope.ids=[]):console.log(d)}).error(function(d){$location.path("/error")})},$scope.member_list_get(),$scope.person_list_get=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,groupId:$stateParams.id};$http({url:api_uri+"zrh/group/listUserOutGroup",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode?($scope.page=d.result,$scope.person_list=d.result,$scope.ids=[]):console.log(d)}).error(function(d){$location.path("/error")})},$scope.person_list_get(),$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&($scope.ids.push(id),console.log($scope.ids)),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1),console.log($scope.ids)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.addToTeam=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,groupId:$stateParams.id,uids:$scope.ids};$.ajax({type:"POST",url:api_uri+"zrh/group/addUserToGroup",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode?($scope.member_list_get(),$scope.person_list_get(),$scope.$apply()):1003==data.returnCode&&1==data.result.errorCode?alert("添加失败"):1003==data.returnCode&&1001==data.result.errorCode?alert("已经有分组"):console.log(data)},dataType:"json"})},$scope.deleteFromTeam=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,groupId:$stateParams.id,uids:$scope.ids};console.log(m_params),$.ajax({type:"POST",url:api_uri+"zrh/group/removeUserFromGroup",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($scope.member_list_get(),$scope.person_list_get(),$scope.$apply()):1003==data.returnCode&&1003==data.result.errorCode?alert("用户不再该分组"):console.log(data)},dataType:"json"})}});var signUpCtrl=angular.module("signUpCtrl",[]);signUpCtrl.controller("SignUpCtrl",function($http,$scope,$rootScope,$location,$timeout,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd};$http({url:api_uri+"p/user/listUsers",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.refresh_user=function(){$scope.list($scope.pageNo1,20)},$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)}});var bankCtrl=angular.module("bankCtrl",[]);bankCtrl.controller("BankCtrl",function($http,$scope,$state,$rootScope,$location){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"manage/bank/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.bank_list=d.result.datas)}).error(function(d){$location.path("/error")})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.edit_bank=function(id){$location.path("/super/bank/update/"+id)},$scope["delete"]=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id};$http({url:api_uri+"manage/bank/delete",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&$scope.list(1,20)}).error(function(d){})},$scope.find_detail=function(id,name){$state.go("super.bank.bank_man",{id:id,name:name})},$scope.changeModule=function(a,b){$scope.editModule=a,$scope.deleteModule=b}}),bankCtrl.controller("BankManCtrl",function($http,$scope,$rootScope,$location,$stateParams,$state){$scope.selected=[],$scope.ids=[],$scope.id=$stateParams.id,$scope.bankName=$stateParams.name,$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,bankId:$stateParams.id};$http({url:api_uri+"manage/bank/user/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.bank_man_list=d.result.datas)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.add_user=function(id,name){$state.go("super.bank.add_bank_man",{id:id,name:name})},$scope["delete"]=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids,bankId:$scope.id};$.ajax({type:"POST",url:api_uri+"manage/bank/user/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,20)},error:function(data,textStatus,jqXHR){},dataType:"json"})},$scope.delete_one=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:id,bankId:$scope.id};$.ajax({type:"POST",url:api_uri+"manage/bank/user/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,20)},error:function(data,textStatus,jqXHR){},dataType:"json"})},$scope.edit_bank_man=function(id){$location.path("/super/bank/update_bank_man/"+id)}}),bankCtrl.controller("AddBankCtrl",function($http,$scope,$rootScope,$state){$scope.init=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"qiniu/getUpToken",method:"GET",params:m_params}).success(function(d){if(0==d.returnCode){$scope.qiniu_token=d.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){$rootScope.uploading=!0,$scope.upload_percent=file.percent,$rootScope.$apply()},UploadProgress:function(up,file){$scope.upload_percent=file.percent,$scope.$apply()},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$scope.bankPic=file_url,$scope.$apply(),m_params.key="bankPic",m_params.value=$scope.bankPic},Error:function(up,err,errTip){$rootScope.alert("营业执照上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="financialProductManage/create/"+m_params.userId+"/"+time;return k}}})}}).error(function(d){})},$scope.init(),$scope.submitAdd=function(){$scope.feature_list_new=[],$scope.condition_list_new=[];for(var key in $scope.feature_list)$scope.feature_list_new.push($scope.feature_list[key].feature);for(var key in $scope.condition_list)$scope.condition_list_new.push($scope.condition_list[key].condition);var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.name,icon:$scope.bankPic};$.ajax({type:"POST",url:api_uri+"manage/bank/add",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($state.go("super.bank"),$scope.$apply())},dataType:"json"})}}),bankCtrl.controller("UpdateBankCtrl",function($http,$scope,$rootScope,$state,$stateParams){$scope.detail=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"manage/bank/detail/"+$stateParams.id,method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.bank=d.result,$scope.name=d.result.name,$scope.bankPic=d.result.icon)}).error(function(d){})},$scope.detail(),$scope.init=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"qiniu/getUpToken",method:"GET",params:m_params}).success(function(d){if(0==d.returnCode){$scope.qiniu_token=d.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){$rootScope.uploading=!0,$scope.upload_percent=file.percent,$rootScope.$apply()},UploadProgress:function(up,file){$scope.upload_percent=file.percent,$scope.$apply()},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$scope.bankPic=file_url,$scope.$apply(),m_params.key="bankPic",m_params.value=$scope.bankPic},Error:function(up,err,errTip){$rootScope.alert("营业执照上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="financialProductManage/create/"+m_params.userId+"/"+time;return k}}})}}).error(function(d){})},$scope.init(),$scope.update=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.name,icon:$scope.bankPic,id:id};$.ajax({type:"POST",url:api_uri+"manage/bank/update/"+$stateParams.id,data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($state.go("super.bank"),$scope.$apply())},dataType:"json"})}}),bankCtrl.controller("AddBankManCtrl",function($http,$scope,$rootScope,$state,$stateParams,$location,$timeout){$scope.selected=[],$scope.ids=[],$scope.names=[],$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,bankId:$stateParams.id,pageNo:pageNo,pageSize:pageSize,release:!0};$http({url:api_uri+"financialProductManage/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.product_list=d.result.datas)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id,name){if("add"==action&&($scope.ids.push(id),$scope.names.push(name)),"remove"==action){var idx=$scope.ids.indexOf(id),name_x=$scope.names.indexOf(name);$scope.ids.splice(idx,1),$scope.names.splice(name_x,1)}};$scope.updateSelection=function($event,id,name){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id,name)},$scope.add_bank_man=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.bank_man.name,bankId:$stateParams.id,branchBankName:$scope.bank_man.branchBank,address:$scope.bank_man.address,position:$scope.bank_man.position,productIds:$scope.ids,mobile:$scope.bank_man.mobile,email:$scope.bank_man.email};console.log(m_params),$.ajax({type:"POST",url:api_uri+"manage/bank/user/add",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),
0==data.returnCode&&($state.go("super.bank.bank_man",{id:m_params.bankId}),$scope.$apply())},dataType:"json"})},$scope.show_product=function(){$scope.productDiv=!0},$scope.hide_product=function(){$scope.products="";for(var i=0;i<$scope.names.length;i++)$scope.products+=$scope.names[i],$scope.products+=" ";$scope.productDiv=!1}}),bankCtrl.controller("UpdateBankManCtrl",function($http,$scope,$rootScope,$state,$stateParams,$location,$timeout,$routeParams){$scope.detail=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"manage/bank/user/detail/"+$stateParams.id,method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.bank_man=d.result,$scope.products="",$scope.list(1,20))}).error(function(d){})},$scope.detail(),$scope.selected=[],$scope.ids=[],$scope.names=[],$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,release:!0};$http({url:api_uri+"financialProductManage/list",method:"GET",params:m_params}).success(function(d){if(0==d.returnCode){$scope.page=d.result,$scope.product_list=d.result.datas;for(var i=0;i<$scope.bank_man.productIds.length;i++)for(var j=0;j<$scope.product_list.length;j++)$scope.bank_man.productIds[i]==$scope.product_list[j].id&&($scope.names.push($scope.product_list[j].name),$scope.ids.push($scope.product_list[j].id));$scope.products="";for(var i=0;i<$scope.names.length;i++)$scope.products+=$scope.names[i],$scope.products+=" "}}).error(function(d){})},$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.isSelected=function(id){return $scope.bank_man.productIds.indexOf(id)>=0};var updateSelected=function(action,id,name){if("add"==action&&($scope.ids.push(id),$scope.names.push(name)),"remove"==action){var idx=$scope.ids.indexOf(id),name_x=$scope.names.indexOf(name);$scope.ids.splice(idx,1),$scope.names.splice(name_x,1)}};$scope.updateSelection=function($event,id,name){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id,name)},$scope.update=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.bank_man.name,bankId:$scope.bank_man.bankId,branchBankName:$scope.bank_man.branchBankName,address:$scope.bank_man.address,position:$scope.bank_man.position,productIds:$scope.ids,mobile:$scope.bank_man.mobile,email:$scope.bank_man.email};$.ajax({type:"POST",url:api_uri+"manage/bank/user/update/"+$stateParams.id,data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($state.go("super.bank.bank_man",{id:m_params.bankId}),$scope.$apply())},dataType:"json"})},$scope.show_product=function(){$scope.productDiv=!0},$scope.hide_product=function(){$scope.products="";for(var i=0;i<$scope.names.length;i++)$scope.products+=$scope.names[i],$scope.products+=" ";$scope.productDiv=!1}});var loanApplicationCtrl=angular.module("loanApplicationCtrl",[]);loanApplicationCtrl.controller("LoanApplicationCtrl",function($http,$scope,$rootScope,$location,$timeout,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd};$http({url:api_uri+"loanApplicationManage/pool",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas,angular.forEach($scope.result_list,function(data){$scope.status=d.result.status,0==data.status?(data.progressText="未申请",data.color=1):(data.progressText="申请中",data.color=2)}))}).error(function(d){$location.path("/error")})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.refresh=function(){$scope.list($scope.pageNo1,10)},$scope["delete"]=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.status_text="全部",$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="申请中":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)},$scope.updateApply=function(id){$location.path("/admin/my_project/detail/"+id)}}),loanApplicationCtrl.controller("AddCompanyCtrl",function($http,$scope,$rootScope,$state,$location,$timeout,$routeParams){$scope.submitMessage=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,company_name:$scope.basic.company_name,legal_representative:$scope.basic.legal_representative,register_date:$scope.basic.register_date,registered_capital:$scope.basic.registered_capital,officeAddress:$scope.basic.officeAddress,business_address:$scope.basic.business_address,item_category:$scope.basic.item_category,business_type:$scope.basic.business_type,business_scope:$scope.basic.business_scope,linkmanName:$scope.basic.linkmanName,linkmanMobile:$scope.basic.linkmanMobile,continual:$scope.basic.continual};$.ajax({type:"POST",url:api_uri+"inforTemplate/create",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($state.go("admin.company_message"),$scope.$apply())},dataType:"json"})}});var saleManagerCtrl=angular.module("saleManagerCtrl",[]);saleManagerCtrl.controller("SaleManagerCtrl",function($http,$scope,$state,$rootScope,$location,$routeParams){$scope.list=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"zrh/group/listOtherFromGroup",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode?$scope.user_list=d.result:1003==d.returnCode&&alert("该用户没有分组")}).error(function(d){})},$scope.list(),$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.cancel=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"p/user/removeSaleFromGroup",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($scope.ids=[],$scope.list())},dataType:"json"})},$scope.showDetail=function(id){$location.path("/admin/user_list/sale_apply_list/"+id)}}),saleManagerCtrl.controller("SaleApplyListCtrl",function($http,$scope,$state,$rootScope,$location,$stateParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,uid:$stateParams.id,pageNo:pageNo,pageSize:pageSize,status:$scope.status};console.log(m_params),$http({url:api_uri+"applyDeal/list",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result.list,$scope.result_list=d.result.list.datas,$scope.count=d.result.count,$scope.userName=d.result.userName,angular.forEach($scope.result_list,function(data){$scope.status=d.result.status,0==data.status?(data.progressText="未申请",data.color=1):1==data.status?(data.progressText="申请中",data.progressBtn="开始约见",data.color=2):2==data.status?(data.progressText="约见中",data.progressBtn="继续跟进",data.color=2):3==data.status?(data.progressText="跟进中",data.progressBtn="完成贷款",data.color=2):4==data.status?(data.progressText="成功融资",data.progressBtn="已结束",data.color=3):data.status==-1&&(data.progressText="申请取消",data.color=1)}))}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0},$scope.status_text="全部",$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="申请中":2==$scope.status?$scope.status_text="约见中":3==$scope.status?$scope.status_text="跟进中":4==$scope.status?$scope.status_text="成功融资":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.updateApply=function(id){$location.path("/admin/my_project/detail/"+id)},$scope.go_sale_manage=function(){$location.path("/admin/user_list")}});var myProjectCtrl=angular.module("myProjectCtrl",[]);myProjectCtrl.controller("MyProjectCtrl",function($http,$scope,$rootScope,$location){$scope.showCancel=!1,$scope.comments_give="",$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd,status:$scope.status};$http({url:api_uri+"applyDeal/list",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result.list,$scope.result_list=d.result.list.datas,$scope.count=d.result.count,$scope.userName=d.result.userName,angular.forEach($scope.result_list,function(data){0==data.status?(data.progressText="未申请",data.color=1):1==data.status?(data.progressText="准备中",data.color=2):2==data.status?(data.progressText="下户",data.color=2):3==data.status?(data.progressText="审批中",data.color=2):4==data.status?(data.progressText="审批通过",data.color=2):5==data.status?(data.progressText="下户",data.color=2):6==data.status?(data.progressText="放款",data.color=2):7==data.status?(data.progressText="成功融资",data.color=3):data.status==-1&&(data.progressText="申请取消",data.color=1)}))}).error(function(d){$location.path("/error")})},$scope.list(1,20),$scope.pageNo1||($scope.pageNo1=1),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.refresh=function(){$scope.list($scope.pageNo1,10)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.status_text="全部",$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="准备中":2==$scope.status?$scope.status_text="下户":3==$scope.status?$scope.status_text="审批中":4==$scope.status?$scope.status_text="审批通过":5==$scope.status?$scope.status_text="开户":6==$scope.status?$scope.status_text="放款":7==$scope.status?$scope.status_text="成功融资":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)},$scope.showDetail=function(id){$location.path("/admin/my_project/detail/"+id)},$scope.show_cancel=function(){$scope.showCancel=!0},$scope.hide_cancel=function(){$scope.showCancel=!1},$scope.giveUp=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids,c:$scope.comments_give};console.log(m_params),0==m_params.ids.length?alert("没有选择项目"):""==m_params.c?alert("必须填写放弃原因"):$.ajax({type:"GET",url:api_uri+"loanApplicationManage/giveUp",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){if(console.log(data),0==data.returnCode&&(console.log(data),$scope.ids=[],$scope.list($scope.pageNo1,20),$scope.hide_cancel(),$scope.code_list=data.result,$scope.code_list))for(var i=0;i<$scope.code_list.length;i++)10002==$scope.code_list[i].code?alert($scope.code_list[i].name+"，你已经选择了销售职员，所以不可以放弃项目，如果要放弃，请选择自己为销售职员"):10001==$scope.code_list[i].code?alert("申请不存在,请刷新页面"):($rootScope.successMsg="操作成功",$rootScope.fadeInOut("#alert",500))},dataType:"json"})},$scope.nextStatus=function(id,status){if(status<4){status++;var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,status:status};$http({url:api_uri+"loanApplicationManage/next/"+id,method:"GET",params:m_params}).success(function(d){0==d.returnCode&&$scope.list($scope.pageNo1,20)}).error(function(d){$location.path("/error")})}},$scope["delete"]=function(){var m_params={ids:$scope.ids,userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/delete",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&$scope.list($scope.pageNo1,10)},dataType:"json"})},$scope.cancel=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id};$http({url:api_uri+"loanApplicationManage/cancel",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.list($scope.pageNo1,20),$scope.hide_cancel())}).error(function(d){})},$scope.linkCompany=function(id,remark){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id,remark:remark};$.ajax({type:"POST",url:api_uri+"loanApplicationManage/update",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode},dataType:"json"})}}),myProjectCtrl.controller("DetailCtrl",function($http,$scope,$rootScope,$location,$state,$timeout,$stateParams){$scope.id=$stateParams.id,$scope.get=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"inforTemplate/detail/"+$stateParams.id,method:"GET",params:m_params}).success(function(d){console.log(d),$scope.isAllot=d.result.isAllot,$scope.days=d.result.days,$scope.w=d.result.w,$scope.registerLinkmanName=d.result.registerLinkmanName,$scope.registerLinkmanMobile=d.result.registerLinkmanMobile,$scope.bankId=d.result.bankId,$scope.bankName=d.result.bankName,$scope.productName=d.result.productName,$scope.dealRemark=d.result.dealRemark,$scope.readonly=d.result.readonly,$scope.type=d.result.type,d.result.remark&&($scope.remark=d.result.remark),$scope.applyTime=d.result.applyTime,$scope.basic=d.result.baseInfo,$scope.model_list=d.result.templateList,$scope.status=d.result.status,0==$scope.status?($scope.progressText="未申请",$scope.jindu=0):1==$scope.status?($scope.progressText="准备中",$scope.progressBtn="下户",$scope.jindu=10):2==$scope.status?($scope.progressText="下户",$scope.progressBtn="审批中",$scope.jindu=20):3==$scope.status?($scope.progressText="审批中",$scope.progressBtn="审批通过",$scope.jindu=35):4==$scope.status?($scope.progressText="审批通过",$scope.progressBtn="开户",$scope.jindu=55):5==$scope.status?($scope.progressText="开户",$scope.progressBtn="放款",$scope.jindu=70):6==$scope.status?($scope.progressText="放款",$scope.progressBtn="完成融资",$scope.jindu=85):7==$scope.status?($scope.progressText="完成融资",$scope.jindu=100):$scope.status==-1&&($scope.progressText="完成融资")}).error(function(d){})},$scope.get(),$scope.get_message=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.id};$http({url:api_uri+"apply/comments/list",method:"GET",params:m_params}).success(function(d){$scope.message_list=d.result}).error(function(d){console.log(d)})},$scope.get_message(),$scope.editApply=function(id){2==$scope.type?alert("个人产品暂不支持修改信息"):$location.path("/admin/my_project/edit_apply/"+id)},$scope.apply_help=function(id){$location.path("/admin/my_project/apply_help/"+id)},$scope.change_bank=function(id,mobile){$location.path("/admin/my_project/change_bank/"+id+"/"+mobile)},$scope.messages=function(id){$location.path("/admin/my_project/message/"+id)},$scope.distribute=function(id){$location.path("/admin/my_project/distribute/"+id)},$scope.change_company=function(id){$location.path("/admin/my_project/change_company/"+id)},$scope.choice_sale=function(id){$location.path("/admin/my_project/choice_sale/"+id)},$scope.reBackFromDetails=function(){var from_route=$rootScope.getSessionObject("from_route"),from_route2=$rootScope.getSessionObject("from_route2"),from_params=$rootScope.getSessionObject("from_params");"admin.my_project"==from_route||"admin.company_message"==from_route?$state.go(from_route):null==from_route2?$state.go(from_route):$location.path(from_route2+from_params)},$scope.apply=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:id};$http({url:api_uri+"applyDeal/apply",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($rootScope.putSessionObject("from_route","admin.my_project"),$rootScope.showBtn=2,$rootScope.successMsg="成功领取项目",$rootScope.fadeInOut("#alert",500)):1002==d.returnCode?alert("申请状态错误"):1003==d.returnCode?alert("用户不存在"):1e3==d.returnCode?alert("服务器异常"):alert("其他未知错误")}).error(function(d){})},$scope.remark_submit=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.id,content:$scope.content};$.ajax({type:"POST",url:api_uri+"apply/comments/create",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($scope.content="",$scope.get_message(),$rootScope.successMsg="发布成功",$rootScope.fadeInOut("#alert",500)):1003==d.returnCode?alert("申请不存在，发布失败"):1e3==d.returnCode?alert("服务器错误"):alert("其他未知错误")},dataType:"json"})},$scope.add_fee=function(id){$scope.msg="",$(".add-fee").css("display","block"),$(".add-loan").css("display","none"),3==id?$scope.msg="修改成功":4==id?$scope.msg="填写成功":alert("异常")},$scope.add_loan=function(id){$scope.msg="",$(".add-loan").css("display","block"),$(".add-fee").css("display","none"),1==id?$scope.msg="修改成功":2==id?$scope.msg="填写成功":alert("异常")},$scope.cancel_add=function(){$(".add-fee").css("display","none"),$(".add-loan").css("display","none")},$scope.update_loan=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.id,loanValue:$scope.loanValue};console.log(m_params),$.ajax({type:"POST",url:api_uri+"inforTemplate/updateLoanValue",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($(".add-loan").css("display","none"),$scope.get(),$rootScope.successMsg=$scope.msg,$rootScope.fadeInOut("#alert",500),$scope.msg="")},dataType:"json"})},$scope.update_fee=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.id,fee:$scope.fee};console.log(m_params),$.ajax({type:"POST",url:api_uri+"inforTemplate/updateFee",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($(".add-fee").css("display","none"),$scope.get(),$rootScope.successMsg=$scope.msg,$rootScope.fadeInOut("#alert",500))},dataType:"json"})}}),myProjectCtrl.controller("EditApplyCtrl",function($http,$scope,$rootScope,$location,$state,$timeout,$stateParams,$routeParams){$scope.backProjectDetail=function(){$location.path("/admin/my_project/detail/"+$stateParams.id)},$scope.get=function(){$scope.get_id_arr=[];var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"inforTemplate/detail/"+$stateParams.id,method:"GET",params:m_params}).success(function(d){$scope.basic=d.result.baseInfo,$scope.registerLinkmanName=d.result.registerLinkmanName,$scope.registerLinkmanMobile=d.result.registerLinkmanMobile,$scope.model_list=d.result.templateList,$scope.img_model_count=0,$scope.img_model_arr=[];for(var i=0,j=0;i<$scope.model_list.length;i++)$scope.model_list[i].id_model=i,3==$scope.model_list[i].templateType&&($scope.model_list[i].img_model_id="img_model"+j,$scope.model_list[i].img_model_div="imgList_model"+j,$scope.img_model_arr.push(j),$scope.img_model_count++,j++);console.log($scope.model_list),console.log($scope.img_model_arr),$scope.picSave()}).error(function(d){})},$scope.get(),$scope.model={title:"",content:"",name:""},$scope.picSave=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"qiniu/getUpToken",method:"GET",params:m_params}).success(function(d){if(console.log(d),0==d.returnCode){$scope.qiniu_token=d.result.uptoken,$scope.saveImg=0;for(var i=0;i<$scope.img_model_count;i++)if(0==i){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"img_model0",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"imgList_model0",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$timeout(function(){$scope.model_list[$scope.saveImg].imgList.push(file_url)})},Error:function(up,err,errTip){$rootScope.alert("图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="inforTemplate/saveList/"+$rootScope.login_user.userId+"/"+time;return k}}})}else if(1==i){var Q2=new QiniuJsSDK,uploader2=Q2.uploader({runtimes:"html5,flash,html4",browse_button:"img_model1",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"imgList_model1",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$timeout(function(){$scope.model_list[$scope.saveImg].imgList.push(file_url)})},Error:function(up,err,errTip){$rootScope.alert("图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="inforTemplate/saveList/"+$rootScope.login_user.userId+"/"+time;return k}}});console.log(uploader2)}else if(2==i){var Qiniu3=new QiniuJsSDK,uploader3=Qiniu3.uploader({runtimes:"html5,flash,html4",browse_button:"img_model2",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"imgList_model2",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$timeout(function(){$scope.model_list[$scope.saveImg].imgList.push(file_url)})},Error:function(up,err,errTip){$rootScope.alert("图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="inforTemplate/saveList/"+$rootScope.login_user.userId+"/"+time;return k}}});console.log(uploader3)}else if(3==i){var Qiniu4=new QiniuJsSDK,option4={runtimes:"html5,flash,html4",browse_button:"img_model3",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"imgList_model3",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$timeout(function(){$scope.model_list[$scope.saveImg].imgList.push(file_url)})},Error:function(up,err,errTip){$rootScope.alert("图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="inforTemplate/saveList/"+$rootScope.login_user.userId+"/"+time;return k}}};Qiniu4.uploader(option4)}else if(4==i){var Qiniu5=new QiniuJsSDK,option5={runtimes:"html5,flash,html4",browse_button:"img_model4",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"imgList_model4",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$timeout(function(){$scope.model_list[$scope.saveImg].imgList.push(file_url)})},Error:function(up,err,errTip){$rootScope.alert("图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="inforTemplate/saveList/"+$rootScope.login_user.userId+"/"+time;return k}}};Qiniu5.uploader(option5)}else if(5==i){var Qiniu6=new QiniuJsSDK,option6={runtimes:"html5,flash,html4",browse_button:"img_model5",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"imgList_model5",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$timeout(function(){$scope.model_list[$scope.saveImg].imgList.push(file_url)})},Error:function(up,err,errTip){$rootScope.alert("图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="inforTemplate/saveList/"+$rootScope.login_user.userId+"/"+time;return k}}};Qiniu6.uploader(option6)}else if(6==i){var Qiniu7=new QiniuJsSDK,option7={runtimes:"html5,flash,html4",browse_button:"img_model6",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"imgList_model6",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$timeout(function(){$scope.model_list[$scope.saveImg].imgList.push(file_url)})},Error:function(up,err,errTip){$rootScope.alert("图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="inforTemplate/saveList/"+$rootScope.login_user.userId+"/"+time;return k}}};Qiniu7.uploader(option7)}else if(7==i){var Qiniu8=new QiniuJsSDK,option8={runtimes:"html5,flash,html4",browse_button:"img_model7",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"imgList_model7",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$timeout(function(){$scope.model_list[$scope.saveImg].imgList.push(file_url)})},Error:function(up,err,errTip){$rootScope.alert("图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="inforTemplate/saveList/"+$rootScope.login_user.userId+"/"+time;return k}}};Qiniu8.uploader(option8)}else if(8==i){var Qiniu9=new QiniuJsSDK,option9={runtimes:"html5,flash,html4",browse_button:"img_model9",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"imgList_model8",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$timeout(function(){$scope.model_list[$scope.saveImg].imgList.push(file_url)})},Error:function(up,err,errTip){$rootScope.alert("图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="inforTemplate/saveList/"+$rootScope.login_user.userId+"/"+time;return k}}};Qiniu9.uploader(option9)}else if(9==i){var Qiniu10=new QiniuJsSDK,option10={runtimes:"html5,flash,html4",browse_button:"img_model9",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"imgList_model9",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$timeout(function(){$scope.model_list[$scope.saveImg].imgList.push(file_url)})},Error:function(up,err,errTip){$rootScope.alert("图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="inforTemplate/saveList/"+$rootScope.login_user.userId+"/"+time;return k}}};Qiniu10.uploader(option10)}$scope.get_id=function(d){$scope.saveImg=d,console.log($scope.saveImg)}}}).error(function(d){})},$scope.addModel=function(templateType){if($scope.model_list)var id_model=$scope.model_list.length;else{$scope.model_list=[];var id_model=0}$scope.model_list.push({id_model:id_model,templateType:templateType,title:$scope.model.title,content:$scope.model.content,name:"",imgList:[]}),3==templateType&&($scope.model_list[id_model].img_model_id="img_model"+$scope.img_model_count,$scope.model_list[id_model].img_model_div="imgList_model"+$scope.img_model_count,console.log($scope.img_model_count),$scope.img_model_count++,$scope.picSave()),id_model++},$scope["delete"]=function(id){$scope.model_list.splice(id,1)},$scope.submitMessage=function(){var m_params={applyId:$stateParams.id,id:$scope.basic.id,userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,company_name:$scope.basic.company_name,legal_representative:$scope.basic.legal_representative,register_date:$scope.basic.register_date,registered_capital:$scope.basic.registered_capital,officeAddress:$scope.basic.officeAddress,business_address:$scope.basic.business_address,item_category:$scope.basic.item_category,business_type:$scope.basic.business_type,business_scope:$scope.basic.business_scope,linkmanName:$scope.basic.linkmanName,linkmanMobile:$scope.basic.linkmanMobile,continual:$scope.basic.continual};m_params.officeAddress&&m_params.linkmanMobile&&$.ajax({type:"POST",url:api_uri+"inforTemplate/saveBase",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($scope.id_basic=data.result,$scope.modelMessage())},dataType:"json"})},$scope.modelMessage=function(){for(var list=[],i=0;i<$scope.model_list.length;i++)list.push({
title:$scope.model_list[i].title,name:$scope.model_list[i].name,templateType:$scope.model_list[i].templateType,content:$scope.model_list[i].content,imgList:$scope.model_list[i].imgList});var m_params1={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,comId:$scope.id_basic,list:JSON.stringify(list)};$.ajax({type:"POST",url:api_uri+"inforTemplate/saveList",data:m_params1,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($rootScope.successMsg="修改成功",$rootScope.fadeInOut("#alert",500),$location.path("admin/my_project/detail/"+$stateParams.id),$scope.$apply())},dataType:"json"})},$scope.saveImg="",$scope.removeImgList=function(id,index){id.splice(index,1)}}),myProjectCtrl.controller("DistributeCtrl",function($http,$scope,$rootScope,$location,$state,$timeout,$routeParams,$stateParams){$scope.id=$stateParams.id,$scope.bank_list_get=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"manage/bank/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.bank_list=d.result.datas)}).error(function(d){$location.path("/error")})},$scope.bank_list_get(1,100),$scope.bank_man_list_get=function(id,pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,bankId:id};$http({url:api_uri+"manage/bank/user/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.bank_man_list=d.result.datas)}).error(function(d){})},$scope.choiceBank=function(id,name){$scope.bankId=id,$scope.bankName=name,$scope.bank_man_list_get($scope.bankId,1,400),$scope.bankManName=""},$scope.choiceBankMan=function(id,name){$scope.bankManId=id,$scope.bankManName=name},$scope.submit_user=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:$scope.id,bankUserId:$scope.bankManId};m_params.bankUserId&&$http({url:api_uri+"loanApplicationManage/allot/",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode?($rootScope.successMsg="递交成功",$rootScope.fadeInOut("#alert",500),$scope.backProjectDetail()):1001==d.returnCode?alert("该申请已经被递交"):1002==d.returnCode?alert("企业未申请状态或其他未知状态"):1003==d.returnCode?alert("申请不存在"):1004==d.returnCode?alert("企业名称不存在或资料不够完善"):1005==d.returnCode?alert("1005"):alert("其他未知因素导致递交失败，请联系后台人员")}).error(function(d){})},$scope.backProjectDetail=function(){$location.path("/admin/my_project/detail/"+$stateParams.id)}}),myProjectCtrl.controller("ApplyHelpCtrl",function($http,$scope,$rootScope,$location,$state,$timeout,$stateParams){$scope.applyMobile="",$scope.id=$stateParams.id,$stateParams.mobile&&($scope.applyMobile=$stateParams.mobile),$scope.get=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$scope.id};$http({url:api_uri+"loanApplicationManage/getProduct",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.bankName=d.result.bankName,$scope.productName=d.result.productName,$scope.productId=d.result.productId)}).error(function(d){})},$scope.get(),$scope.backProjectDetail=function(id){$location.path("/admin/my_project/detail/"+id)},$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"manage/bank/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.bank_list=d.result.datas)}).error(function(d){$location.path("/error")})},$scope.list(1,100),$scope.choiceProduct=function(id,name,type){$scope.productId=id,$scope.productName=name,2==type&&(alert("企业不可以申请个人产品，请更换"),$scope.productName="")},$scope.choiceBank=function(id,name){$scope.bankId=id,$scope.bankName=name,$scope.product_list_get($scope.bankId,1,400),$scope.productName=""},$scope.product_list_get=function(id,pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,bankId:id,pageNo:pageNo,pageSize:pageSize,release:!0};$http({url:api_uri+"financialProductManage/list",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&(console.log(d),$scope.page=d.result,$scope.product_list=d.result.datas)}).error(function(d){})},$scope.submit_apply=function(msg){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.id,productId:$scope.productId,mobile:$scope.applyMobile};if(console.log(m_params),m_params.productId)if(m_params.applyId)if(m_params.mobile){if(0==msg){var apply_url="loanApplicationManage/helpApply";$rootScope.successMsg="操作成功"}else{var apply_url="loanApplicationManage/changeProduct";$rootScope.successMsg="更换成功"}$.ajax({type:"POST",url:api_uri+apply_url,data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode?($rootScope.fadeInOut("#alert",500),$location.path("/admin/my_project/detail/"+$scope.id),$scope.$apply()):1003==data.returnCode&&alert("申请不存在")},dataType:"json"})}else alert("电话号码不能为空");else alert("该申请不存在");else alert("请选择银行和产品")}}),myProjectCtrl.controller("ChangeRegisterCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.change=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.id,mobile:$scope.phone};$.ajax({type:"POST",url:api_uri+"/loanApplicationManage/changeMobile",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($rootScope.successMsg="变更成功",$rootScope.fadeInOut("#alert",500),$location.path("/admin/my_project/detail/"+$stateParams.id),$scope.$apply()):1002==data.returnCode?alert("该申请已经处理过了"):1003==data.returnCode?alert("申请不存在"):alert("未知错误")},dataType:"json"})},$scope.backProjectDetail=function(){$location.path("/admin/my_project/detail/"+$stateParams.id)}}),myProjectCtrl.controller("MessageCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.get_message=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.id};console.log(m_params),$http({url:api_uri+"apply/comments/list",method:"GET",params:m_params}).success(function(d){console.log(d),$scope.message_list=d.result}).error(function(d){})},$scope.get_message(),$scope.backProjectDetail=function(){$location.path("/admin/my_project/detail/"+$stateParams.id)}}),myProjectCtrl.controller("ChoiceSaleCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.sale_id||($scope.sale_id=""),$scope.get_saleId=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.id};console.log(m_params),$http({url:api_uri+"p/user/getSalerByApplyId",method:"GET",params:m_params}).success(function(d){$scope.saleId=d.result.id}).error(function(d){})},$scope.get_user=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};console.log(m_params),$http({url:api_uri+"zrh/group/listSalerFromGroup",method:"GET",params:m_params}).success(function(d){console.log(d),$scope.user_list=d.result,$scope.get_saleId()}).error(function(d){})},$scope.get_user(),$scope.submit=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.id,salerId:$scope.sale_id};console.log(m_params),$.ajax({type:"POST",url:api_uri+"loanApplicationManage/updateSale",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode&&($rootScope.successMsg="操作成功",$rootScope.fadeInOut("#alert",500),$scope.backProjectDetail(),$scope.$apply())},dataType:"json"})},$scope.backProjectDetail=function(){$location.path("/admin/my_project/detail/"+$stateParams.id)}});var channelCtrl=angular.module("channelCtrl",[]);channelCtrl.controller("ChannelCtrl",function($http,$scope,$state,$rootScope,$location,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"wxShare/manager/customerList",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result,void 0!=d.result&&($scope.user_list=d.result.datas))}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.cancel=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"p/user/cancelCustomer",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($scope.ids=[],$scope.list($scope.pageNo1,10))},dataType:"json"})},$scope.showDetail=function(id){$location.path("/admin/channel/detail/"+id)}}),channelCtrl.controller("CreateCtrl",function($http,$scope,$state,$rootScope,$location,$routeParams){$scope.submit=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,name:$scope.username,mobile:$scope.phone};console.log(m_params),$.ajax({type:"POST",url:api_uri+"p/user/addCustomer",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode?($state.go("admin.channel"),$rootScope.successMsg="添加成功",$rootScope.fadeInOut("#alert",500),$scope.$apply()):1002==data.returnCode?alert("该用户已经有上级，或者是最高级别用户，不可以添加"):1003==data.returnCode?alert("此手机号尚未注册，暂不能使用"):1004==data.returnCode&&alert("该用户已经被分配")},dataType:"json"})}}),channelCtrl.controller("ChannelDetailCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,wd:$scope.wd,status:$scope.status,uid:$stateParams.id};$http({url:api_uri+"wxShare/manager/customerApplyList",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result,$scope.name=d.result.name,$scope.result_list=d.result.pagination.datas,angular.forEach($scope.result_list,function(data){0==data.status?(data.progressText="未申请",data.color=1):1==data.status?(data.progressText="准备中",data.color=2):2==data.status?(data.progressText="下户",data.color=2):3==data.status?(data.progressText="审批中",data.color=2):4==data.status?(data.progressText="审批通过",data.color=2):5==data.status?(data.progressText="下户",data.color=2):6==data.status?(data.progressText="放款",data.color=2):7==data.status?(data.progressText="成功融资",data.color=3):data.status==-1&&(data.progressText="申请取消",data.color=1)}))}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="准备中":2==$scope.status?$scope.status_text="下户":3==$scope.status?$scope.status_text="审批中":4==$scope.status?$scope.status_text="审批通过":5==$scope.status?$scope.status_text="开户":6==$scope.status?$scope.status_text="放款":7==$scope.status?$scope.status_text="成功融资":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)},$scope.addApply=function(){$location.path("/admin/channel/add_apply/"+$stateParams.id)},$scope.history=function(){$location.path("/admin/channel/history/"+$stateParams.id)},$scope.go_back_channel=function(){$location.path("/admin/channel")},$scope.updateApply=function(id){$location.path("/admin/my_project/detail/"+id)}}),channelCtrl.controller("AddApplyCtrl",function($http,$scope,$state,$rootScope,$location,$stateParams){$scope.getApply=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,companyName:$scope.companyName};$http({url:api_uri+"loanApplicationManage/listByCompanyName",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas)}).error(function(d){})},$scope.choice_product=function(id,name){$scope.productId=id,$scope.productName=name},$scope.submit=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$scope.productId,uid:$stateParams.id};console.log(m_params),$.ajax({type:"POST",url:api_uri+"loanApplicationManage/addChannel",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode?($location.path("/admin/channel/detail/"+$stateParams.id),$rootScope.successMsg="绑定成功",$rootScope.fadeInOut("#alert",500),$scope.$apply()):1003==data.returnCode?alert("用户不存在或申请不存在"):1004==data.returnCode&&alert("参数错误")},dataType:"json"})},$scope.back=function(){$location.path("/admin/channel/detail/"+$stateParams.id)}}),channelCtrl.controller("HistoryCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,uid:$stateParams.id};$http({url:api_uri+"/loanApplicationManage/historyList",method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($scope.page=d.result,$scope.result_list=d.result.datas,angular.forEach($scope.result_list,function(data){$scope.status=d.result.status,0==data.status?data.progressText="未申请":1==data.status?(data.progressText="申请中",data.progressBtn="开始约见"):2==data.status?(data.progressText="约见中",data.progressBtn="继续跟进"):3==data.status?(data.progressText="跟进中",data.progressBtn="完成贷款"):4==data.status?(data.progressText="成功融资",data.progressBtn="已结束"):data.status==-1&&(data.progressText="申请取消")}))}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.ids=[],$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.goBackDetail=function(){$location.path("/admin/channel/detail/"+$stateParams.id)},$scope.change_register=function(id){$location.path("/admin/channel/change/"+$stateParams.id+"/"+id)}}),channelCtrl.controller("ChangeCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.change=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,applyId:$stateParams.idt,mobile:$scope.phone};$.ajax({type:"POST",url:api_uri+"/loanApplicationManage/changeMobile",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode?($location.path("/admin/channel/history/"+$stateParams.id),$rootScope.successMsg="变更成功",$rootScope.fadeInOut("#alert",500),$scope.$apply()):1002==data.returnCode?alert("该申请已经处理过了"):1003==data.returnCode?alert("申请不存在"):alert("未知错误")},dataType:"json"})}});var shareCtrl=angular.module("shareCtrl",[]);shareCtrl.controller("ShareCtrl",function($http,$scope,$state,$rootScope,$location,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"wxShare/manager/userList",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result,$scope.user_list=d.result.datas)}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.remark=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"p/user/toCustomer",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){console.log(data),0==data.returnCode&&($scope.list($scope.pageNo1,10),$scope.ids=[])},dataType:"json"})},$scope.showDetail=function(id){$location.path("/admin/share/share_detail/"+id)}}),shareCtrl.controller("ShareDetailCtrl",function($http,$scope,$state,$rootScope,$stateParams,$location,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize,uid:$stateParams.id};$http({url:api_uri+"wxShare/manager/applyList",method:"GET",params:m_params}).success(function(d){console.log(d),0==d.returnCode&&($scope.page=d.result,$scope.name=d.result.name,$scope.result_list=d.result.pagination.datas,angular.forEach($scope.result_list,function(data){0==data.status?(data.progressText="未申请",data.color=1):1==data.status?(data.progressText="准备中",data.color=2):2==data.status?(data.progressText="下户",data.color=2):3==data.status?(data.progressText="审批中",data.color=2):4==data.status?(data.progressText="审批通过",data.color=2):5==data.status?(data.progressText="下户",data.color=2):6==data.status?(data.progressText="放款",data.color=2):7==data.status?(data.progressText="成功融资",data.color=3):data.status==-1&&(data.progressText="申请取消",data.color=1)}))}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.selected=[],$scope.ids=[],$scope.isSelected=function(id){return $scope.selected.indexOf(id)>=0};var updateSelected=function(action,id){if("add"==action&&$scope.ids.push(id),"remove"==action){var idx=$scope.ids.indexOf(id);$scope.ids.splice(idx,1)}};$scope.updateSelection=function($event,id){var checkbox=$event.target,action=checkbox.checked?"add":"remove";updateSelected(action,id)},$scope.search_text=null,$scope.search=function(){$scope.wd=$scope.search_text,$scope.list(1,20)},$scope.choice=function(status){$scope.status=status,0==$scope.status?$scope.status_text="未申请":1==$scope.status?$scope.status_text="准备中":2==$scope.status?$scope.status_text="下户":3==$scope.status?$scope.status_text="审批中":4==$scope.status?$scope.status_text="审批通过":5==$scope.status?$scope.status_text="开户":6==$scope.status?$scope.status_text="放款":7==$scope.status?$scope.status_text="成功融资":null==$scope.status&&($scope.status_text="全部"),$scope.list(1,20)},$scope.cancel=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,ids:$scope.ids};$.ajax({type:"POST",url:api_uri+"p/user/cancelCustomer",data:m_params,traditional:!0,success:function(data,textStatus,jqXHR){0==data.returnCode&&($scope.ids=[],$scope.list($scope.pageNo1,10))},dataType:"json"})},$scope.updateApply=function(id){$location.path("/admin/my_project/detail/"+id)},$scope.go_back_share=function(){$location.path("/admin/share")}});var messageCtrl=angular.module("messageCtrl",[]);messageCtrl.controller("MessageBankCtrl",function($http,$scope,$rootScope,$location,$timeout,$routeParams){$scope.bank_list=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"applyBankDeal/manage/list",method:"GET",params:m_params}).success(function(d){console.log(d),$scope.message_list=d.result.datas,angular.forEach($scope.message_list,function(data){data.dayNum="",0==data.status?data.progressText="未申请":1==data.status?(data.progressText="准备中",data.progressTextNext="下户",data.jindu=15,data.jindu_next=10,data.jindu_success=25):2==data.status?(data.progressText="下户",data.progressTextNext="审批中",data.jindu=25,data.jindu_next=15,data.jindu_success=40):3==data.status?(data.progressText="审批中",data.progressTextNext="审批通过",data.jindu=40,data.jindu_next=15,data.jindu_success=55):4==data.status?(data.progressText="审批通过",data.progressTextNext="开户",data.jindu=55,data.jindu_next=15,data.jindu_success=70):5==data.status?(data.progressText="开户",data.progressTextNext="放款",data.jindu=70,data.jindu_next=15,data.jindu_success=85):6==data.status?(data.progressText="放款",data.progressTextNext="成功融资",data.jindu=85,data.jindu_next=15,data.jindu_success=100):7==data.status?(data.progressText="成功融资",data.jindu=100):data.status==-1&&(data.progressText="申请取消")})}).error(function(d){})},$scope.bank_list(),$scope.showAllow=[],$scope.showRefuse=[],$scope.show_allow=function(status,id,type){if(0==type){$scope.showAllow[id]=!0,$scope.status=status,2==status?$scope.statusText="下户":3==status?$scope.statusText="审批中":4==status?$scope.statusText="审批通过":5==status?$scope.statusText="开户":6==status?$scope.statusText="放款":7==status&&($scope.statusText="成功融资");for(var i=0;i<$scope.showRefuse.length;i++)$scope.showRefuse[i]=!1}else{$scope.showRefuse[id]=!0;for(var j=0;j<$scope.showAllow.length;j++)$scope.showAllow[j]=!1}},$scope.choiceStatus=function(status){$scope.status=status,2==status?$scope.statusText="下户":3==status?$scope.statusText="审批中":4==status?$scope.statusText="审批通过":5==status?$scope.statusText="开户":6==status?$scope.statusText="放款":7==status&&($scope.statusText="成功融资")},$scope.cancel=function(id){$scope.showAllow[id]=!1,$scope.showRefuse[id]=!1},$scope.allow=function(dayNum,id,index){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,status:$scope.status,dayNum:dayNum,id:id};console.log(m_params),$http({url:api_uri+"applyBankDeal/manage/allow",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($rootScope.successMsg="通过已发送",$rootScope.fadeInOut("#alert",500),$scope.showAllow[index]=!1,$scope.bank_list(),$rootScope.message(),$scope.$apply()):1002==d.returnCode&&"abd"==d.errorString?(alert("这条操作已经操作过了"),console.log(d)):1002==d.returnCode&&"la"==d.errorString?(alert("申请的状态错误"),console.log(d)):(alert(d),console.log(d))}).error(function(d){})},$scope.refuse=function(id,index){$scope.reason_refuse=$("#reason_refuse").val();var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id,reason:$scope.reason_refuse};$http({url:api_uri+"applyBankDeal/manage/refuse",method:"GET",params:m_params}).success(function(d){0==d.returnCode?($rootScope.successMsg="驳回已发送",$rootScope.fadeInOut("#alert",500),$scope.showRefuse[index]=!1,$scope.bank_list(),$rootScope.message(),$scope.$apply()):1002==d.returnCode&&"abd"==d.result?alert("这条操作已经操作过了"):1002==data.returnCode&&"la"==d.result?alert("申请的状态错误"):alert("未知错误")}).error(function(d){})}}),messageCtrl.controller("MessageSystemCtrl",function($http,$scope,$rootScope,$location,$timeout,$routeParams){$scope.list=function(pageNo,pageSize){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,pageNo:pageNo,pageSize:pageSize};$http({url:api_uri+"zrh/message/lists",method:"GET",params:m_params}).success(function(d){$scope.page=d.result,$scope.result_list=d.result.datas}).error(function(d){})},$scope.list(1,20),$scope.changePage=function(page){$scope.pageNo1=page,$scope.$watch($scope.pageNo1,function(){$scope.list($scope.pageNo1,20)})},$scope.to_company_message=function(id){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,id:id};$http({url:api_uri+"zrh/message/details",method:"GET",params:m_params}).success(function(d){$location.path("/admin/company_message")}).error(function(d){})}}),api_uri="http://test.zhironghao.com/api/";var templates_root="templates/";deskey="abc123.*abc123.*abc123.*abc123.*";var app=angular.module("app",["ng","ngRoute","ngAnimate","ui.router","loginCtrl","topBarCtrl","applyListCtrl","loanApplicationCtrl","productCtrl","myProjectCtrl","saleManagerCtrl","manageCtrl","teamCtrl","signUpCtrl","bankCtrl","channelCtrl","shareCtrl","messageCtrl"],function($httpProvider){$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",$httpProvider.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var param=function(obj){var name,value,fullSubName,subName,subValue,innerObj,i,query="";for(name in obj)if(value=obj[name],value instanceof Array)for(i=0;i<value.length;++i)subValue=value[i],fullSubName=name+"["+i+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else if(value instanceof Object)for(subName in value)subValue=value[subName],fullSubName=name+"["+subName+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else void 0!==value&&null!==value&&(query+=encodeURIComponent(name)+"="+encodeURIComponent(value)+"&");return query.length?query.substr(0,query.length-1):query};$httpProvider.defaults.transformRequest=[function(data){return angular.isObject(data)&&"[object File]"!==String(data)?param(data):data}]});app.run(function($location,$rootScope,$http){$rootScope.qiniu_bucket_domain="o793l6o3p.bkt.clouddn.com",$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){var present_route=toState.name;if(present_route.indexOf("admin.my_project.detail")>-1){var from_route=fromState.name;if(""!=from_route&&from_route.indexOf("admin.my_project.edit_apply")<=-1&&from_route.indexOf("admin.my_project.change_company")<=-1&&from_route.indexOf("admin.my_project.change_bank")<=-1&&from_route.indexOf("admin.my_project.distribute")<=-1&&from_route.indexOf("admin.my_project.apply_help")<=-1&&from_route.indexOf("admin.my_project.choice_sale")<=-1){$rootScope.putSessionObject("from_route",from_route);var get_route=$rootScope.getSessionObject("from_route");if("admin.company_message"==get_route?$rootScope.showBtn=1:$rootScope.showBtn=2,fromParams.id){var arrayParams=from_route.split("."),from_route2="/"+arrayParams[0]+"/"+arrayParams[1]+"/"+arrayParams[2]+"/";"edit_apply"!=arrayParams[2]&&$rootScope.putSessionObject("from_route2",from_route2);var from_params=fromParams.id;$rootScope.putSessionObject("from_params",from_params)}}else{var get_route=$rootScope.getSessionObject("from_route");"admin.company_message"==get_route?$rootScope.showBtn=1:$rootScope.showBtn=2}}var array=present_route.split(".");$rootScope.choiceColor=array[1],"message"==array[1]?($rootScope.sideTwo=!0,$rootScope.choiceColorTwo=array[2]):$rootScope.sideTwo=!1}),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){var present_route=toState.name;$rootScope.arrayParams=present_route.split("."),"/login"!=$location.$$path&&$rootScope.check_user(),$rootScope.login_user||$location.path("/login")}),$rootScope.encryptByDES=function(message){var keyHex=CryptoJS.enc.Utf8.parse(deskey),encrypted=CryptoJS.DES.encrypt(message,keyHex,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return encrypted.toString()},$rootScope.decryptByDES=function(ciphertext){var keyHex=CryptoJS.enc.Utf8.parse(deskey),decrypted=CryptoJS.DES.decrypt({ciphertext:CryptoJS.enc.Base64.parse(ciphertext)},keyHex,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return decrypted.toString(CryptoJS.enc.Utf8)},$rootScope.transFn=function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&").toString()},$rootScope.fadeInOut=function(elem,speed){$(elem).fadeIn(speed),setTimeout(function(){$(elem).fadeOut(speed)},3e3)},$rootScope.putObject=function(key,value){localStorage.setItem(key,angular.toJson(value))},$rootScope.getObject=function(key){return angular.fromJson(localStorage.getItem(key))},$rootScope.removeObject=function(key){localStorage.removeItem(key)},$rootScope.putSessionObject=function(key,value){sessionStorage.setItem(key,angular.toJson(value))},$rootScope.getSessionObject=function(key){return angular.fromJson(sessionStorage.getItem(key))},$rootScope.removeSessionObject=function(key){angular.fromJson(sessionStorage.removeItem(key))},$rootScope.getAccountInfo=function(){return $rootScope.account_info=={}&&($rootScope.account_info=$rootScope.putSessionObject("account_info")),$rootScope.account_info||($rootScope.account_info={}),$rootScope.account_info},$rootScope.setAccountInfo=function(account_info){$rootScope.account_info=account_info,$rootScope.putSessionObject("account_info",$rootScope.account_info)},$rootScope.updateAccountInfo=function(dict){$rootScope.account_info=$rootScope.getAccountInfo();for(var key in dict)$rootScope.account_info[key]=dict[key];$rootScope.putSessionObject("account_info",$rootScope.account_info)},$rootScope.setAccountInfoKeyValue=function(key,value){$rootScope.account_info=$rootScope.getAccountInfo(),$rootScope.account_info[key]=value,$rootScope.putSessionObject("account_info",$rootScope.account_info)},$rootScope.getAccountInfoKeyValue=function(key){return $rootScope.account_info!={}&&($rootScope.account_info=$rootScope.putSessionObject("account_info")),$rootScope.account_info?$rootScope.account_info[key]:null},$rootScope.check_user=function(){$rootScope.login_user=$rootScope.getObject("login_user"),$rootScope.login_user&&$http({url:api_uri+"p/user/validateAuth",method:"POST",params:$rootScope.login_user}).success(function(d){return 0==d.returnCode?($rootScope.check_role(),!0):($rootScope.login_user={},$rootScope.removeObject("login_user"),!1)}).error(function(d){return!1})},$rootScope.check_role=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"p/user/detail/"+$rootScope.login_user.userId,method:"GET",params:m_params}).success(function(d){0==d.returnCode&&($rootScope.role=d.result.role,console.log($rootScope.role),"super"==$rootScope.role?"super"==$rootScope.arrayParams[0]||$location.path("/login"):"admin"==$rootScope.role?"admin"==$rootScope.arrayParams[0]&&"user_list"==$rootScope.arrayParams[1]:"manager"==$rootScope.role&&("admin"==$rootScope.arrayParams[0]||console.log("lll")))}).error(function(d){})},$rootScope.message=function(){var m_params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};$http({url:api_uri+"applyBankDeal/manage/count",method:"GET",params:m_params}).success(function(d){console.log("没错好"),0==d.returnCode&&($rootScope.count=d.result)}).error(function(d){})},$rootScope.login_user&&$rootScope.message()}),app.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/login"),$stateProvider.state("login",{url:"/login",views:{"":{templateUrl:templates_root+"login/index.html",controller:"LoginCtrl"}}}).state("super",{url:"/super",views:{"":{templateUrl:templates_root+"super/index.html"},"top_bar@super":{templateUrl:templates_root+"bar/top_bar.html",controller:"TopBarCtrl"},"side_bar@super":{templateUrl:templates_root+"bar/side_bar.html"},"main@super":{templateUrl:templates_root+"super/main.html"}}}).state("super.apply_list",{url:"/apply_list",views:{"main@super":{
templateUrl:templates_root+"super/product_service/apply_list/apply_list.html",controller:"ApplyListCtrl"}}}).state("super.manage",{url:"/manage",views:{"main@super":{templateUrl:templates_root+"super/product_service/manage/user_list.html",controller:"UserListCtrl"}}}).state("super.manage.addUser",{url:"/add_user",views:{"main@super":{templateUrl:templates_root+"super/product_service/manage/add_user.html",controller:"CreateUserCtrl"}}}).state("super.manage.update",{url:"/update/:id",views:{"main@super":{templateUrl:templates_root+"super/product_service/manage/user_update.html",controller:"UserUpdateCtrl"}}}).state("super.team",{url:"/team",views:{"main@super":{templateUrl:templates_root+"super/product_service/team/team.html",controller:"TeamCtrl"}}}).state("super.team.members",{url:"/members/:id",views:{"main@super":{templateUrl:templates_root+"super/product_service/team/members.html",controller:"MembersCtrl"}}}).state("super.product",{url:"/product",views:{"main@super":{templateUrl:templates_root+"super/product_service/product/product.html",controller:"ProductCtrl"}}}).state("super.product.create",{url:"/create",views:{"main@super":{templateUrl:templates_root+"super/product_service/product/create.html",controller:"ProductCreateCtrl"}}}).state("super.product.update",{url:"/update/:id",views:{"main@super":{templateUrl:templates_root+"super/product_service/product/update.html",controller:"ProductUpdateCtrl"}}}).state("super.product.sort",{url:"/sort",views:{"main@super":{templateUrl:templates_root+"super/product_service/product/sort.html",controller:"SortCtrl"}}}).state("super.bank",{url:"/bank",views:{"main@super":{templateUrl:templates_root+"super/product_service/bank/bank.html",controller:"BankCtrl"}}}).state("super.bank.bank_man",{params:{id:null,name:null},url:"/bank_man/:id/:name",views:{"main@super":{templateUrl:templates_root+"super/product_service/bank/bank_man.html",controller:"BankManCtrl"}}}).state("super.bank.add_bank",{params:{id:null,name:null},url:"/add_bank/:id/:name",views:{"main@super":{templateUrl:templates_root+"super/product_service/bank/add_bank.html",controller:"AddBankCtrl"}}}).state("super.bank.add_bank_man",{url:"/add_bank_man/:id/:name",views:{"main@super":{templateUrl:templates_root+"super/product_service/bank/add_bank_man.html",controller:"AddBankManCtrl"}}}).state("super.bank.update",{url:"/update/:id",views:{"main@super":{templateUrl:templates_root+"super/product_service/bank/update.html",controller:"UpdateBankCtrl"}}}).state("super.bank.update_bank_man",{url:"/update_bank_man/:id",views:{"main@super":{templateUrl:templates_root+"super/product_service/bank/update_bank_man.html",controller:"UpdateBankManCtrl"}}}).state("super.signUp",{url:"/signUp",views:{"main@super":{templateUrl:templates_root+"super/product_service/sign_up/sign_up.html",controller:"SignUpCtrl"}}}).state("admin",{url:"/admin",views:{"":{templateUrl:templates_root+"admin/index.html"},"top_bar@admin":{templateUrl:templates_root+"bar/top_bar.html",controller:"TopBarCtrl"},"side_bar@admin":{templateUrl:templates_root+"bar/side_bar.html",controller:"SideBarCtrl"},"contains@admin":{templateUrl:templates_root+"admin/contains.html",controller:"ContainsCtrl"}}}).state("admin.company_message",{url:"/company_message",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/company_message/company_message.html",controller:"LoanApplicationCtrl"}}}).state("admin.company_message.add_company",{url:"/add_company",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/company_message/add_company.html",controller:"AddCompanyCtrl"}}}).state("admin.my_project",{url:"/my_project",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/my_project.html",controller:"MyProjectCtrl"}}}).state("admin.my_project.detail",{url:"/detail/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/detail.html",controller:"DetailCtrl"}}}).state("admin.my_project.edit_apply",{url:"/edit_apply/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/edit_apply.html",controller:"EditApplyCtrl"}}}).state("admin.my_project.distribute",{url:"/distribute/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/distribute.html",controller:"DistributeCtrl"}}}).state("admin.my_project.apply_help",{url:"/apply_help/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/apply_help.html",controller:"ApplyHelpCtrl"}}}).state("admin.my_project.change_bank",{url:"/change_bank/:id/:mobile",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/change_bank.html",controller:"ApplyHelpCtrl"}}}).state("admin.my_project.change_register",{url:"/change_register/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/change.html",controller:"ChangeRegisterCtrl"}}}).state("admin.my_project.message",{url:"/message/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/message.html",controller:"MessageCtrl"}}}).state("admin.my_project.choice_sale",{url:"/choice_sale/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/my_project/choice_sale.html",controller:"ChoiceSaleCtrl"}}}).state("admin.user_list",{url:"/user_list",views:{"contains@admin":{templateUrl:templates_root+"manager/user_list.html",controller:"SaleManagerCtrl"}}}).state("admin.user_list.sale_apply_list",{url:"/sale_apply_list/:id",views:{"contains@admin":{templateUrl:templates_root+"manager/sale_apply_list.html",controller:"SaleApplyListCtrl"}}}).state("admin.statistics",{url:"/statistics",views:{"contains@admin":{templateUrl:templates_root+"admin/statistics/share/statistics.html"}}}).state("admin.statistics.person",{url:"/person",views:{"contains@admin":{templateUrl:templates_root+"admin/statistics/share/person.html"}}}).state("admin.channel",{url:"/channel",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/channel.html",controller:"ChannelCtrl"}}}).state("admin.channel.create",{url:"/create",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/create.html",controller:"CreateCtrl"}}}).state("admin.channel.detail",{url:"/detail/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/detail.html",controller:"ChannelDetailCtrl"}}}).state("admin.channel.add_apply",{url:"/add_apply/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/add_apply.html",controller:"AddApplyCtrl"}}}).state("admin.channel.history",{url:"/history/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/history.html",controller:"HistoryCtrl"}}}).state("admin.channel.change",{url:"/change/:id/:idt",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/channel/change.html",controller:"ChangeCtrl"}}}).state("admin.share",{url:"/share",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/share/share.html",controller:"ShareCtrl"}}}).state("admin.share.share_detail",{url:"/share_detail/:id",views:{"contains@admin":{templateUrl:templates_root+"admin/product_service/share/share_detail.html",controller:"ShareDetailCtrl"}}}).state("admin.message",{url:"/message",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/message.html"}}}).state("admin.message.company",{url:"/company",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/company.html"}}}).state("admin.message.bank",{url:"/bank",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/bank.html",controller:"MessageBankCtrl"}}}).state("admin.message.apply",{url:"/apply",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/apply.html"}}}).state("admin.message.system",{url:"/system",views:{"contains@admin":{templateUrl:templates_root+"admin/user_center/message/system.html",controller:"MessageSystemCtrl"}}})});